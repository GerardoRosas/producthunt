(window.webpackJsonp=window.webpackJsonp||[]).push([[3],{"7mgd":function(t,e,n){(function(t){!function(e){"use strict";try{(function(){e=e&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e;var n,r,i,o=function(t,e){return(o=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function s(t,e){function n(){this.constructor=t}o(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}function u(t,e,n,r){return new(n=n||Promise)((function(i,o){function s(t){try{a(r.next(t))}catch(t){o(t)}}function u(t){try{a(r.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?i(t.value):((e=t.value)instanceof n?e:new n((function(t){t(e)}))).then(s,u)}a((r=r.apply(t,e||[])).next())}))}function a(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function u(o){return function(u){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=0<(i=s.trys).length&&i[i.length-1])&&(6===o[0]||2===o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(u){o=[6,u],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,u])}}}function h(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function c(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,u=o.length;s<u;s++,i++)r[i]=o[s];return r}function f(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString(),o=p[e];if(!o)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[o].apply(console,c(["["+i+"]  "+t.name+":"],n))}}(i=r=r||{})[i.DEBUG=0]="DEBUG",i[i.VERBOSE=1]="VERBOSE",i[i.INFO=2]="INFO",i[i.WARN=3]="WARN",i[i.ERROR=4]="ERROR",i[i.SILENT=5]="SILENT",r.DEBUG,r.VERBOSE,r.INFO,r.WARN,r.ERROR,r.SILENT;var l=r.INFO,p=((n={})[r.DEBUG]="log",n[r.VERBOSE]="log",n[r.INFO]="info",n[r.WARN]="warn",n[r.ERROR]="error",n),d=(Object.defineProperty(y.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in r))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),Object.defineProperty(y.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!0,configurable:!0}),y.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,r.DEBUG],t)),this._logHandler.apply(this,c([this,r.DEBUG],t))},y.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,r.VERBOSE],t)),this._logHandler.apply(this,c([this,r.VERBOSE],t))},y.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,r.INFO],t)),this._logHandler.apply(this,c([this,r.INFO],t))},y.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,r.WARN],t)),this._logHandler.apply(this,c([this,r.WARN],t))},y.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,c([this,r.ERROR],t)),this._logHandler.apply(this,c([this,r.ERROR],t))},y);function y(t){this.name=t,this._logLevel=l,this._logHandler=f,this._userLogHandler=null}function v(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var m,g=(s(w,m=Error),w);function w(t,e){var n=m.call(this,e)||this;return n.code=t,n.name="FirebaseError",Object.setPrototypeOf(n,w.prototype),Error.captureStackTrace&&Error.captureStackTrace(n,b.prototype.create),n}var b=(E.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r,i=e[0]||{},o=this.service+"/"+t,s=this.errors[t],u=s?(r=i,s.replace(T,(function(t,e){var n=r[e];return null!=n?n.toString():"<"+e+"?>"}))):"Error",a=this.serviceName+": "+u+" ("+o+").",h=new g(o,a),c=0,f=Object.keys(i);c<f.length;c++){var l=f[c];"_"!==l.slice(-1)&&(l in h&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),h[l]=i[l])}return h},E);function E(t,e,n){this.service=t,this.serviceName=e,this.errors=n}var T=/\{\$([^}]+)}/g,I=(N.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},N.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},N.prototype.setServiceProps=function(t){return this.serviceProps=t,this},N);function N(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY"}function _(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var A,S="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof t?t:"undefined"!=typeof self?self:{},D=D||{},k=S||self;function x(){}function O(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function R(t){var e=O(t);return"array"==e||"object"==e&&"number"==typeof t.length}function V(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var P="closure_uid_"+(1e9*Math.random()>>>0),L=0;function C(t,e,n){return t.call.apply(t.bind,arguments)}function M(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function j(t,e,n){return(j=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?C:M).apply(null,arguments)}function U(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var q=Date.now||function(){return+new Date};function F(t,e){function n(){}n.prototype=e.prototype,t.M=e.prototype,t.prototype=new n,t.prototype.constructor=t}function B(){this.j=this.j,this.i=this.i}B.prototype.j=!1,B.prototype.da=function(){var t;!this.j&&(this.j=!0,this.C(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,P)&&t[P]||(t[P]=++L))},B.prototype.C=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var G=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},z=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function W(t){return Array.prototype.concat.apply([],arguments)}function Q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function H(t){return/^[\s\xa0]*$/.test(t)}var K,Y=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function X(t,e){return-1!=t.indexOf(e)}function $(t,e){return t<e?-1:e<t?1:0}t:{var J=k.navigator;if(J){var Z=J.userAgent;if(Z){K=Z;break t}}K=""}function tt(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function et(t){var e={};for(var n in t)e[n]=t[n];return e}var nt="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function rt(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<nt.length;o++)n=nt[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function it(t){return it[" "](t),t}it[" "]=x;var ot,st,ut=X(K,"Opera"),at=X(K,"Trident")||X(K,"MSIE"),ht=X(K,"Edge"),ct=ht||at,ft=X(K,"Gecko")&&!(X(K.toLowerCase(),"webkit")&&!X(K,"Edge"))&&!(X(K,"Trident")||X(K,"MSIE"))&&!X(K,"Edge"),lt=X(K.toLowerCase(),"webkit")&&!X(K,"Edge");function pt(){var t=k.document;return t?t.documentMode:void 0}t:{var dt="",yt=(st=K,ft?/rv:([^\);]+)(\)|;)/.exec(st):ht?/Edge\/([\d\.]+)/.exec(st):at?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(st):lt?/WebKit\/(\S+)/.exec(st):ut?/(?:Version)[ \/]?(\S+)/.exec(st):void 0);if(yt&&(dt=yt?yt[1]:""),at){var vt=pt();if(null!=vt&&vt>parseFloat(dt)){ot=String(vt);break t}}ot=dt}var mt={};function gt(t){return e=t,n=function(){for(var e=0,n=Y(String(ot)).split("."),r=Y(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var s=n[o]||"",u=r[o]||"";do{if(s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],u=/(\d*)(\D*)(.*)/.exec(u)||["","","",""],0==s[0].length&&0==u[0].length)break;e=$(0==s[1].length?0:parseInt(s[1],10),0==u[1].length?0:parseInt(u[1],10))||$(0==s[2].length,0==u[2].length)||$(s[2],u[2]),s=s[3],u=u[3]}while(0==e)}return 0<=e},r=mt,Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=n();var e,n,r}var wt=k.document&&at&&(pt()||parseInt(ot,10))||void 0,bt=!at||9<=Number(wt),Et=at&&!gt("9"),Tt=function(){if(!k.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{k.addEventListener("test",x,e),k.removeEventListener("test",x,e)}catch(t){}return t}();function It(t,e){this.type=t,this.a=this.target=e,this.defaultPrevented=!1}function Nt(t,e){if(It.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(ft){t:{try{it(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:_t[t.pointerType]||"",(this.c=t).defaultPrevented&&this.b()}}It.prototype.b=function(){this.defaultPrevented=!0},F(Nt,It);var _t={2:"touch",3:"pen",4:"mouse"};Nt.prototype.b=function(){Nt.M.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Et)try{(t.ctrlKey||112<=t.keyCode&&t.keyCode<=123)&&(t.keyCode=-1)}catch(t){}};var At="closure_listenable_"+(1e6*Math.random()|0),St=0;function Dt(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.aa=i,this.key=++St,this.V=this.X=!1}function kt(t){t.V=!0,t.listener=null,t.proxy=null,t.src=null,t.aa=null}function xt(t){this.src=t,this.a={},this.b=0}function Ot(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=G(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(kt(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function Rt(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.V&&o.listener==e&&o.capture==!!n&&o.aa==r)return i}return-1}xt.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var s=Rt(t,e,r,i);return-1<s?(e=t[s],n||(e.X=!1)):((e=new Dt(e,this.src,o,!!r,i)).X=n,t.push(e)),e};var Vt="closure_lm_"+(1e6*Math.random()|0),Pt={};function Lt(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(Array.isArray(n)){for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);return null}return r=Gt(r),e&&e[At]?e.sa(n,r,V(i)?!!i.capture:!!i,o):Ct(e,n,r,!0,i,o)}(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Lt(t,e[o],n,r,i);return null}return n=Gt(n),t&&t[At]?t.ra(e,n,V(r)?!!r.capture:!!r,i):Ct(t,e,n,!1,r,i)}function Ct(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=V(i)?!!i.capture:!!i;if(s&&!bt)return null;var u,a,h=Ft(t);if(h||(t[Vt]=h=new xt(t)),(n=h.add(e,n,r,s,o)).proxy)return n;if(u=qt,r=a=bt?function(t){return u.call(a.src,a.listener,t)}:function(t){if(!(t=u.call(a.src,a.listener,t)))return t},(n.proxy=r).src=t,r.listener=n,t.addEventListener)Tt||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(jt(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Mt(t){if("number"!=typeof t&&t&&!t.V){var e=t.src;if(e&&e[At])Ot(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(jt(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Ft(e))?(Ot(n,t),0==n.b&&(n.src=null,e[Vt]=null)):kt(t)}}}function jt(t){return t in Pt?Pt[t]:Pt[t]="on"+t}function Ut(t,e){var n=t.listener,r=t.aa||t.src;return t.X&&Mt(t),n.call(r,e)}function qt(t,e){if(t.V)return!0;if(bt)return Ut(t,new Nt(e,this));if(!e)t:{e=["window","event"];for(var n=k,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}return Ut(t,e=new Nt(e,this))}function Ft(t){return(t=t[Vt])instanceof xt?t:null}var Bt="__closure_events_fn_"+(1e9*Math.random()>>>0);function Gt(t){return"function"==O(t)?t:(t[Bt]||(t[Bt]=function(e){return t.handleEvent(e)}),t[Bt])}function zt(){B.call(this),this.c=new xt(this),(this.J=this).A=null}function Wt(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.V&&s.capture==n){var u=s.listener,a=s.aa||s.src;s.X&&Ot(t.c,s),i=!1!==u.call(a,r)&&i}}return i&&!r.defaultPrevented}F(zt,B),zt.prototype[At]=!0,(A=zt.prototype).addEventListener=function(t,e,n,r){Lt(this,t,e,n,r)},A.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(Array.isArray(n))for(var s=0;s<n.length;s++)t(e,n[s],r,i,o);else i=V(i)?!!i.capture:!!i,r=Gt(r),e&&e[At]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=Rt(s=e.a[n],r,i,o))&&(kt(s[r]),Array.prototype.splice.call(s,r,1),0==s.length&&(delete e.a[n],e.b--))):(e=e&&Ft(e))&&(n=e.a[n.toString()],e=-1,n&&(e=Rt(n,r,i,o)),(r=-1<e?n[e]:null)&&Mt(r))}(this,t,e,n,r)},A.dispatchEvent=function(t){var e,n=this.A;if(n)for(e=[];n;n=n.A)e.push(n);n=this.J;var r=t.type||t;if("string"==typeof t)t=new It(t,n);else if(t instanceof It)t.target=t.target||n;else{var i=t;rt(t=new It(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var s=t.a=e[o];i=Wt(s,r,!0,t)&&i}if(i=Wt(s=t.a=n,r,!0,t)&&i,i=Wt(s,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Wt(s=t.a=e[o],r,!1,t)&&i;return i},A.C=function(){if(zt.M.C.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)kt(n[r]);delete e.a[t],e.b--}}this.A=null},A.ra=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},A.sa=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Qt=k.JSON.stringify;function Ht(){this.b=this.a=null}var Kt,Yt=(Xt.prototype.get=function(){var t;return 0<this.b?(this.b--,t=this.a,this.a=t.next,t.next=null):t=this.c(),t},new Xt((function(){return new $t}),(function(t){t.reset()}),100));function Xt(t,e,n){this.f=n,this.c=t,this.g=e,this.b=0,this.a=null}function $t(){this.next=this.b=this.a=null}function Jt(t){k.setTimeout((function(){throw t}),0)}function Zt(t,e){var n;Kt||(n=k.Promise.resolve(void 0),Kt=function(){n.then(ne)}),te||(Kt(),te=!0),ee.add(t,e)}Ht.prototype.add=function(t,e){var n=Yt.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},$t.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null};var te=!($t.prototype.reset=function(){this.next=this.b=this.a=null}),ee=new Ht;function ne(){for(var t;r=n=void 0,r=null,(n=ee).a&&(r=n.a,n.a=n.a.next,n.a||(n.b=null),r.next=null),t=r;){try{t.a.call(t.b)}catch(t){Jt(t)}var e=Yt;e.g(t),e.b<e.f&&(e.b++,t.next=e.a,e.a=t)}var n,r;te=!1}function re(t,e){zt.call(this),this.b=t||1,this.a=e||k,this.f=j(this.Ua,this),this.g=q()}function ie(t){t.Z=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function oe(t,e,n){if("function"==O(t))n&&(t=j(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=j(t.handleEvent,t)}return 2147483647<Number(e)?-1:k.setTimeout(t,e||0)}function se(t,e,n){B.call(this),this.f=null!=n?j(t,n):t,this.c=e,this.b=j(this.Pa,this),this.a=[]}function ue(t){t.T=oe(t.b,t.c),t.f.apply(null,t.a)}function ae(t){B.call(this),this.b=t,this.a={}}F(re,zt),(A=re.prototype).Z=!1,A.L=null,A.Ua=function(){if(this.Z){var t=q()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.Z&&(ie(this),this.start()))}},A.start=function(){this.Z=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=q())},A.C=function(){re.M.C.call(this),ie(this),delete this.a},F(se,B),(A=se.prototype).ba=!1,A.T=null,A.Ia=function(t){this.a=arguments,this.T?this.ba=!0:ue(this)},A.C=function(){se.M.C.call(this),this.T&&(k.clearTimeout(this.T),this.T=null,this.ba=!1,this.a=[])},A.Pa=function(){this.T=null,this.ba&&(this.ba=!1,ue(this))},F(ae,B);var he=[];function ce(t,e,n,r){Array.isArray(n)||(n&&(he[0]=n.toString()),n=he);for(var i=0;i<n.length;i++){var o=Lt(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function fe(t){tt(t.a,(function(t,e){this.a.hasOwnProperty(e)&&Mt(t)}),t),t.a={}}function le(){}ae.prototype.C=function(){ae.M.C.call(this),fe(this)},ae.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var pe=null;function de(){return pe=pe||new zt}function ye(t){It.call(this,"serverreachability",t)}function ve(t){var e=de();e.dispatchEvent(new ye(e))}function me(t){It.call(this,"statevent",t)}function ge(t){var e=de();e.dispatchEvent(new me(e))}function we(t){It.call(this,"timingevent",t)}function be(t,e){if("function"!=O(t))throw Error("Fn must not be null and must be a function");return k.setTimeout((function(){t()}),e)}F(ye,It),F(me,It),F(we,It);var Ee={NO_ERROR:0,Va:1,bb:2,ab:3,Ya:4,$a:5,cb:6,za:7,TIMEOUT:8,gb:9},Te={Xa:"complete",kb:"success",Aa:"error",za:"abort",ib:"ready",jb:"readystatechange",TIMEOUT:"timeout",eb:"incrementaldata",hb:"progress",Za:"downloadprogress",lb:"uploadprogress"};function Ie(){}function Ne(t){var e;return(e=t.a)||(e=t.a={}),e}function _e(){}Ie.prototype.a=null;var Ae,Se={OPEN:"a",Wa:"b",Aa:"c",fb:"d"};function De(){It.call(this,"d")}function ke(){It.call(this,"c")}function xe(){}function Oe(t,e,n){this.g=t,this.W=e,this.U=n||1,this.G=new ae(this),this.N=Re,t=ct?125:void 0,this.O=new re(t),this.m=null,this.b=!1,this.j=this.A=this.f=this.B=this.s=this.P=this.h=null,this.i=[],this.a=null,this.w=0,this.c=this.v=null,this.H=-1,this.l=!1,this.J=0,this.D=null,this.o=this.R=this.F=!1}F(De,It),F(ke,It),F(xe,Ie),Ae=new xe;var Re=45e3,Ve={},Pe={};function Le(t,e,n){t.B=1,t.f=rn($e(e)),t.j=n,t.F=!0,Ce(t,null)}function Ce(t,e){t.s=q(),Ue(t),t.A=$e(t.f);var n=t.A,r=t.U;Array.isArray(r)||(r=[String(r)]),mn(n.b,"t",r),t.w=0,t.a=ar(t.g,t.g.w?e:null),0<t.J&&(t.D=new se(j(t.ya,t,t.a),t.J)),ce(t.G,t.a,"readystatechange",t.Sa),e=t.m?et(t.m):{},t.j?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.$(t.A,t.v,t.j,e)):(t.v="GET",t.a.$(t.A,t.v,null,e)),ve()}function Me(t,e,n){for(var r=!0;!t.l&&t.w<n.length;){var i=je(t,n);if(i==Pe){4==e&&(t.c=4,ge(),r=!1);break}if(i==Ve){t.c=4,ge(),r=!1;break}ze(t,i)}4==e&&0==n.length&&(t.c=1,ge(),r=!1),t.b=t.b&&r,r||(Ge(t),Be(t))}function je(t,e){var n=t.w,r=e.indexOf("\n",n);return-1==r?Pe:(n=Number(e.substring(n,r)),isNaN(n)?Ve:(r+=1)+n>e.length?Pe:(e=e.substr(r,n),t.w=r+n,e))}function Ue(t){t.P=q()+t.N,qe(t,t.N)}function qe(t,e){if(null!=t.h)throw Error("WatchDog timer not null");t.h=be(j(t.Qa,t),e)}function Fe(t){t.h&&(k.clearTimeout(t.h),t.h=null)}function Be(t){0==t.g.u||t.l||rr(t.g,t)}function Ge(t){Fe(t);var e=t.D;e&&"function"==typeof e.da&&e.da(),t.D=null,ie(t.O),fe(t.G),t.a&&(e=t.a,t.a=null,e.abort(),e.da())}function ze(t,e){try{var n=t.g;if(0!=n.u&&(n.a==t||Nn(n.b,t)))if(n.A=t.H,!t.o&&Nn(n.b,t)&&3==n.u){try{var r=n.ja.a.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.i){if(n.a){if(!(n.a.s+3e3<t.s))break t;nr(n),n.a.cancel(),n.a=null}er(n),ge()}}else n.ia=i[1],0<n.ia-n.G&&i[2]<37500&&n.U&&0==n.m&&!n.l&&(n.l=be(j(n.Na,n),6e3));if(In(n.b)<=1&&n.O){try{n.O()}catch(t){}n.O=void 0}}else or(n,11)}else if(!t.o&&n.a!=t||nr(n),!H(e))for(e=r=n.ja.a.parse(e),r=0;r<e.length;r++)if(i=e[r],n.G=i[0],i=i[1],2==n.u)if("c"==i[0]){n.B=i[1],n.R=i[2];var o=i[3];null!=o&&(n.oa=o);var s=i[5];null!=s&&"number"==typeof s&&0<s&&(n.D=1.5*s);var u=n,a=t.a;if(a){var h=a.a?a.a.getResponseHeader("X-Client-Wire-Protocol"):null;if(h){var c=u.b;!c.a&&(X(h,"spdy")||X(h,"quic")||X(h,"h2"))&&(c.f=c.g,c.a=new Set,c.b&&(_n(c,c.b),c.b=null))}if(u.s){var f=a.a?a.a.getResponseHeader("X-HTTP-Session-Id"):null;f&&(u.ha=f,nn(u.v,u.s,f))}}n.u=3,n.c&&n.c.na();var l=t;if((u=n).ea=ur(u,u.w?u.R:null,u.P),l.o){An(u.b,l);var p=l,d=u.D;d&&p.setTimeout(d),p.h&&(Fe(p),Ue(p)),u.a=l}else tr(u);0<n.f.length&&Xn(n)}else"stop"!=i[0]&&"close"!=i[0]||or(n,7);else 3==n.u&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?or(n,7):Hn(n):"noop"!=i[0]&&n.c&&n.c.ma(i),n.m=0);ve()}catch(t){}}function We(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(R(t)||"string"==typeof t)z(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.I&&"function"==typeof t.I)n=void 0;else if(R(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.I&&"function"==typeof t.I)return t.I();if("string"==typeof t)return t.split("");if(R(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function Qe(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof Qe)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function He(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ke(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ke(i,r=t.a[e])||(i[t.a[n++]=r]=1),e++;t.a.length=n}}function Ke(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(A=Oe.prototype).setTimeout=function(t){this.N=t},A.Sa=function(t){t=t.target;var e=this.D;e&&3==Gn(t)?e.Ia():this.ya(t)},A.ya=function(t){try{if(t==this.a)t:{var e=Gn(this.a),n=this.a.qa();if(this.a.S(),!(e<3||3==e&&!ct&&!this.a.Y())){this.l||4!=e||7==n||ve(),Fe(this);var r=this.a.S();this.H=r;var i=this.a.Y();if(this.b=200==r){if(this.R&&!this.o){e:{if(this.a){var o,s=this.a;if((o=s.a?s.a.getResponseHeader("X-HTTP-Initial-Response"):null)&&!H(o)){var u=o;break e}}u=null}if(!u){this.b=!1,this.c=3,ge(),Ge(this),Be(this);break t}this.o=!0,ze(this,u)}this.F?(Me(this,e,i),ct&&this.b&&3==e&&(ce(this.G,this.O,"tick",this.Ra),this.O.start())):ze(this,i),4==e&&Ge(this),this.b&&!this.l&&(4==e?rr(this.g,this):(this.b=!1,Ue(this)))}else 400==r&&0<i.indexOf("Unknown SID")?(this.c=3,ge()):(this.c=0,ge()),Ge(this),Be(this)}}}catch(t){}},A.Ra=function(){if(this.a){var t=Gn(this.a),e=this.a.Y();this.w<e.length&&(Fe(this),Me(this,t,e),this.b&&4!=t&&Ue(this))}},A.cancel=function(){this.l=!0,Ge(this)},A.Qa=function(){this.h=null;var t=q();0<=t-this.P?(2!=this.B&&(ve(),ge()),Ge(this),this.c=2,Be(this)):qe(this,this.P-t)},(A=Qe.prototype).I=function(){He(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},A.K=function(){return He(this),this.a.concat()},A.get=function(t,e){return Ke(this.b,t)?this.b[t]:e},A.set=function(t,e){Ke(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},A.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Ye=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Xe(t,e){if(this.c=this.j=this.f="",this.h=null,this.i=this.g="",this.a=!1,t instanceof Xe){this.a=void 0!==e?e:t.a,Je(this,t.f),this.j=t.j,Ze(this,t.c),tn(this,t.h),this.g=t.g,e=t.b;var n=new pn;n.c=e.c,e.a&&(n.a=new Qe(e.a),n.b=e.b),en(this,n),this.i=t.i}else t&&(n=String(t).match(Ye))?(this.a=!!e,Je(this,n[1]||"",!0),this.j=on(n[2]||""),Ze(this,n[3]||"",!0),tn(this,n[4]),this.g=on(n[5]||"",!0),en(this,n[6]||"",!0),this.i=on(n[7]||"")):(this.a=!!e,this.b=new pn(null,this.a))}function $e(t){return new Xe(t)}function Je(t,e,n){t.f=n?on(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function Ze(t,e,n){t.c=n?on(e,!0):e}function tn(t,e){if(e){if(e=Number(e),isNaN(e)||e<0)throw Error("Bad port number "+e);t.h=e}else t.h=null}function en(t,e,n){var r,i;e instanceof pn?(t.b=e,r=t.b,(i=t.a)&&!r.f&&(dn(r),r.c=null,r.a.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(yn(this,e),mn(this,n,t))}),r)),r.f=i):(n||(e=sn(e,fn)),t.b=new pn(e,t.a))}function nn(t,e,n){t.b.set(e,n)}function rn(t){return nn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^q()).toString(36)),t}function on(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function sn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,un),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function un(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Xe.prototype.toString=function(){var t=[],e=this.f;e&&t.push(sn(e,an,!0),":");var n=this.c;return!n&&"file"!=e||(t.push("//"),(e=this.j)&&t.push(sn(e,an,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.h)&&t.push(":",String(n))),(n=this.g)&&(this.c&&"/"!=n.charAt(0)&&t.push("/"),t.push(sn(n,"/"==n.charAt(0)?cn:hn,!0))),(n=this.b.toString())&&t.push("?",n),(n=this.i)&&t.push("#",sn(n,ln)),t.join("")};var an=/[#\/\?@]/g,hn=/[#\?:]/g,cn=/[#\?]/g,fn=/[#\?@]/g,ln=/#/g;function pn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function dn(t){t.a||(t.a=new Qe,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function yn(t,e){dn(t),e=gn(t,e),Ke(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,Ke((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&He(t)))}function vn(t,e){return dn(t),e=gn(t,e),Ke(t.a.b,e)}function mn(t,e,n){yn(t,e),0<n.length&&(t.c=null,t.a.set(gn(t,e),Q(n)),t.b+=n.length)}function gn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function wn(t,e){this.b=t,this.a=e}function bn(t){this.g=t||En,t=k.PerformanceNavigationTiming?0<(t=k.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(k.ca&&k.ca.ua&&k.ca.ua()&&k.ca.ua().mb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new Set),this.b=null,this.c=[]}(A=pn.prototype).add=function(t,e){dn(this),this.c=null,t=gn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},A.forEach=function(t,e){dn(this),this.a.forEach((function(n,r){z(n,(function(n){t.call(e,n,r,this)}),this)}),this)},A.K=function(){dn(this);for(var t=this.a.I(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},A.I=function(t){dn(this);var e=[];if("string"==typeof t)vn(this,t)&&(e=W(e,this.a.get(gn(this,t))));else{t=this.a.I();for(var n=0;n<t.length;n++)e=W(e,t[n])}return e},A.set=function(t,e){return dn(this),this.c=null,vn(this,t=gn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},A.get=function(t,e){return t&&0<(t=this.I(t)).length?String(t[0]):e},A.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.I(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.c=t.join("&")};var En=10;function Tn(t){return t.b||t.a&&t.a.size>=t.f}function In(t){return t.b?1:t.a?t.a.size:0}function Nn(t,e){return t.b?t.b==e:t.a&&t.a.has(e)}function _n(t,e){t.a?t.a.add(e):t.b=e}function An(t,e){t.b&&t.b==e?t.b=null:t.a&&t.a.has(e)&&t.a.delete(e)}function Sn(t){var e,n;if(null!=t.b)return t.c.concat(t.b.i);if(null==t.a||0===t.a.size)return Q(t.c);var r=t.c;try{for(var i=_(t.a.values()),o=i.next();!o.done;o=i.next()){var s=o.value;r=r.concat(s.i)}}catch(t){e={error:t}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Dn(){}function kn(){this.a=new Dn}function xn(t,e,n){var r=n||"";try{We(t,(function(t,n){var i=t;V(t)&&(i=Qt(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function On(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}bn.prototype.cancel=function(){var t,e;if(this.c=Sn(this),this.b)this.b.cancel(),this.b=null;else if(this.a&&0!==this.a.size){try{for(var n=_(this.a.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(e){t={error:e}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.a.clear()}},Dn.prototype.stringify=function(t){return k.JSON.stringify(t,void 0)},Dn.prototype.parse=function(t){return k.JSON.parse(t,void 0)};var Rn=k.JSON.parse;function Vn(t){zt.call(this),this.headers=new Qe,this.G=t||null,this.b=!1,this.s=this.a=null,this.D="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.H=Pn,this.B=this.F=!1}F(Vn,zt);var Pn="",Ln=/^https?$/i,Cn=["POST","PUT"];function Mn(t){return"content-type"==t.toLowerCase()}function jn(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,Un(t),Fn(t)}function Un(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function qn(t){if(t.b&&void 0!==D&&(!t.s[1]||4!=Gn(t)||2!=t.S()))if(t.l&&4==Gn(t))oe(t.va,0,t);else if(t.dispatchEvent("readystatechange"),4==Gn(t)){t.b=!1;try{var e,n=t.S();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.D).match(Ye)[1]||null;if(!o&&k.self&&k.self.location){var s=k.self.location.protocol;o=s.substr(0,s.length-1)}i=!Ln.test(o?o.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{t.h=6;try{var u=2<Gn(t)?t.a.statusText:""}catch(t){u=""}t.f=u+" ["+t.S()+"]",Un(t)}}finally{Fn(t)}}}function Fn(t,e){if(t.a){Bn(t);var n=t.a,r=t.s[0]?x:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Bn(t){t.a&&t.B&&(t.a.ontimeout=null),t.m&&(k.clearTimeout(t.m),t.m=null)}function Gn(t){return t.a?t.a.readyState:0}function zn(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}var i;r||(i="",tt(n,(function(t,e){i+=e,i+=":",i+=t,i+="\r\n"})),n=i,"string"==typeof t?null!=n&&encodeURIComponent(String(n)):nn(t,e,n))}function Wn(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Qn(t){this.f=[],this.R=this.ea=this.v=this.P=this.a=this.ha=this.s=this.N=this.h=this.F=this.j=null,this.Fa=this.H=0,this.Ca=Wn("failFast",!1,t),this.U=this.l=this.i=this.g=this.c=null,this.W=!0,this.A=this.ia=this.G=-1,this.J=this.m=this.o=0,this.Ba=Wn("baseRetryDelayMs",5e3,t),this.Ga=Wn("retryDelaySeedMs",1e4,t),this.Da=Wn("forwardChannelMaxRetries",2,t),this.ga=Wn("forwardChannelRequestTimeoutMs",2e4,t),this.Ea=t&&t.nb||void 0,this.D=void 0,this.w=t&&t.supportsCrossDomainXhr||!1,this.B="",this.b=new bn(t&&t.concurrentRequestLimit),this.ja=new kn,this.fa=t&&t.fastHandshake||!1,t&&t.forceLongPolling&&(this.W=!1),this.O=void 0}function Hn(t){if(Kn(t),3==t.u){var e=t.H++,n=$e(t.v);nn(n,"SID",t.B),nn(n,"RID",e),nn(n,"TYPE","terminate"),Jn(t,n),(e=new Oe(t,e,void 0)).B=2,e.f=rn($e(n)),n=!1,k.navigator&&k.navigator.sendBeacon&&(n=k.navigator.sendBeacon(e.f.toString(),"")),!n&&k.Image&&((new Image).src=e.f,n=!0),n||(e.a=ar(e.g,null),e.a.$(e.f)),e.s=q(),Ue(e)}sr(t)}function Kn(t){t.a&&(t.a.cancel(),t.a=null),t.i&&(k.clearTimeout(t.i),t.i=null),nr(t),t.b.cancel(),t.g&&("number"==typeof t.g&&k.clearTimeout(t.g),t.g=null)}function Yn(t,e){t.f.push(new wn(t.Fa++,e)),3==t.u&&Xn(t)}function Xn(t){Tn(t.b)||t.g||(t.g=!0,Zt(t.xa,t),t.o=0)}function $n(t,e){var n;n=e?e.W:t.H++;var r=$e(t.v);nn(r,"SID",t.B),nn(r,"RID",n),nn(r,"AID",t.G),Jn(t,r),t.h&&t.j&&zn(r,t.h,t.j),n=new Oe(t,n,t.o+1),null===t.h&&(n.m=t.j),e&&(t.f=e.i.concat(t.f)),e=Zn(t,n,1e3),n.setTimeout(Math.round(.5*t.ga)+Math.round(.5*t.ga*Math.random())),_n(t.b,n),Le(n,r,e)}function Jn(t,e){t.c&&We({},(function(t,n){nn(e,n,t)}))}function Zn(t,e,n){n=Math.min(t.f.length,n);var r=t.c?j(t.c.Ha,t.c,t):null;t:for(var i=t.f,o=-1;;){var s=["count="+n];-1==o?0<n?(o=i[0].b,s.push("ofs="+o)):o=0:s.push("ofs="+o);for(var u=!0,a=0;a<n;a++){var h=i[a].b,c=i[a].a;if((h-=o)<0)o=Math.max(0,i[a].b-100),u=!1;else try{xn(c,s,"req"+h+"_")}catch(t){r&&r(c)}}if(u){r=s.join("&");break t}}return t=t.f.splice(0,n),e.i=t,r}function tr(t){t.a||t.i||(t.J=1,Zt(t.wa,t),t.m=0)}function er(t){return!(t.a||t.i||3<=t.m)&&(t.J++,t.i=be(j(t.wa,t),ir(t,t.m)),t.m++,1)}function nr(t){null!=t.l&&(k.clearTimeout(t.l),t.l=null)}function rr(t,e){var n=null;if(t.a==e){nr(t),t.a=null;var r=2}else{if(!Nn(t.b,e))return;n=e.i,An(t.b,e),r=1}if(t.A=e.H,0!=t.u)if(e.b)if(1==r){n=e.j?e.j.length:0,e=q()-e.s;var i=t.o;(r=de()).dispatchEvent(new we(r)),Xn(t)}else tr(t);else if(3==(i=e.c)||0==i&&0<t.A||!(1==r&&function(t,e){if(!(In(t.b)>=t.b.f-(t.g?1:0))){if(t.g)return t.f=e.i.concat(t.f),1;if(!(1==t.u||2==t.u||t.o>=(t.Ca?0:t.Da)))return t.g=be(j(t.xa,t,e),ir(t,t.o)),t.o++,1}}(t,e)||2==r&&er(t)))switch(n&&0<n.length&&(e=t.b,e.c=e.c.concat(n)),i){case 1:or(t,5);break;case 4:or(t,10);break;case 3:or(t,6);break;default:or(t,2)}}function ir(t,e){var n=t.Ba+Math.floor(Math.random()*t.Ga);return t.c||(n*=2),n*e}function or(t,e){if(2==e){var n=null;t.c&&(n=null);var r=j(t.Ta,t);n||(n=new Xe("//www.google.com/images/cleardot.gif"),k.location&&"http"==k.location.protocol||Je(n,"https"),rn(n)),function(t,e){var n=new le;if(k.Image){var r=new Image;r.onload=U(On,n,r,"TestLoadImage: loaded",!0,e),r.onerror=U(On,n,r,"TestLoadImage: error",!1,e),r.onabort=U(On,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=U(On,n,r,"TestLoadImage: timeout",!1,e),k.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else ge();t.u=0,t.c&&t.c.la(e),sr(t),Kn(t)}function sr(t){t.u=0,t.A=-1,t.c&&(0==Sn(t.b).length&&0==t.f.length||(t.b.c.length=0,Q(t.f),t.f.length=0),t.c.ka())}function ur(t,e,n){var r,i,o,s,u,a,h=(r=n)instanceof Xe?$e(r):new Xe(r,void 0);if(""!=h.c)e&&Ze(h,e+"."+h.c),tn(h,h.h);else{var c=k.location;i=c.protocol,o=e?e+"."+c.hostname:c.hostname,s=+c.port,u=n,a=new Xe(null,void 0),i&&Je(a,i),o&&Ze(a,o),s&&tn(a,s),u&&(a.g=u),h=a}return t.N&&tt(t.N,(function(t,e){nn(h,e,t)})),e=t.s,n=t.ha,e&&n&&nn(h,e,n),nn(h,"VER",t.oa),Jn(t,h),h}function ar(t,e){if(e&&!t.w)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Vn(t.Ea)).F=t.w,e}function hr(){}function cr(){if(at&&!(10<=Number(wt)))throw Error("Environmental error: no available transport.")}function fr(t,e){zt.call(this),this.a=new Qn(e),this.l=t,this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.j=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.pa&&(t?t["X-WebChannel-Client-Profile"]=e.pa:t={"X-WebChannel-Client-Profile":e.pa}),this.a.F=t,(t=e&&e.httpHeadersOverwriteParam)&&!H(t)&&(this.a.h=t),this.h=e&&e.supportsCrossDomainXhr||!1,this.g=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!H(e)&&(this.a.s=e,null!==(t=this.b)&&e in t&&e in(t=this.b)&&delete t[e]),this.f=new dr(this)}function lr(t){De.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function pr(){ke.call(this),this.status=1}function dr(t){this.a=t}(A=Vn.prototype).$=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+t);e=e?e.toUpperCase():"GET",this.D=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.G?Ne(this.G):Ne(Ae),this.a.onreadystatechange=j(this.va,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void jn(this,t)}t=n||"";var i,o=new Qe(this.headers);r&&We(r,(function(t,e){o.set(e,t)})),r=function(t){t:{for(var e=Mn,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return e<0?null:"string"==typeof t?t.charAt(e):t[e]}(o.K()),n=k.FormData&&t instanceof k.FormData,0<=G(Cn,e)&&!r&&!n&&o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach((function(t,e){this.a.setRequestHeader(e,t)}),this),this.H&&(this.a.responseType=this.H),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Bn(this),0<this.o&&((this.B=(i=this.a,at&&gt(9)&&"number"==typeof i.timeout&&void 0!==i.ontimeout))?(this.a.timeout=this.o,this.a.ontimeout=j(this.ta,this)):this.m=oe(this.ta,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){jn(this,t)}},A.ta=function(){void 0!==D&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},A.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Fn(this))},A.C=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Fn(this,!0)),Vn.M.C.call(this)},A.va=function(){this.j||(this.w||this.l||this.g?qn(this):this.Oa())},A.Oa=function(){qn(this)},A.S=function(){try{return 2<Gn(this)?this.a.status:-1}catch(n){return-1}},A.Y=function(){try{return this.a?this.a.responseText:""}catch(n){return""}},A.Ja=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Rn(e)}},A.qa=function(){return this.h},A.Ma=function(){return"string"==typeof this.f?this.f:String(this.f)},(A=Qn.prototype).oa=8,A.u=1,A.xa=function(t){if(this.g)if(this.g=null,1==this.u){if(!t){this.H=Math.floor(1e5*Math.random());var e,n=new Oe(this,t=this.H++,void 0),r=this.j;if(this.F&&(r?rt(r=et(r),this.F):r=this.F),null===this.h&&(n.m=r),this.fa)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&"string"==typeof(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Zn(this,n,e),nn(i=$e(this.v),"RID",t),nn(i,"CVER",22),this.s&&nn(i,"X-HTTP-Session-Id",this.s),Jn(this,i),this.h&&r&&zn(i,this.h,r),_n(this.b,n),this.fa?(nn(i,"$req",e),nn(i,"SID","null"),n.R=!0,Le(n,i,null)):Le(n,i,e),this.u=2}}else 3==this.u&&(t?$n(this,t):0==this.f.length||Tn(this.b)||$n(this))},A.wa=function(){this.i=null,this.a=new Oe(this,"rpc",this.J),null===this.h&&(this.a.m=this.j),this.a.J=0;var t=$e(this.ea);nn(t,"RID","rpc"),nn(t,"SID",this.B),nn(t,"CI",this.U?"0":"1"),nn(t,"AID",this.G),Jn(this,t),nn(t,"TYPE","xmlhttp"),this.h&&this.j&&zn(t,this.h,this.j),this.D&&this.a.setTimeout(this.D);var e=this.a,n=this.R;e.B=1,e.f=rn($e(t)),e.j=null,e.F=!0,Ce(e,n)},A.Na=function(){null!=this.l&&(this.l=null,this.a.cancel(),this.a=null,er(this),ge())},A.Ta=function(t){ge()},(A=hr.prototype).na=function(){},A.ma=function(){},A.la=function(){},A.ka=function(){},A.Ha=function(){},cr.prototype.a=function(t,e){return new fr(t,e)},F(fr,zt),(A=fr.prototype).addEventListener=function(t,e,n,r){fr.M.addEventListener.call(this,t,e,n,r)},A.removeEventListener=function(t,e,n,r){fr.M.removeEventListener.call(this,t,e,n,r)},A.Ka=function(){this.a.c=this.f,this.h&&(this.a.w=!0);var t=this.a,e=this.l,n=this.b||void 0;ge(),t.P=e,t.N=n||{},t.U=t.W,t.v=ur(t,null,t.P),Xn(t)},A.close=function(){Hn(this.a)},A.La=function(t){if("string"==typeof t){var e={};e.__data__=t,Yn(this.a,e)}else this.g?((e={}).__data__=Qt(t),Yn(this.a,e)):Yn(this.a,t)},A.C=function(){this.a.c=null,delete this.f,Hn(this.a),delete this.a,fr.M.C.call(this)},F(lr,De),F(pr,ke),F(dr,hr),dr.prototype.na=function(){this.a.dispatchEvent("a")},dr.prototype.ma=function(t){this.a.dispatchEvent(new lr(t))},dr.prototype.la=function(t){this.a.dispatchEvent(new pr)},dr.prototype.ka=function(){this.a.dispatchEvent("b")},cr.prototype.createWebChannel=cr.prototype.a,fr.prototype.send=fr.prototype.La,fr.prototype.open=fr.prototype.Ka,fr.prototype.close=fr.prototype.close,Ee.NO_ERROR=0,Ee.TIMEOUT=8,Ee.HTTP_ERROR=6,Te.COMPLETE="complete",(_e.EventType=Se).OPEN="a",Se.CLOSE="b",Se.ERROR="c",Se.MESSAGE="d",zt.prototype.listen=zt.prototype.ra,Vn.prototype.listenOnce=Vn.prototype.sa,Vn.prototype.getLastError=Vn.prototype.Ma,Vn.prototype.getLastErrorCode=Vn.prototype.qa,Vn.prototype.getStatus=Vn.prototype.S,Vn.prototype.getResponseJson=Vn.prototype.Ja,Vn.prototype.getResponseText=Vn.prototype.Y,Vn.prototype.send=Vn.prototype.$;var yr={createWebChannelTransport:function(){return new cr},ErrorCode:Ee,EventType:Te,WebChannel:_e,XhrIo:Vn},vr=yr.createWebChannelTransport,mr=yr.ErrorCode,gr=yr.EventType,wr=yr.WebChannel,br=yr.XhrIo,Er=e.SDK_VERSION,Tr=(Ir.prototype.t=function(){return null!=this.uid},Ir.prototype.s=function(){return this.t()?"uid:"+this.uid:"anonymous-user"},Ir.prototype.isEqual=function(t){return t.uid===this.uid},Ir);function Ir(t){this.uid=t}function Nr(t,e){this.user=e,this.type="OAuth",this.o={},this.o.Authorization="Bearer "+t}Tr.UNAUTHENTICATED=new Tr(null),Tr.i=new Tr("google-credentials-uid"),Tr.h=new Tr("first-party-uid");var _r,Ar,Sr={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Dr=(s(Wr,Ar=Error),Wr),kr=(zr.prototype.getToken=function(){return Promise.resolve(null)},zr.prototype._=function(){},zr.prototype.l=function(t){(this.u=t)(Tr.UNAUTHENTICATED)},zr.prototype.T=function(){this.u=null},zr),xr=(Gr.prototype.getToken=function(){var t=this,e=this.m,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){if(t.m!==e)throw new Dr(Sr.ABORTED,"getToken aborted due to token change.");return n?(Zs("string"==typeof n.accessToken),new Nr(n.accessToken,t.currentUser)):null})):Promise.resolve(null)},Gr.prototype._=function(){this.forceRefresh=!0},Gr.prototype.l=function(t){this.u=t,this.R&&t(this.currentUser)},Gr.prototype.T=function(){this.auth&&this.auth.removeAuthTokenListener(this.I),this.I=null,this.u=null},Gr.prototype.A=function(){var t=this.auth&&this.auth.getUid();return Zs(null===t||"string"==typeof t),new Tr(t)},Gr),Or=(Object.defineProperty(Br.prototype,"o",{get:function(){var t={"X-Goog-AuthUser":this.V},e=this.P.auth.g([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),Br),Rr=(Fr.prototype.getToken=function(){return Promise.resolve(new Or(this.P,this.V))},Fr.prototype.l=function(t){t(Tr.h)},Fr.prototype.T=function(){},Fr.prototype._=function(){},Fr),Vr=(qr.now=function(){return qr.fromMillis(Date.now())},qr.fromDate=function(t){return qr.fromMillis(t.getTime())},qr.fromMillis=function(t){var e=Math.floor(t/1e3);return new qr(e,1e6*(t-1e3*e))},qr.prototype.toDate=function(){return new Date(this.toMillis())},qr.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},qr.prototype.p=function(t){return this.seconds===t.seconds?nu(this.nanoseconds,t.nanoseconds):nu(this.seconds,t.seconds)},qr.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},qr.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},qr.prototype.valueOf=function(){var t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},qr),Pr=(Ur.v=function(t){return new Ur(t)},Ur.min=function(){return new Ur(new Vr(0,0))},Ur.prototype.S=function(t){return this.timestamp.p(t.timestamp)},Ur.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},Ur.prototype.D=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},Ur.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},Ur.prototype.C=function(){return this.timestamp},Ur),Lr=(Object.defineProperty(jr.prototype,"length",{get:function(){return this.F},enumerable:!0,configurable:!0}),jr.prototype.isEqual=function(t){return 0===jr.N(this,t)},jr.prototype.child=function(t){var e=this.segments.slice(this.offset,this.limit());return t instanceof jr?t.forEach((function(t){e.push(t)})):e.push(t),this.$(e)},jr.prototype.limit=function(){return this.offset+this.length},jr.prototype.k=function(t){return t=void 0===t?1:t,this.$(this.segments,this.offset+t,this.length-t)},jr.prototype.M=function(){return this.$(this.segments,this.offset,this.length-1)},jr.prototype.L=function(){return this.segments[this.offset]},jr.prototype.O=function(){return this.get(this.length-1)},jr.prototype.get=function(t){return this.segments[this.offset+t]},jr.prototype.B=function(){return 0===this.length},jr.prototype.q=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},jr.prototype.U=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},jr.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},jr.prototype.W=function(){return this.segments.slice(this.offset,this.limit())},jr.N=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(o<i)return 1}return t.length<e.length?-1:t.length>e.length?1:0},jr),Cr=(s(Mr,_r=Lr),Mr.prototype.$=function(t,e,n){return new Mr(t,e,n)},Mr.prototype.j=function(){return this.W().join("/")},Mr.prototype.toString=function(){return this.j()},Mr.K=function(t){if(0<=t.indexOf("//"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new Mr(t.split("/").filter((function(t){return 0<t.length})))},Mr);function Mr(){return null!==_r&&_r.apply(this,arguments)||this}function jr(t,e,n){void 0===e?e=0:e>t.length&&Js(),void 0===n?n=t.length-e:n>t.length-e&&Js(),this.segments=t,this.offset=e,this.F=n}function Ur(t){this.timestamp=t}function qr(t,e){if(this.seconds=t,(this.nanoseconds=e)<0)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(1e9<=e)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(253402300800<=t)throw new Dr(Sr.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}function Fr(t,e){this.P=t,this.V=e}function Br(t,e){this.P=t,this.V=e,this.type="FirstParty",this.user=Tr.h}function Gr(t){var e=this;this.I=null,this.currentUser=Tr.UNAUTHENTICATED,this.R=!1,this.m=0,this.u=null,this.forceRefresh=!1,this.I=function(){e.m++,e.currentUser=e.A(),e.R=!0,e.u&&e.u(e.currentUser)},this.m=0,this.auth=t.getImmediate({optional:!0}),this.auth?this.auth.addAuthTokenListener(this.I):(this.I(null),t.get().then((function(t){e.auth=t,e.I&&e.auth.addAuthTokenListener(e.I)}),(function(){})))}function zr(){this.u=null}function Wr(t,e){var n=this;return(n=Ar.call(this,e)||this).code=t,n.message=e,n.name="FirebaseError",n.toString=function(){return n.name+": [code="+n.code+"]: "+n.message},n}Cr.G=new Cr([]);var Qr,Hr=/^[_a-zA-Z][_a-zA-Z0-9]*$/,Kr=(s(Yr,Qr=Lr),Yr.prototype.$=function(t,e,n){return new Yr(t,e,n)},Yr.H=function(t){return Hr.test(t)},Yr.prototype.j=function(){return this.W().map((function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),Yr.H(t)||(t="`"+t+"`"),t})).join(".")},Yr.prototype.toString=function(){return this.j()},Yr.prototype.Y=function(){return 1===this.length&&"__name__"===this.get(0)},Yr.J=function(){return new Yr(["__name__"])},Yr.X=function(t){for(var e=[],n="",r=0,i=function(){if(0===n.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");e.push(n),n=""},o=!1;r<t.length;){var s=t[r];if("\\"===s){if(r+1===t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[r+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Dr(Sr.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=u,r+=2}else"`"===s?o=!o:"."!==s||o?n+=s:i(),r++}if(i(),o)throw new Dr(Sr.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Yr(e)},Yr);function Yr(){return null!==Qr&&Qr.apply(this,arguments)||this}Kr.G=new Kr([]);var Xr=($r.Z=function(t){return new $r(Cr.K(t).k(5))},$r.prototype.tt=function(t){return 2<=this.path.length&&this.path.get(this.path.length-2)===t},$r.prototype.isEqual=function(t){return null!==t&&0===Cr.N(this.path,t.path)},$r.prototype.toString=function(){return this.path.toString()},$r.N=function(t,e){return Cr.N(t.path,e.path)},$r.et=function(t){return t.length%2==0},$r.st=function(t){return new $r(new Cr(t.slice()))},$r);function $r(t){this.path=t}function Jr(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Zr(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function ti(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}Xr.EMPTY=new Xr(new Cr([]));var ei=(ni.fromBase64String=function(t){return new ni(zs.nt().atob(t))},ni.fromUint8Array=function(t){return new ni(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t))},ni.prototype.toBase64=function(){return zs.nt().btoa(this.it)},ni.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.it)},ni.prototype.rt=function(){return 2*this.it.length},ni.prototype.S=function(t){return nu(this.it,t.it)},ni.prototype.isEqual=function(t){return this.it===t.it},ni);function ni(t){this.it=t}function ri(t){return null==t}function ii(t){return-0===t&&1/t==-1/0}function oi(t){return"number"==typeof t&&Number.isInteger(t)&&!ii(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}function si(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function ui(t){var e=yi(t.mapValue.fields.__local_write_time__.timestampValue);return new Vr(e.seconds,e.nanos)}ei.ht=new ei("");var ai=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function hi(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?si(t)?4:10:Js()}function ci(t,e){var n,r,i,o=hi(t);if(o!==hi(e))return!1;switch(o){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return ui(t).isEqual(ui(e));case 3:return function(e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=yi(t.timestampValue),r=yi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e);case 5:return t.stringValue===e.stringValue;case 6:return i=e,mi(t.bytesValue).isEqual(mi(i.bytesValue));case 7:return t.referenceValue===e.referenceValue;case 8:return r=e,vi((n=t).geoPointValue.latitude)===vi(r.geoPointValue.latitude)&&vi(n.geoPointValue.longitude)===vi(r.geoPointValue.longitude);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return vi(t.integerValue)===vi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=vi(t.doubleValue),r=vi(e.doubleValue);return n===r?ii(n)===ii(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return ru(t.arrayValue.values||[],e.arrayValue.values||[],ci);case 10:return function(e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Jr(n)!==Jr(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!ci(n[i],r[i])))return!1;return!0}(e);default:return Js()}}function fi(t,e){return void 0!==(t.values||[]).find((function(t){return ci(t,e)}))}function li(t,e){var n,r,i,o,s,u,a,h,c,f,l=hi(t),p=hi(e);if(l!==p)return nu(l,p);switch(l){case 0:return 0;case 1:return nu(t.booleanValue,e.booleanValue);case 2:return h=e,(c=vi(t.integerValue||t.doubleValue))<(f=vi(h.integerValue||h.doubleValue))?-1:f<c?1:c===f?0:isNaN(c)?isNaN(f)?0:-1:1;case 3:return pi(t.timestampValue,e.timestampValue);case 4:return pi(ui(t),ui(e));case 5:return nu(t.stringValue,e.stringValue);case 6:return o=t.bytesValue,s=e.bytesValue,u=mi(o),a=mi(s),u.S(a);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=nu(n[i],r[i]);if(0!==o)return o}return nu(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return n=t.geoPointValue,r=e.geoPointValue,0!==(i=nu(vi(n.latitude),vi(r.latitude)))?i:nu(vi(n.longitude),vi(r.longitude));case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=li(n[i],r[i]);if(o)return o}return nu(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var u=nu(r[s],o[s]);if(0!==u)return u;var a=li(n[r[s]],i[o[s]]);if(0!==a)return a}return nu(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Js()}}function pi(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return nu(t,e);var n=yi(t),r=yi(e),i=nu(n.seconds,r.seconds);return 0!==i?i:nu(n.nanos,r.nanos)}function di(t){return function t(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?"time("+(n=yi(e.timestampValue)).seconds+","+n.nanos+")":"stringValue"in e?e.stringValue:"bytesValue"in e?mi(e.bytesValue).toBase64():"referenceValue"in e?(i=e.referenceValue,Xr.Z(i).toString()):"geoPointValue"in e?"geo("+(r=e.geoPointValue).latitude+","+r.longitude+")":"arrayValue"in e?function(){for(var n="[",r=!0,i=0,o=e.arrayValue.values||[];i<o.length;i++)r?r=!1:n+=",",n+=t(o[i]);return n+"]"}():"mapValue"in e?function(e){for(var n="{",r=!0,i=0,o=Object.keys(e.fields||{}).sort();i<o.length;i++){var s=o[i];r?r=!1:n+=",",n+=s+":"+t(e.fields[s])}return n+"}"}(e.mapValue):Js();var n,r,i}(t)}function yi(t){if(Zs(!!t),"string"!=typeof t)return{seconds:vi(t.seconds),nanos:vi(t.nanos)};var e=0,n=ai.exec(t);if(Zs(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}function vi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function mi(t){return"string"==typeof t?ei.fromBase64String(t):ei.fromUint8Array(t)}function gi(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.j()}}function wi(t){return t&&"integerValue"in t}function bi(t){return!!t&&"arrayValue"in t}function Ei(t){return t&&"nullValue"in t}function Ti(t){return t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function Ii(t){return t&&"mapValue"in t}var Ni=(_i.prototype.ot=function(t,e){return n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}},t&&(n.fields.__previous_value__=t),{mapValue:n};var n},_i.prototype.at=function(t,e){return e},_i.prototype.ut=function(t){return null},_i.prototype.isEqual=function(t){return t instanceof _i},_i);function _i(){}Ni.instance=new Ni;var Ai=(Oi.prototype.ot=function(t,e){return this.apply(t)},Oi.prototype.at=function(t,e){return this.apply(t)},Oi.prototype.apply=function(t){for(var e=Ri(t),n=function(t){e.some((function(e){return ci(e,t)}))||e.push(t)},r=0,i=this.elements;r<i.length;r++)n(i[r]);return{arrayValue:{values:e}}},Oi.prototype.ut=function(t){return null},Oi.prototype.isEqual=function(t){return t instanceof Oi&&ru(this.elements,t.elements,ci)},Oi),Si=(xi.prototype.ot=function(t,e){return this.apply(t)},xi.prototype.at=function(t,e){return this.apply(t)},xi.prototype.apply=function(t){for(var e=Ri(t),n=function(t){e=e.filter((function(e){return!ci(e,t)}))},r=0,i=this.elements;r<i.length;r++)n(i[r]);return{arrayValue:{values:e}}},xi.prototype.ut=function(t){return null},xi.prototype.isEqual=function(t){return t instanceof xi&&ru(this.elements,t.elements,ci)},xi),Di=(ki.prototype.ot=function(t,e){var n=this.ut(t),r=this.asNumber(n)+this.asNumber(this.ct);return wi(n)&&wi(this.ct)?this.serializer._t(r):this.serializer.lt(r)},ki.prototype.at=function(t,e){return e},ki.prototype.ut=function(t){return wi(e=t)||e&&"doubleValue"in e?t:{integerValue:0};var e},ki.prototype.isEqual=function(t){return t instanceof ki&&ci(this.ct,t.ct)},ki.prototype.asNumber=function(t){return vi(t.integerValue||t.doubleValue)},ki);function ki(t,e){this.serializer=t,this.ct=e}function xi(t){this.elements=t}function Oi(t){this.elements=t}function Ri(t){return bi(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}function Vi(t,e){this.version=t,this.transformResults=e}var Pi,Li,Ci,Mi,ji,Ui=(so.prototype.dt=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].q(t))return!0;return!1},so.prototype.isEqual=function(t){return ru(this.fields,t.fields,(function(t,e){return t.isEqual(e)}))},so),qi=(oo.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},oo),Fi=(io.ft=function(){return new io},io.exists=function(t){return new io(void 0,t)},io.updateTime=function(t){return new io(t)},Object.defineProperty(io.prototype,"Tt",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),io.prototype.Et=function(t){return void 0!==this.updateTime?t instanceof To&&t.version.isEqual(this.updateTime):void 0===this.exists||this.exists===t instanceof To},io.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},io),Bi=(ro.prototype.It=function(t){},ro.wt=function(t){return t instanceof To?t.version:Pr.min()},ro),Gi=(s(no,ji=Bi),no.prototype.at=function(t,e){this.It(t);var n=e.version;return new To(this.key,n,this.value,{hasCommittedMutations:!0})},no.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Bi.wt(t);return new To(this.key,r,this.value,{At:!0})},no.prototype.Pt=function(t){return null},no.prototype.isEqual=function(t){return t instanceof no&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.Rt.isEqual(t.Rt)},no),zi=(s(eo,Mi=Bi),eo.prototype.at=function(t,e){if(this.It(t),!this.Rt.Et(t))return new No(this.key,e.version);var n=this.gt(t);return new To(this.key,e.version,n,{hasCommittedMutations:!0})},eo.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=Bi.wt(t),i=this.gt(t);return new To(this.key,r,i,{At:!0})},eo.prototype.Pt=function(t){return null},eo.prototype.isEqual=function(t){return t instanceof eo&&this.key.isEqual(t.key)&&this.Vt.isEqual(t.Vt)&&this.Rt.isEqual(t.Rt)},eo.prototype.gt=function(t){var e;return e=t instanceof To?t.data():Ki.empty(),this.pt(e)},eo.prototype.pt=function(t){var e=this,n=new Yi(t);return this.Vt.fields.forEach((function(t){if(!t.B()){var r=e.data.field(t);null!==r?n.set(t,r):n.delete(t)}})),n.yt()},eo),Wi=(s(to,Ci=Bi),to.prototype.at=function(t,e){if(this.It(t),Zs(null!=e.transformResults),!this.Rt.Et(t))return new No(this.key,e.version);var n=this.bt(t),r=this.vt(t,e.transformResults),i=e.version,o=this.St(n.data(),r);return new To(this.key,i,o,{hasCommittedMutations:!0})},to.prototype.ot=function(t,e,n){if(this.It(t),!this.Rt.Et(t))return t;var r=this.bt(t),i=this.Dt(n,t,e),o=this.St(r.data(),i);return new To(this.key,r.version,o,{At:!0})},to.prototype.Pt=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof To?t.field(i.field):void 0,s=i.transform.ut(o||null);null!=s&&(e=null==e?(new Yi).set(i.field,s):e.set(i.field,s))}return e?e.yt():null},to.prototype.isEqual=function(t){return t instanceof to&&this.key.isEqual(t.key)&&ru(this.fieldTransforms,t.fieldTransforms,(function(t,e){return t.isEqual(e)}))&&this.Rt.isEqual(t.Rt)},to.prototype.bt=function(t){return t},to.prototype.vt=function(t,e){var n=[];Zs(this.fieldTransforms.length===e.length);for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,s=null;t instanceof To&&(s=t.field(i.field)),n.push(o.at(s,e[r]))}return n},to.prototype.Dt=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var s=o[i],u=s.transform,a=null;e instanceof To&&(a=e.field(s.field)),null===a&&n instanceof To&&(a=n.field(s.field)),r.push(u.ot(a,t))}return r},to.prototype.St=function(t,e){for(var n=new Yi(t),r=0;r<this.fieldTransforms.length;r++){var i=this.fieldTransforms[r].field;n.set(i,e[r])}return n.yt()},to),Qi=(s(Zi,Li=Bi),Zi.prototype.at=function(t,e){return this.It(t),new Io(this.key,e.version,{hasCommittedMutations:!0})},Zi.prototype.ot=function(t,e,n){return this.It(t),this.Rt.Et(t)?new Io(this.key,Pr.min()):t},Zi.prototype.Pt=function(t){return null},Zi.prototype.isEqual=function(t){return t instanceof Zi&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Zi),Hi=(s(Ji,Pi=Bi),Ji.prototype.at=function(t,e){Js()},Ji.prototype.ot=function(t,e,n){Js()},Ji.prototype.Pt=function(t){Js()},Ji.prototype.isEqual=function(t){return t instanceof Ji&&this.key.isEqual(t.key)&&this.Rt.isEqual(t.Rt)},Ji),Ki=($i.empty=function(){return new $i({mapValue:{}})},$i.prototype.field=function(t){if(t.B())return this.proto;for(var e=this.proto,n=0;n<t.length-1;++n){if(!e.mapValue.fields)return null;if(!Ii(e=e.mapValue.fields[t.get(n)]))return null}return(e=(e.mapValue.fields||{})[t.O()])||null},$i.prototype.isEqual=function(t){return ci(this.proto,t.proto)},$i),Yi=(Xi.prototype.set=function(t,e){return this.Nt(t,e),this},Xi.prototype.delete=function(t){return this.Nt(t,null),this},Xi.prototype.Nt=function(t,e){for(var n=this.Ft,r=0;r<t.length-1;++r){var i=t.get(r),o=n.get(i);o instanceof Map||(o=o&&10===hi(o)?new Map(Object.entries(o.mapValue.fields||{})):new Map,n.set(i,o)),n=o}n.set(t.O(),e)},Xi.prototype.yt=function(){var t=this.$t(Kr.G,this.Ft);return null!=t?new Ki(t):this.Ct},Xi.prototype.$t=function(t,e){var n=this,r=!1,i=this.Ct.field(t),o=Ii(i)?Object.assign({},i.mapValue.fields):{};return e.forEach((function(e,i){if(e instanceof Map){var s=n.$t(t.child(i),e);null!=s&&(o[i]=s,r=!0)}else null!==e?(o[i]=e,r=!0):o.hasOwnProperty(i)&&(delete o[i],r=!0)})),r?{mapValue:{fields:o}}:null},Xi);function Xi(t){void 0===t&&(t=Ki.empty()),this.Ct=t,this.Ft=new Map}function $i(t){this.proto=t}function Ji(t,e){var n=this;return(n=Pi.call(this)||this).key=t,n.Rt=e,n.type=4,n}function Zi(t,e){var n=this;return(n=Li.call(this)||this).key=t,n.Rt=e,n.type=3,n}function to(t,e){var n=this;return(n=Ci.call(this)||this).key=t,n.fieldTransforms=e,n.type=2,n.Rt=Fi.exists(!0),n}function eo(t,e,n,r){var i=this;return(i=Mi.call(this)||this).key=t,i.data=e,i.Vt=n,i.Rt=r,i.type=1,i}function no(t,e,n){var r=this;return(r=ji.call(this)||this).key=t,r.value=e,r.Rt=n,r.type=0,r}function ro(){}function io(t,e){this.updateTime=t,this.exists=e}function oo(t,e){this.field=t,this.transform=e}function so(t){(this.fields=t).sort(Kr.N)}function uo(t){var e=[];return Zr(t.fields||{},(function(t,n){var r=new Kr([t]);if(Ii(n)){var i=uo(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++){var u=s[o];e.push(r.child(u))}}else e.push(r)})),new Ui(e)}function ao(t,e){this.key=t,this.version=e}function ho(t){this.count=t}var co,fo,lo,po,yo,vo,mo,go,wo,bo,Eo,To=(s(Yo,Eo=ao),Yo.prototype.field=function(t){return this.kt.field(t)},Yo.prototype.data=function(){return this.kt},Yo.prototype.Mt=function(){return this.kt.proto},Yo.prototype.isEqual=function(t){return t instanceof Yo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.At===t.At&&this.hasCommittedMutations===t.hasCommittedMutations&&this.kt.isEqual(t.kt)},Yo.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.kt.toString()+", {hasLocalMutations: "+this.At+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(Yo.prototype,"hasPendingWrites",{get:function(){return this.At||this.hasCommittedMutations},enumerable:!0,configurable:!0}),Yo),Io=(s(Ko,bo=ao),Ko.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ko.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),Ko.prototype.isEqual=function(t){return t instanceof Ko&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ko),No=(s(Ho,wo=ao),Ho.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(Ho.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),Ho.prototype.isEqual=function(t){return t instanceof Ho&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},Ho),_o=(Qo.prototype.canonicalId=function(){if(null===this.Lt){var t=this.path.j();null!==this.collectionGroup&&(t+="|cg:"+this.collectionGroup),t+="|f:",t+=this.filters.map((function(t){return t.canonicalId()})).join(","),t+="|ob:",t+=this.orderBy.map((function(t){return t.canonicalId()})).join(","),ri(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.Lt=t}return this.Lt},Qo.prototype.toString=function(){var t=this.path.j();return null!==this.collectionGroup&&(t+=" collectionGroup="+this.collectionGroup),0<this.filters.length&&(t+=", filters: ["+this.filters.join(", ")+"]"),ri(this.limit)||(t+=", limit: "+this.limit),0<this.orderBy.length&&(t+=", orderBy: ["+this.orderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),"Target("+t+")"},Qo.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(var n=0;n<this.filters.length;n++)if(!this.filters[n].isEqual(t.filters[n]))return!1;return this.collectionGroup===t.collectionGroup&&!!this.path.isEqual(t.path)&&!!(null!==this.startAt?this.startAt.isEqual(t.startAt):null===t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)},Qo.prototype.Ot=function(){return Xr.et(this.path)&&null===this.collectionGroup&&0===this.filters.length},Qo),Ao=(Wo.Wt=function(t){return new Wo(t)},Object.defineProperty(Wo.prototype,"orderBy",{get:function(){if(null===this.qt){this.qt=[];var t=this.jt(),e=this.Kt();if(null!==t&&null===e)t.Y()||this.qt.push(new Po(t)),this.qt.push(new Po(Kr.J(),"asc"));else{for(var n=!1,r=0,i=this.xt;r<i.length;r++){var o=i[r];this.qt.push(o),o.field.Y()&&(n=!0)}if(!n){var s=0<this.xt.length?this.xt[this.xt.length-1].dir:"asc";this.qt.push(new Po(Kr.J(),s))}}}return this.qt},enumerable:!0,configurable:!0}),Wo.prototype.Gt=function(t){var e=this.filters.concat([t]);return new Wo(this.path,this.collectionGroup,this.xt.slice(),e,this.limit,this.Bt,this.startAt,this.endAt)},Wo.prototype.zt=function(t){var e=this.xt.concat([t]);return new Wo(this.path,this.collectionGroup,e,this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Wo.prototype.Ht=function(t){return new Wo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),t,"F",this.startAt,this.endAt)},Wo.prototype.Yt=function(t){return new Wo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),t,"L",this.startAt,this.endAt)},Wo.prototype.Jt=function(t){return new Wo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,t,this.endAt)},Wo.prototype.Xt=function(t){return new Wo(this.path,this.collectionGroup,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,t)},Wo.prototype.Zt=function(t){return new Wo(t,null,this.xt.slice(),this.filters.slice(),this.limit,this.Bt,this.startAt,this.endAt)},Wo.prototype.te=function(){return 0===this.filters.length&&null===this.limit&&null==this.startAt&&null==this.endAt&&(0===this.xt.length||1===this.xt.length&&this.xt[0].field.Y())},Wo.prototype.canonicalId=function(){return this.ee().canonicalId()+"|lt:"+this.Bt},Wo.prototype.toString=function(){return"Query(target="+this.ee().toString()+"; limitType="+this.Bt+")"},Wo.prototype.isEqual=function(t){return this.ee().isEqual(t.ee())&&this.Bt===t.Bt},Wo.prototype.se=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],s=o.compare(t,e);if(0!==s)return s;n=n||o.field.Y()}return 0},Wo.prototype.matches=function(t){return this.ie(t)&&this.ne(t)&&this.re(t)&&this.he(t)},Wo.prototype.oe=function(){return!ri(this.limit)&&"F"===this.Bt},Wo.prototype.ae=function(){return!ri(this.limit)&&"L"===this.Bt},Wo.prototype.Kt=function(){return 0<this.xt.length?this.xt[0].field:null},Wo.prototype.jt=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof So&&n.ue())return n.field}return null},Wo.prototype.ce=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof So&&0<=t.indexOf(r.op))return r.op}return null},Wo.prototype.Ot=function(){return this.ee().Ot()},Wo.prototype._e=function(){return null!==this.collectionGroup},Wo.prototype.ee=function(){if(!this.Ut)if("F"===this.Bt)this.Ut=new _o(this.path,this.collectionGroup,this.orderBy,this.filters,this.limit,this.startAt,this.endAt);else{for(var t=[],e=0,n=this.orderBy;e<n.length;e++){var r=n[e],i="desc"===r.dir?"asc":"desc";t.push(new Po(r.field,i))}var o=this.endAt?new Vo(this.endAt.position,!this.endAt.before):null,s=this.startAt?new Vo(this.startAt.position,!this.startAt.before):null;this.Ut=new _o(this.path,this.collectionGroup,t,this.filters,this.limit,o,s)}return this.Ut},Wo.prototype.ie=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.tt(this.collectionGroup)&&this.path.q(e):Xr.et(this.path)?this.path.isEqual(e):this.path.U(e)},Wo.prototype.ne=function(t){for(var e=0,n=this.xt;e<n.length;e++){var r=n[e];if(!r.field.Y()&&null===t.field(r.field))return!1}return!0},Wo.prototype.re=function(t){for(var e=0,n=this.filters;e<n.length;e++)if(!n[e].matches(t))return!1;return!0},Wo.prototype.he=function(t){return!(this.startAt&&!this.startAt.le(this.orderBy,t)||this.endAt&&this.endAt.le(this.orderBy,t))},Wo.prototype.Qt=function(t){},Wo),So=(s(zo,go=function(){}),zo.create=function(t,e,n){if(t.Y())return"in"===e?new ko(t,n):new Do(t,e,n);if(Ei(n)){if("=="!==e)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new zo(t,e,n)}if(Ti(n)){if("=="!==e)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new zo(t,e,n)}return"array-contains"===e?new xo(t,n):"in"===e?new Oo(t,n):"array-contains-any"===e?new Ro(t,n):new zo(t,e,n)},zo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&hi(this.value)===hi(e)&&this.de(li(e,this.value))},zo.prototype.de=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case">":return 0<t;case">=":return 0<=t;default:return Js()}},zo.prototype.ue=function(){return 0<=["<","<=",">",">="].indexOf(this.op)},zo.prototype.canonicalId=function(){return this.field.j()+this.op.toString()+di(this.value)},zo.prototype.isEqual=function(t){return t instanceof zo&&this.op===t.op&&this.field.isEqual(t.field)&&ci(this.value,t.value)},zo.prototype.toString=function(){return this.field.j()+" "+this.op+" "+di(this.value)},zo),Do=(s(Go,mo=So),Go.prototype.matches=function(t){var e=Xr.N(t.key,this.key);return this.de(e)},Go),ko=(s(Bo,vo=So),Bo.prototype.matches=function(t){return this.keys.some((function(e){return e.isEqual(t.key)}))},Bo),xo=(s(Fo,yo=So),Fo.prototype.matches=function(t){var e=t.field(this.field);return bi(e)&&fi(e.arrayValue,this.value)},Fo),Oo=(s(qo,po=So),qo.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&fi(this.value.arrayValue,e)},qo),Ro=(s(Uo,lo=So),Uo.prototype.matches=function(t){var e=this,n=t.field(this.field);return!(!bi(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(t){return fi(e.value.arrayValue,t)}))},Uo),Vo=(jo.prototype.canonicalId=function(){return(this.before?"b":"a")+":"+this.position.map((function(t){return di(t)})).join(",")},jo.prototype.le=function(t,e){for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(n=i.field.Y()?Xr.N(Xr.Z(o.referenceValue),e.key):li(o,e.field(i.field)),"desc"===i.dir&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},jo.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++)if(!ci(this.position[e],t.position[e]))return!1;return!0},jo),Po=(Mo.prototype.compare=function(t,e){var n,r,i,o,s=this.fe?Xr.N(t.key,e.key):(n=this.field,r=e,i=t.field(n),o=r.field(n),null!==i&&null!==o?li(i,o):Js());switch(this.dir){case"asc":return s;case"desc":return-1*s;default:return Js()}},Mo.prototype.canonicalId=function(){return this.field.j()+this.dir.toString()},Mo.prototype.toString=function(){return this.field.j()+" ("+this.dir+")"},Mo.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},Mo),Lo=(Co.prototype.Ie=function(t){return new Co(this.target,this.targetId,this.Te,t,this.Ee,this.lastLimboFreeSnapshotVersion,this.resumeToken)},Co.prototype.we=function(t,e){return new Co(this.target,this.targetId,this.Te,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t)},Co.prototype.Re=function(t){return new Co(this.target,this.targetId,this.Te,this.sequenceNumber,this.Ee,t,this.resumeToken)},Co);function Co(t,e,n,r,i,o,s){void 0===i&&(i=Pr.min()),void 0===o&&(o=Pr.min()),void 0===s&&(s=ei.ht),this.target=t,this.targetId=e,this.Te=n,this.sequenceNumber=r,this.Ee=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}function Mo(t,e){this.field=t,void 0===e&&(e="asc"),this.dir=e,this.fe=t.Y()}function jo(t,e){this.position=t,this.before=e}function Uo(t,e){return lo.call(this,t,"array-contains-any",e)||this}function qo(t,e){return po.call(this,t,"in",e)||this}function Fo(t,e){return yo.call(this,t,"array-contains",e)||this}function Bo(t,e){var n=this;return(n=vo.call(this,t,"in",e)||this).keys=(e.arrayValue.values||[]).map((function(t){return Xr.Z(t.referenceValue)})),n}function Go(t,e,n){var r=this;return(r=mo.call(this,t,e,n)||this).key=Xr.Z(n.referenceValue),r}function zo(t,e,n){var r=this;return(r=go.call(this)||this).field=t,r.op=e,r.value=n,r}function Wo(t,e,n,r,i,o,s,u){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===u&&(u=null),this.path=t,this.collectionGroup=e,this.xt=n,this.filters=r,this.limit=i,this.Bt=o,this.startAt=s,this.endAt=u,this.qt=null,this.Ut=null,this.startAt&&this.Qt(this.startAt),this.endAt&&this.Qt(this.endAt)}function Qo(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.Lt=null}function Ho(){return null!==wo&&wo.apply(this,arguments)||this}function Ko(t,e,n){var r=this;return(r=bo.call(this,t,e)||this).hasCommittedMutations=!(!n||!n.hasCommittedMutations),r}function Yo(t,e,n,r){var i=this;return(i=Eo.call(this,t,e)||this).kt=n,i.At=!!r.At,i.hasCommittedMutations=!!r.hasCommittedMutations,i}function Xo(t){switch(t){case Sr.OK:return Js();case Sr.CANCELLED:case Sr.UNKNOWN:case Sr.DEADLINE_EXCEEDED:case Sr.RESOURCE_EXHAUSTED:case Sr.INTERNAL:case Sr.UNAVAILABLE:case Sr.UNAUTHENTICATED:return;case Sr.INVALID_ARGUMENT:case Sr.NOT_FOUND:case Sr.ALREADY_EXISTS:case Sr.PERMISSION_DENIED:case Sr.FAILED_PRECONDITION:case Sr.ABORTED:case Sr.OUT_OF_RANGE:case Sr.UNIMPLEMENTED:case Sr.DATA_LOSS:return 1;default:return Js()}}function $o(t){if(void 0===t)return Xs("GRPC error has no .code"),Sr.UNKNOWN;switch(t){case co.OK:return Sr.OK;case co.CANCELLED:return Sr.CANCELLED;case co.UNKNOWN:return Sr.UNKNOWN;case co.DEADLINE_EXCEEDED:return Sr.DEADLINE_EXCEEDED;case co.RESOURCE_EXHAUSTED:return Sr.RESOURCE_EXHAUSTED;case co.INTERNAL:return Sr.INTERNAL;case co.UNAVAILABLE:return Sr.UNAVAILABLE;case co.UNAUTHENTICATED:return Sr.UNAUTHENTICATED;case co.INVALID_ARGUMENT:return Sr.INVALID_ARGUMENT;case co.NOT_FOUND:return Sr.NOT_FOUND;case co.ALREADY_EXISTS:return Sr.ALREADY_EXISTS;case co.PERMISSION_DENIED:return Sr.PERMISSION_DENIED;case co.FAILED_PRECONDITION:return Sr.FAILED_PRECONDITION;case co.ABORTED:return Sr.ABORTED;case co.OUT_OF_RANGE:return Sr.OUT_OF_RANGE;case co.UNIMPLEMENTED:return Sr.UNIMPLEMENTED;case co.DATA_LOSS:return Sr.DATA_LOSS;default:return Js()}}(fo=co=co||{})[fo.OK=0]="OK",fo[fo.CANCELLED=1]="CANCELLED",fo[fo.UNKNOWN=2]="UNKNOWN",fo[fo.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",fo[fo.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",fo[fo.NOT_FOUND=5]="NOT_FOUND",fo[fo.ALREADY_EXISTS=6]="ALREADY_EXISTS",fo[fo.PERMISSION_DENIED=7]="PERMISSION_DENIED",fo[fo.UNAUTHENTICATED=16]="UNAUTHENTICATED",fo[fo.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",fo[fo.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",fo[fo.ABORTED=10]="ABORTED",fo[fo.OUT_OF_RANGE=11]="OUT_OF_RANGE",fo[fo.UNIMPLEMENTED=12]="UNIMPLEMENTED",fo[fo.INTERNAL=13]="INTERNAL",fo[fo.UNAVAILABLE=14]="UNAVAILABLE",fo[fo.DATA_LOSS=15]="DATA_LOSS";var Jo=(rs.prototype.me=function(t,e){return new rs(this.N,this.root.me(t,e,this.N).Ae(null,null,ts.Pe,null,null))},rs.prototype.remove=function(t){return new rs(this.N,this.root.remove(t,this.N).Ae(null,null,ts.Pe,null,null))},rs.prototype.get=function(t){for(var e=this.root;!e.B();){var n=this.N(t,e.key);if(0===n)return e.value;n<0?e=e.left:0<n&&(e=e.right)}return null},rs.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.B();){var r=this.N(t,n.key);if(0===r)return e+n.left.size;n=r<0?n.left:(e+=n.left.size+1,n.right)}return-1},rs.prototype.B=function(){return this.root.B()},Object.defineProperty(rs.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),rs.prototype.Ve=function(){return this.root.Ve()},rs.prototype.ge=function(){return this.root.ge()},rs.prototype.pe=function(t){return this.root.pe(t)},rs.prototype.forEach=function(t){this.pe((function(e,n){return t(e,n),!1}))},rs.prototype.toString=function(){var t=[];return this.pe((function(e,n){return t.push(e+":"+n),!1})),"{"+t.join(", ")+"}"},rs.prototype.ye=function(t){return this.root.ye(t)},rs.prototype.be=function(){return new Zo(this.root,null,this.N,!1)},rs.prototype.ve=function(t){return new Zo(this.root,t,this.N,!1)},rs.prototype.Se=function(){return new Zo(this.root,null,this.N,!0)},rs.prototype.De=function(t){return new Zo(this.root,t,this.N,!0)},rs),Zo=(ns.prototype.Ne=function(){var t=this.Fe.pop(),e={key:t.key,value:t.value};if(this.Ce)for(t=t.left;!t.B();)this.Fe.push(t),t=t.right;else for(t=t.right;!t.B();)this.Fe.push(t),t=t.left;return e},ns.prototype.$e=function(){return 0<this.Fe.length},ns.prototype.ke=function(){if(0===this.Fe.length)return null;var t=this.Fe[this.Fe.length-1];return{key:t.key,value:t.value}},ns),ts=(es.prototype.Ae=function(t,e,n,r,i){return new es(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)},es.prototype.B=function(){return!1},es.prototype.pe=function(t){return this.left.pe(t)||t(this.key,this.value)||this.right.pe(t)},es.prototype.ye=function(t){return this.right.ye(t)||t(this.key,this.value)||this.left.ye(t)},es.prototype.min=function(){return this.left.B()?this:this.left.min()},es.prototype.Ve=function(){return this.min().key},es.prototype.ge=function(){return this.right.B()?this.key:this.right.ge()},es.prototype.me=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.Ae(null,null,null,r.left.me(t,e,n),null):0===i?r.Ae(null,e,null,null,null):r.Ae(null,null,null,null,r.right.me(t,e,n))).Me()},es.prototype.Le=function(){if(this.left.B())return es.EMPTY;var t=this;return t.left.Oe()||t.left.left.Oe()||(t=t.xe()),(t=t.Ae(null,null,null,t.left.Le(),null)).Me()},es.prototype.remove=function(t,e){var n,r=this;if(e(t,r.key)<0)r.left.B()||r.left.Oe()||r.left.left.Oe()||(r=r.xe()),r=r.Ae(null,null,null,r.left.remove(t,e),null);else{if(r.left.Oe()&&(r=r.Be()),r.right.B()||r.right.Oe()||r.right.left.Oe()||(r=r.qe()),0===e(t,r.key)){if(r.right.B())return es.EMPTY;n=r.right.min(),r=r.Ae(n.key,n.value,null,null,r.right.Le())}r=r.Ae(null,null,null,null,r.right.remove(t,e))}return r.Me()},es.prototype.Oe=function(){return this.color},es.prototype.Me=function(){var t=this;return t.right.Oe()&&!t.left.Oe()&&(t=t.Ue()),t.left.Oe()&&t.left.left.Oe()&&(t=t.Be()),t.left.Oe()&&t.right.Oe()&&(t=t.Qe()),t},es.prototype.xe=function(){var t=this.Qe();return t.right.left.Oe()&&(t=(t=(t=t.Ae(null,null,null,null,t.right.Be())).Ue()).Qe()),t},es.prototype.qe=function(){var t=this.Qe();return t.left.left.Oe()&&(t=(t=t.Be()).Qe()),t},es.prototype.Ue=function(){var t=this.Ae(null,null,es.RED,null,this.right.left);return this.right.Ae(null,null,this.color,t,null)},es.prototype.Be=function(){var t=this.Ae(null,null,es.RED,this.left.right,null);return this.left.Ae(null,null,this.color,null,t)},es.prototype.Qe=function(){var t=this.left.Ae(null,null,!this.left.color,null,null),e=this.right.Ae(null,null,!this.right.color,null,null);return this.Ae(null,null,!this.color,t,e)},es.prototype.We=function(){var t=this.je();return Math.pow(2,t)<=this.size+1},es.prototype.je=function(){if(this.Oe()&&this.left.Oe())throw Js();if(this.right.Oe())throw Js();var t=this.left.je();if(t!==this.right.je())throw Js();return t+(this.Oe()?0:1)},es);function es(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:es.RED,this.left=null!=r?r:es.EMPTY,this.right=null!=i?i:es.EMPTY,this.size=this.left.size+1+this.right.size}function ns(t,e,n,r){this.Ce=r,this.Fe=[];for(var i=1;!t.B();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.Ce?t.left:t.right;else{if(0===i){this.Fe.push(t);break}this.Fe.push(t),t=this.Ce?t.right:t.left}}function rs(t,e){this.N=t,this.root=e||ts.EMPTY}function is(){this.size=0}ts.EMPTY=null,ts.RED=!0,ts.Pe=!1,ts.EMPTY=(Object.defineProperty(is.prototype,"key",{get:function(){throw Js()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"value",{get:function(){throw Js()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"color",{get:function(){throw Js()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"left",{get:function(){throw Js()},enumerable:!0,configurable:!0}),Object.defineProperty(is.prototype,"right",{get:function(){throw Js()},enumerable:!0,configurable:!0}),is.prototype.Ae=function(t,e,n,r,i){return this},is.prototype.me=function(t,e,n){return new ts(t,e)},is.prototype.remove=function(t,e){return this},is.prototype.B=function(){return!0},is.prototype.pe=function(t){return!1},is.prototype.ye=function(t){return!1},is.prototype.Ve=function(){return null},is.prototype.ge=function(){return null},is.prototype.Oe=function(){return!1},is.prototype.We=function(){return!0},is.prototype.je=function(){return 0},new is);var os=(hs.prototype.has=function(t){return null!==this.data.get(t)},hs.prototype.first=function(){return this.data.Ve()},hs.prototype.last=function(){return this.data.ge()},Object.defineProperty(hs.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),hs.prototype.indexOf=function(t){return this.data.indexOf(t)},hs.prototype.forEach=function(t){this.data.pe((function(e,n){return t(e),!1}))},hs.prototype.Ke=function(t,e){for(var n=this.data.ve(t[0]);n.$e();){var r=n.Ne();if(0<=this.N(r.key,t[1]))return;e(r.key)}},hs.prototype.Ge=function(t,e){var n;for(n=void 0!==e?this.data.ve(e):this.data.be();n.$e();)if(!t(n.Ne().key))return},hs.prototype.ze=function(t){var e=this.data.ve(t);return e.$e()?e.Ne().key:null},hs.prototype.be=function(){return new ss(this.data.be())},hs.prototype.ve=function(t){return new ss(this.data.ve(t))},hs.prototype.add=function(t){return this.Ae(this.data.remove(t).me(t,!0))},hs.prototype.delete=function(t){return this.has(t)?this.Ae(this.data.remove(t)):this},hs.prototype.B=function(){return this.data.B()},hs.prototype.He=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach((function(t){e=e.add(t)})),e},hs.prototype.isEqual=function(t){if(!(t instanceof hs))return!1;if(this.size!==t.size)return!1;for(var e=this.data.be(),n=t.data.be();e.$e();){var r=e.Ne().key,i=n.Ne().key;if(0!==this.N(r,i))return!1}return!0},hs.prototype.W=function(){var t=[];return this.forEach((function(e){t.push(e)})),t},hs.prototype.toString=function(){var t=[];return this.forEach((function(e){return t.push(e)})),"SortedSet("+t.toString()+")"},hs.prototype.Ae=function(t){var e=new hs(this.N);return e.data=t,e},hs),ss=(as.prototype.Ne=function(){return this.Ye.Ne().key},as.prototype.$e=function(){return this.Ye.$e()},as),us=new Jo(Xr.N);function as(t){this.Ye=t}function hs(t){this.N=t,this.data=new Jo(this.N)}function cs(){return us}function fs(){return cs()}var ls=new Jo(Xr.N);function ps(){return ls}var ds=new Jo(Xr.N);function ys(){return ds}var vs=new os(Xr.N);function ms(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=vs,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var gs=new os(nu);function ws(){return gs}function bs(t,e,n,r){this.ws=t,this.removedTargetIds=e,this.key=n,this.Rs=r}function Es(t,e){this.targetId=t,this.ms=e}function Ts(t,e,n,r){void 0===n&&(n=ei.ht),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}var Is=(Cs.Ze=function(t){return new Cs(t.N)},Cs.prototype.has=function(t){return null!=this.Je.get(t)},Cs.prototype.get=function(t){return this.Je.get(t)},Cs.prototype.first=function(){return this.Xe.Ve()},Cs.prototype.last=function(){return this.Xe.ge()},Cs.prototype.B=function(){return this.Xe.B()},Cs.prototype.indexOf=function(t){var e=this.Je.get(t);return e?this.Xe.indexOf(e):-1},Object.defineProperty(Cs.prototype,"size",{get:function(){return this.Xe.size},enumerable:!0,configurable:!0}),Cs.prototype.forEach=function(t){this.Xe.pe((function(e,n){return t(e),!1}))},Cs.prototype.add=function(t){var e=this.delete(t.key);return e.Ae(e.Je.me(t.key,t),e.Xe.me(t,null))},Cs.prototype.delete=function(t){var e=this.get(t);return e?this.Ae(this.Je.remove(t),this.Xe.remove(e)):this},Cs.prototype.isEqual=function(t){if(!(t instanceof Cs))return!1;if(this.size!==t.size)return!1;for(var e=this.Xe.be(),n=t.Xe.be();e.$e();){var r=e.Ne().key,i=n.Ne().key;if(!r.isEqual(i))return!1}return!0},Cs.prototype.toString=function(){var t=[];return this.forEach((function(e){t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},Cs.prototype.Ae=function(t,e){var n=new Cs;return n.N=this.N,n.Je=t,n.Xe=e,n},Cs),Ns=(Ls.prototype.track=function(t){var e=t.doc.key,n=this.ts.get(e);!n||0!==t.type&&3===n.type?this.ts=this.ts.me(e,t):3===t.type&&1!==n.type?this.ts=this.ts.me(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.ts=this.ts.me(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.ts=this.ts.me(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.ts=this.ts.remove(e):1===t.type&&2===n.type?this.ts=this.ts.me(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.ts=this.ts.me(e,{type:2,doc:t.doc}):Js()},Ls.prototype.es=function(){var t=[];return this.ts.pe((function(e,n){t.push(n)})),t},Ls),_s=(Ps.os=function(t,e,n,r){var i=[];return e.forEach((function(t){i.push({type:0,doc:t})})),new Ps(t,e,Is.Ze(e),i,n,r,!0,!1)},Object.defineProperty(Ps.prototype,"hasPendingWrites",{get:function(){return!this.ns.B()},enumerable:!0,configurable:!0}),Ps.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.rs===t.rs&&this.ns.isEqual(t.ns)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.ss.isEqual(t.ss)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},Ps),As=(Vs.ls=function(t,e){var n=new Map;return n.set(t,Ss.ds(t,e)),new Vs(Pr.min(),n,ws(),cs(),ms())},Vs),Ss=(Rs.ds=function(t,e){return new Rs(ei.ht,e,ms(),ms(),ms())},Rs),Ds=(Object.defineProperty(Os.prototype,"fs",{get:function(){return this.gs},enumerable:!0,configurable:!0}),Object.defineProperty(Os.prototype,"resumeToken",{get:function(){return this.Vs},enumerable:!0,configurable:!0}),Object.defineProperty(Os.prototype,"ys",{get:function(){return 0!==this.As},enumerable:!0,configurable:!0}),Object.defineProperty(Os.prototype,"bs",{get:function(){return this.ps},enumerable:!0,configurable:!0}),Os.prototype.vs=function(t){0<t.rt()&&(this.ps=!0,this.Vs=t)},Os.prototype.Ss=function(){var t=ms(),e=ms(),n=ms();return this.Ps.forEach((function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Js()}})),new Ss(this.Vs,this.gs,t,e,n)},Os.prototype.Ds=function(){this.ps=!1,this.Ps=js()},Os.prototype.Cs=function(t,e){this.ps=!0,this.Ps=this.Ps.me(t,e)},Os.prototype.Fs=function(t){this.ps=!0,this.Ps=this.Ps.remove(t)},Os.prototype.Ns=function(){this.As+=1},Os.prototype.$s=function(){--this.As},Os.prototype.ks=function(){this.ps=!0,this.gs=!0},Os),ks=(xs.prototype.qs=function(t){for(var e=0,n=t.ws;e<n.length;e++){var r=n[e];t.Rs instanceof To?this.Us(r,t.Rs):t.Rs instanceof Io&&this.Qs(r,t.key,t.Rs)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){var s=o[i];this.Qs(s,t.key,t.Rs)}},xs.prototype.Ws=function(t){var e=this;this.js(t,(function(n){var r=e.Ks(n);switch(t.state){case 0:e.Gs(n)&&r.vs(t.resumeToken);break;case 1:r.$s(),r.ys||r.Ds(),r.vs(t.resumeToken);break;case 2:r.$s(),r.ys||e.removeTarget(n);break;case 3:e.Gs(n)&&(r.ks(),r.vs(t.resumeToken));break;case 4:e.Gs(n)&&(e.zs(n),r.vs(t.resumeToken));break;default:Js()}}))},xs.prototype.js=function(t,e){var n=this;0<t.targetIds.length?t.targetIds.forEach(e):this.Ls.forEach((function(t,r){n.Gs(r)&&e(r)}))},xs.prototype.Hs=function(t){var e=t.targetId,n=t.ms.count,r=this.Ys(e);if(r){var i=r.target;if(i.Ot())if(0===n){var o=new Xr(i.path);this.Qs(e,o,new Io(o,Pr.min()))}else Zs(1===n);else this.Js(e)!==n&&(this.zs(e),this.Bs=this.Bs.add(e))}},xs.prototype.Xs=function(t){var e=this,n=new Map;this.Ls.forEach((function(r,i){var o=e.Ys(i);if(o){if(r.fs&&o.target.Ot()){var s=new Xr(o.target.path);null!==e.Os.get(s)||e.Zs(i,s)||e.Qs(i,s,new Io(s,t))}r.bs&&(n.set(i,r.Ss()),r.Ds())}}));var r=ms();this.xs.forEach((function(t,n){var i=!0;n.Ge((function(t){var n=e.Ys(t);return!n||2===n.Te||(i=!1)})),i&&(r=r.add(t))}));var i=new As(t,n,this.Bs,this.Os,r);return this.Os=cs(),this.xs=Ms(),this.Bs=new os(nu),i},xs.prototype.Us=function(t,e){if(this.Gs(t)){var n=this.Zs(t,e.key)?2:0;this.Ks(t).Cs(e.key,n),this.Os=this.Os.me(e.key,e),this.xs=this.xs.me(e.key,this.ti(e.key).add(t))}},xs.prototype.Qs=function(t,e,n){if(this.Gs(t)){var r=this.Ks(t);this.Zs(t,e)?r.Cs(e,1):r.Fs(e),this.xs=this.xs.me(e,this.ti(e).delete(t)),n&&(this.Os=this.Os.me(e,n))}},xs.prototype.removeTarget=function(t){this.Ls.delete(t)},xs.prototype.Js=function(t){var e=this.Ks(t).Ss();return this.Ms.ei(t).size+e.Ts.size-e.Is.size},xs.prototype.Ns=function(t){this.Ks(t).Ns()},xs.prototype.Ks=function(t){var e=this.Ls.get(t);return e||(e=new Ds,this.Ls.set(t,e)),e},xs.prototype.ti=function(t){var e=this.xs.get(t);return e||(e=new os(nu),this.xs=this.xs.me(t,e)),e},xs.prototype.Gs=function(t){var e=null!==this.Ys(t);return e||Ys("WatchChangeAggregator","Detected inactive target",t),e},xs.prototype.Ys=function(t){var e=this.Ls.get(t);return e&&e.ys?null:this.Ms.si(t)},xs.prototype.zs=function(t){var e=this;this.Ls.set(t,new Ds),this.Ms.ei(t).forEach((function(n){e.Qs(t,n,null)}))},xs.prototype.Zs=function(t,e){return this.Ms.ei(t).has(e)},xs);function xs(t){this.Ms=t,this.Ls=new Map,this.Os=cs(),this.xs=Ms(),this.Bs=new os(nu)}function Os(){this.As=0,this.Ps=js(),this.Vs=ei.ht,this.gs=!1,this.ps=!0}function Rs(t,e,n,r,i){this.resumeToken=t,this.fs=e,this.Ts=n,this.Es=r,this.Is=i}function Vs(t,e,n,r,i){this.Ee=t,this.as=e,this.us=n,this.cs=r,this._s=i}function Ps(t,e,n,r,i,o,s,u){this.query=t,this.docs=e,this.ss=n,this.docChanges=r,this.ns=i,this.fromCache=o,this.rs=s,this.hs=u}function Ls(){this.ts=new Jo(Xr.N)}function Cs(t){this.N=t?function(e,n){return t(e,n)||Xr.N(e.key,n.key)}:function(t,e){return Xr.N(t.key,e.key)},this.Je=ps(),this.Xe=new Jo(this.N)}function Ms(){return new Jo(Xr.N)}function js(){return new Jo(Xr.N)}var Us={asc:"ASCENDING",desc:"DESCENDING"},qs={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Fs=(Bs.prototype.ni=function(t){var e=void 0===t.code?Sr.UNKNOWN:$o(t.code);return new Dr(e,t.message||"")},Bs.prototype.ri=function(t){return this.options.hi||ri(t)?t:{value:t}},Bs.prototype.oi=function(t){var e;return ri(e="object"==typeof t?t.value:t)?null:e},Bs.prototype._t=function(t){return{integerValue:""+t}},Bs.prototype.lt=function(t){if(this.options.hi){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ii(t)?"-0":t}},Bs.prototype.ai=function(t){return oi(t)?this._t(t):this.lt(t)},Bs.prototype.C=function(t){return this.options.hi?new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+t.nanoseconds).slice(-9)+"Z":{seconds:""+t.seconds,nanos:t.nanoseconds}},Bs.prototype.v=function(t){var e=yi(t);return new Vr(e.seconds,e.nanos)},Bs.prototype.ui=function(t){return this.options.hi?t.toBase64():t.toUint8Array()},Bs.prototype.ci=function(t){return this.options.hi?(Zs(void 0===t||"string"==typeof t),ei.fromBase64String(t||"")):(Zs(void 0===t||t instanceof Uint8Array),ei.fromUint8Array(t||new Uint8Array))},Bs.prototype.toVersion=function(t){return this.C(t.C())},Bs.prototype.fromVersion=function(t){return Zs(!!t),Pr.v(this.v(t))},Bs.prototype._i=function(t,e){return this.li(e||this.ii).child("documents").child(t).j()},Bs.prototype.di=function(t){var e=Cr.K(t);return Zs(Gs(e)),e},Bs.prototype.fi=function(t){return this._i(t.path)},Bs.prototype.Z=function(t){var e=this.di(t);return Zs(e.get(1)===this.ii.projectId),Zs(!e.get(3)&&!this.ii.database||e.get(3)===this.ii.database),new Xr(this.Ti(e))},Bs.prototype.Ei=function(t){return this._i(t)},Bs.prototype.Ii=function(t){var e=this.di(t);return 4===e.length?Cr.G:this.Ti(e)},Object.defineProperty(Bs.prototype,"wi",{get:function(){return new Cr(["projects",this.ii.projectId,"databases",this.ii.database]).j()},enumerable:!0,configurable:!0}),Bs.prototype.li=function(t){return new Cr(["projects",t.projectId,"databases",t.database])},Bs.prototype.Ti=function(t){return Zs(4<t.length&&"documents"===t.get(4)),t.k(5)},Bs.prototype.Ri=function(t,e){return{name:this.fi(t),fields:e.proto.mapValue.fields}},Bs.prototype.mi=function(t){return{name:this.fi(t.key),fields:t.Mt().mapValue.fields,updateTime:this.C(t.version.C())}},Bs.prototype.Ai=function(t,e){var n=this.Z(t.name),r=this.fromVersion(t.updateTime),i=new Ki({mapValue:{fields:t.fields}});return new To(n,r,i,{hasCommittedMutations:!!e})},Bs.prototype.Pi=function(t){Zs(!!t.found),t.found.name,t.found.updateTime;var e=this.Z(t.found.name),n=this.fromVersion(t.found.updateTime),r=new Ki({mapValue:{fields:t.found.fields}});return new To(e,n,r,{})},Bs.prototype.Vi=function(t){Zs(!!t.missing),Zs(!!t.readTime);var e=this.Z(t.missing),n=this.fromVersion(t.readTime);return new Io(e,n)},Bs.prototype.gi=function(t){return"found"in t?this.Pi(t):"missing"in t?this.Vi(t):Js()},Bs.prototype.pi=function(t){var e;if("targetChange"in t){t.targetChange;var n=this.yi(t.targetChange.targetChangeType||"NO_CHANGE"),r=t.targetChange.targetIds||[],i=this.ci(t.targetChange.resumeToken),o=t.targetChange.cause;e=new Ts(n,r,i,o&&this.ni(o)||null)}else if("documentChange"in t){t.documentChange;var s=t.documentChange;s.document,s.document.name,s.document.updateTime;var u=this.Z(s.document.name),a=this.fromVersion(s.document.updateTime),h=new Ki({mapValue:{fields:s.document.fields}}),c=new To(u,a,h,{});e=new bs(s.targetIds||[],s.removedTargetIds||[],c.key,c)}else if("documentDelete"in t){t.documentDelete;var f=t.documentDelete;f.document;var l=this.Z(f.document),p=f.readTime?this.fromVersion(f.readTime):Pr.min(),d=new Io(l,p);e=new bs([],f.removedTargetIds||[],d.key,d)}else if("documentRemove"in t){t.documentRemove;var y=t.documentRemove;y.document;var v=this.Z(y.document);e=new bs([],y.removedTargetIds||[],v,null)}else{if(!("filter"in t))return Js();t.filter;var m=t.filter;m.targetId;var g=new ho(m.count||0);e=new Es(m.targetId,g)}return e},Bs.prototype.yi=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Js()},Bs.prototype.bi=function(t){if(!("targetChange"in t))return Pr.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?Pr.min():this.fromVersion(e.readTime)},Bs.prototype.vi=function(t){var e,n=this;if(t instanceof Gi)e={update:this.Ri(t.key,t.value)};else if(t instanceof Qi)e={delete:this.fi(t.key)};else if(t instanceof zi)e={update:this.Ri(t.key,t.data),updateMask:this.Si(t.Vt)};else if(t instanceof Wi)e={transform:{document:this.fi(t.key),fieldTransforms:t.fieldTransforms.map((function(t){return n.Di(t)}))}};else{if(!(t instanceof Hi))return Js();e={verify:this.fi(t.key)}}return t.Rt.Tt||(e.currentDocument=this.Ci(t.Rt)),e},Bs.prototype.Fi=function(t){var e=this,n=t.currentDocument?this.Ni(t.currentDocument):Fi.ft();if(t.update){t.update.name;var r=this.Z(t.update.name),i=new Ki({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=this.$i(t.updateMask);return new zi(r,i,o,n)}return new Gi(r,i,n)}if(t.delete){var s=this.Z(t.delete);return new Qi(s,n)}if(t.transform){var u=this.Z(t.transform.document),a=t.transform.fieldTransforms.map((function(t){return e.ki(t)}));return Zs(!0===n.exists),new Wi(u,a)}if(t.verify){var h=this.Z(t.verify);return new Hi(h,n)}return Js()},Bs.prototype.Ci=function(t){return void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Js()},Bs.prototype.Ni=function(t){return void 0!==t.updateTime?Fi.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?Fi.exists(t.exists):Fi.ft()},Bs.prototype.Mi=function(t,e){var n=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e);n.isEqual(Pr.min())&&(n=this.fromVersion(e));var r=null;return t.transformResults&&0<t.transformResults.length&&(r=t.transformResults),new Vi(n,r)},Bs.prototype.Li=function(t,e){var n=this;return t&&0<t.length?(Zs(void 0!==e),t.map((function(t){return n.Mi(t,e)}))):[]},Bs.prototype.Di=function(t){var e=t.transform;if(e instanceof Ni)return{fieldPath:t.field.j(),setToServerValue:"REQUEST_TIME"};if(e instanceof Ai)return{fieldPath:t.field.j(),appendMissingElements:{values:e.elements}};if(e instanceof Si)return{fieldPath:t.field.j(),removeAllFromArray:{values:e.elements}};if(e instanceof Di)return{fieldPath:t.field.j(),increment:e.ct};throw Js()},Bs.prototype.ki=function(t){var e=null;if("setToServerValue"in t)Zs("REQUEST_TIME"===t.setToServerValue),e=Ni.instance;else if("appendMissingElements"in t){var n=t.appendMissingElements.values||[];e=new Ai(n)}else if("removeAllFromArray"in t){var r=t.removeAllFromArray.values||[];e=new Si(r)}else"increment"in t?e=new Di(this,t.increment):Js();var i=Kr.X(t.fieldPath);return new qi(i,e)},Bs.prototype.Oi=function(t){return{documents:[this.Ei(t.path)]}},Bs.prototype.xi=function(t){Zs(1===t.documents.length);var e=t.documents[0];return Ao.Wt(this.Ii(e)).ee()},Bs.prototype.Bi=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(e.parent=this.Ei(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(e.parent=this.Ei(n.M()),e.structuredQuery.from=[{collectionId:n.O()}]);var r=this.qi(t.filters);r&&(e.structuredQuery.where=r);var i=this.Ui(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.ri(t.limit);return null!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.Qi(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.Qi(t.endAt)),e},Bs.prototype.Wi=function(t){var e=this.Ii(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(0<r){Zs(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=this.ji(n.where));var u=[];n.orderBy&&(u=this.Ki(n.orderBy));var a=null;n.limit&&(a=this.oi(n.limit));var h=null;n.startAt&&(h=this.Gi(n.startAt));var c=null;return n.endAt&&(c=this.Gi(n.endAt)),new Ao(e,i,u,s,a,"F",h,c).ee()},Bs.prototype.zi=function(t){var e=this.Hi(t.Te);return null==e?null:{"goog-listen-tags":e}},Bs.prototype.Hi=function(t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Js()}},Bs.prototype.ee=function(t){var e,n=t.target;return(e=n.Ot()?{documents:this.Oi(n)}:{query:this.Bi(n)}).targetId=t.targetId,0<t.resumeToken.rt()&&(e.resumeToken=this.ui(t.resumeToken)),e},Bs.prototype.qi=function(t){var e=this;if(0!==t.length){var n=t.map((function(t){return t instanceof So?e.Yi(t):Js()}));return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},Bs.prototype.ji=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.Ji(t)]:void 0!==t.fieldFilter?[this.Xi(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map((function(t){return e.ji(t)})).reduce((function(t,e){return t.concat(e)})):Js():[]},Bs.prototype.Ui=function(t){var e=this;if(0!==t.length)return t.map((function(t){return e.Zi(t)}))},Bs.prototype.Ki=function(t){var e=this;return t.map((function(t){return e.tn(t)}))},Bs.prototype.Qi=function(t){return{before:t.before,values:t.position}},Bs.prototype.Gi=function(t){var e=!!t.before,n=t.values||[];return new Vo(n,e)},Bs.prototype.en=function(t){return Us[t]},Bs.prototype.sn=function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}},Bs.prototype.nn=function(t){return qs[t]},Bs.prototype.rn=function(t){switch(t){case"EQUAL":return"==";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Js()}},Bs.prototype.hn=function(t){return{fieldPath:t.j()}},Bs.prototype.on=function(t){return Kr.X(t.fieldPath)},Bs.prototype.Zi=function(t){return{field:this.hn(t.field),direction:this.en(t.dir)}},Bs.prototype.tn=function(t){return new Po(this.on(t.field),this.sn(t.direction))},Bs.prototype.Xi=function(t){return So.create(this.on(t.fieldFilter.field),this.rn(t.fieldFilter.op),t.fieldFilter.value)},Bs.prototype.Yi=function(t){if("=="===t.op){if(Ti(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NAN"}};if(Ei(t.value))return{unaryFilter:{field:this.hn(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.hn(t.field),op:this.nn(t.op),value:t.value}}},Bs.prototype.Ji=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.on(t.unaryFilter.field);return So.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=this.on(t.unaryFilter.field);return So.create(n,"==",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Js()}},Bs.prototype.Si=function(t){var e=[];return t.fields.forEach((function(t){return e.push(t.j())})),{fieldPaths:e}},Bs.prototype.$i=function(t){var e=t.fieldPaths||[];return new Ui(e.map((function(t){return Kr.X(t)})))},Bs);function Bs(t,e){this.ii=t,this.options=e}function Gs(t){return 4<=t.length&&"projects"===t.get(0)&&"databases"===t.get(2)}var zs=(Qs.an=function(t){Qs.platform&&Js(),Qs.platform=t},Qs.nt=function(){return Qs.platform||Js(),Qs.platform},Qs),Ws=new d("@firebase/firestore");function Qs(){}function Hs(){return Ws.logLevel}function Ks(t){Ws.logLevel=t}function Ys(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Ws.logLevel<=r.DEBUG){var i=e.map($s);Ws.debug.apply(Ws,h(["Firestore ("+Er+"): "+t],i))}}function Xs(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Ws.logLevel<=r.ERROR){var i=e.map($s);Ws.error.apply(Ws,h(["Firestore ("+Er+"): "+t],i))}}function $s(t){if("string"==typeof t)return t;var e=zs.nt();try{return e.un(t)}catch(e){return t}}function Js(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE ("+Er+") INTERNAL ASSERTION FAILED: "+t;throw Xs(e),new Error(e)}function Zs(t){t||Js()}var tu=(eu.cn=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=zs.nt()._n(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},eu);function eu(){}function nu(t,e){return t<e?-1:e<t?1:0}function ru(t,e,n){return t.length===e.length&&t.every((function(t,r){return n(t,e[r])}))}function iu(t){return t+"\0"}function ou(t,e,n,r,i){this.ii=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}var su=(Object.defineProperty(Au.prototype,"ln",{get:function(){return"(default)"===this.database},enumerable:!0,configurable:!0}),Au.prototype.isEqual=function(t){return t instanceof Au&&t.projectId===this.projectId&&t.database===this.database},Au.prototype.S=function(t){return nu(this.projectId,t.projectId)||nu(this.database,t.database)},Au),uu=(_u.prototype.get=function(t){var e=this.dn(t),n=this.fn[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];if(s.isEqual(t))return u}},_u.prototype.has=function(t){return void 0!==this.get(t)},_u.prototype.set=function(t,e){var n=this.dn(t),r=this.fn[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.fn[n]=[[t,e]]},_u.prototype.delete=function(t){var e=this.dn(t),n=this.fn[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.fn[e]:n.splice(r,1),!0;return!1},_u.prototype.forEach=function(t){Zr(this.fn,(function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[0],u=o[1];t(s,u)}}))},_u.prototype.B=function(){return ti(this.fn)},_u),au=(Nu.prototype.at=function(t,e,n){for(var r=n.En,i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var s=r[i];e=o.at(e,s)}}return e},Nu.prototype.ot=function(t,e){for(var n=0,r=this.baseMutations;n<r.length;n++){var i=r[n];i.key.isEqual(t)&&(e=i.ot(e,e,this.Tn))}for(var o=e,s=0,u=this.mutations;s<u.length;s++){var a=u[s];a.key.isEqual(t)&&(e=a.ot(e,o,this.Tn))}return e},Nu.prototype.In=function(t){var e=this,n=t;return this.mutations.forEach((function(r){var i=e.ot(r.key,t.get(r.key));i&&(n=n.me(r.key,i))})),n},Nu.prototype.keys=function(){return this.mutations.reduce((function(t,e){return t.add(e.key)}),ms())},Nu.prototype.isEqual=function(t){return this.batchId===t.batchId&&ru(this.mutations,t.mutations,(function(t,e){return t.isEqual(e)}))&&ru(this.baseMutations,t.baseMutations,(function(t,e){return t.isEqual(e)}))},Nu),hu=(Iu.from=function(t,e,n,r){Zs(t.mutations.length===n.length);for(var i=ys(),o=t.mutations,s=0;s<o.length;s++)i=i.me(o[s].key,n[s].version);return new Iu(t,e,n,r,i)},Iu),cu=(Tu.prototype.catch=function(t){return this.next(void 0,t)},Tu.prototype.next=function(t,e){var n=this;return this.Vn&&Js(),this.Vn=!0,this.Pn?this.error?this.gn(e,this.error):this.pn(t,this.result):new Tu((function(r,i){n.mn=function(e){n.pn(t,e).next(r,i)},n.An=function(t){n.gn(e,t).next(r,i)}}))},Tu.prototype.yn=function(){var t=this;return new Promise((function(e,n){t.next(e,n)}))},Tu.prototype.bn=function(t){try{var e=t();return e instanceof Tu?e:Tu.resolve(e)}catch(t){return Tu.reject(t)}},Tu.prototype.pn=function(t,e){return t?this.bn((function(){return t(e)})):Tu.resolve(e)},Tu.prototype.gn=function(t,e){return t?this.bn((function(){return t(e)})):Tu.reject(e)},Tu.resolve=function(t){return new Tu((function(e,n){e(t)}))},Tu.reject=function(t){return new Tu((function(e,n){n(t)}))},Tu.vn=function(t){return new Tu((function(e,n){var r=0,i=0,o=!1;t.forEach((function(t){++r,t.next((function(){++i,o&&i===r&&e()}),(function(t){return n(t)}))})),o=!0,i===r&&e()}))},Tu.Sn=function(t){for(var e=Tu.resolve(!1),n=function(t){e=e.next((function(e){return e?Tu.resolve(e):t()}))},r=0,i=t;r<i.length;r++)n(i[r]);return e},Tu.forEach=function(t,e){var n=this,r=[];return t.forEach((function(t,i){r.push(e.call(n,t,i))})),this.vn(r)},Tu),fu=(Object.defineProperty(Eu.prototype,"readTime",{get:function(){return this.Fn},set:function(t){this.Fn=t},enumerable:!0,configurable:!0}),Eu.prototype.Nn=function(t,e){this.$n(),this.readTime=e,this.Dn.set(t.key,t)},Eu.prototype.kn=function(t,e){this.$n(),e&&(this.readTime=e),this.Dn.set(t,null)},Eu.prototype.Mn=function(t,e){this.$n();var n=this.Dn.get(e);return void 0!==n?cu.resolve(n):this.Ln(t,e)},Eu.prototype.getEntries=function(t,e){return this.On(t,e)},Eu.prototype.apply=function(t){return this.$n(),this.Cn=!0,this.xn(t)},Eu.prototype.$n=function(){},Eu),lu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",pu=(bu.prototype.qn=function(t){this.Bn.push(t)},bu.prototype.Un=function(){this.Bn.forEach((function(t){return t()}))},bu),du=(wu.prototype.Kn=function(t,e){var n=this;return this.Wn.Gn(t,e).next((function(r){return n.zn(t,e,r)}))},wu.prototype.zn=function(t,e,n){return this.Qn.Mn(t,e).next((function(t){for(var r=0,i=n;r<i.length;r++)t=i[r].ot(e,t);return t}))},wu.prototype.Hn=function(t,e,n){var r=fs();return e.forEach((function(t,e){for(var i=0,o=n;i<o.length;i++)e=o[i].ot(t,e);r=r.me(t,e)})),r},wu.prototype.Yn=function(t,e){var n=this;return this.Qn.getEntries(t,e).next((function(e){return n.Jn(t,e)}))},wu.prototype.Jn=function(t,e){var n=this;return this.Wn.Xn(t,e).next((function(r){var i=n.Hn(t,e,r),o=cs();return i.forEach((function(t,e){e=e||new Io(t,Pr.min()),o=o.me(t,e)})),o}))},wu.prototype.Zn=function(t,e,n){return e.Ot()?this.tr(t,e.path):e._e()?this.er(t,e,n):this.sr(t,e,n)},wu.prototype.tr=function(t,e){return this.Kn(t,new Xr(e)).next((function(t){var e=ps();return t instanceof To&&(e=e.me(t.key,t)),e}))},wu.prototype.er=function(t,e,n){var r=this,i=e.collectionGroup,o=ps();return this.jn.ir(t,i).next((function(s){return cu.forEach(s,(function(s){var u=e.Zt(s.child(i));return r.sr(t,u,n).next((function(t){t.forEach((function(t,e){o=o.me(t,e)}))}))})).next((function(){return o}))}))},wu.prototype.sr=function(t,e,n){var r,i,o=this;return this.Qn.Zn(t,e,n).next((function(n){return r=n,o.Wn.nr(t,e)})).next((function(e){return i=e,o.rr(t,i,r).next((function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,u=o.mutations;s<u.length;s++){var a=u[s],h=a.key,c=r.get(h),f=a.ot(c,c,o.Tn);r=f instanceof To?r.me(h,f):r.remove(h)}}))})).next((function(){return r.forEach((function(t,n){e.matches(n)||(r=r.remove(t))})),r}))},wu.prototype.rr=function(t,e,n){for(var r=ms(),i=0,o=e;i<o.length;i++)for(var s=0,u=o[i].mutations;s<u.length;s++){var a=u[s];a instanceof zi&&null===n.get(a.key)&&(r=r.add(a.key))}var h=n;return this.Qn.getEntries(t,r).next((function(t){return t.forEach((function(t,e){null!==e&&e instanceof To&&(h=h.me(t,e))})),h}))},wu),yu=(gu.ar=function(t,e){for(var n=ms(),r=ms(),i=0,o=e.docChanges;i<o.length;i++){var s=o[i];switch(s.type){case 0:n=n.add(s.doc.key);break;case 1:r=r.add(s.doc.key)}}return new gu(t,e.fromCache,n,r)},gu),vu=(mu.prototype.cr=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},mu.prototype.next=function(){var t=++this.previousValue;return this._r&&this._r(t),t},mu);function mu(t,e){var n=this;this.previousValue=t,e&&(e.ur=function(t){return n.cr(t)},this._r=function(t){return e.lr(t)})}function gu(t,e,n,r){this.targetId=t,this.fromCache=e,this.hr=n,this.or=r}function wu(t,e,n){this.Qn=t,this.Wn=e,this.jn=n}function bu(){this.Bn=[]}function Eu(){this.Dn=new uu((function(t){return t.toString()})),this.Cn=!1}function Tu(t){var e=this;this.mn=null,this.An=null,this.result=void 0,this.error=void 0,this.Pn=!1,this.Vn=!1,t((function(t){e.Pn=!0,e.result=t,e.mn&&e.mn(t)}),(function(t){e.Pn=!0,e.error=t,e.An&&e.An(t)}))}function Iu(t,e,n,r,i){this.batch=t,this.wn=e,this.En=n,this.streamToken=r,this.Rn=i}function Nu(t,e,n,r){this.batchId=t,this.Tn=e,this.baseMutations=n,this.mutations=r}function _u(t){this.dn=t,this.fn={}}function Au(t,e){this.projectId=t,this.database=e||"(default)"}function Su(){var t=this;this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}vu.dr=-1;var Du=(ku.prototype.reset=function(){this.mr=0},ku.prototype.Vr=function(){this.mr=this.Rr},ku.prototype.gr=function(t){var e=this;this.cancel();var n=Math.floor(this.mr+this.pr()),r=Math.max(0,Date.now()-this.Pr),i=Math.max(0,n-r);0<i&&Ys("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.mr+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ar=this.Tr.yr(this.Er,i,(function(){return e.Pr=Date.now(),t()})),this.mr*=this.wr,this.mr<this.Ir&&(this.mr=this.Ir),this.mr>this.Rr&&(this.mr=this.Rr)},ku.prototype.cancel=function(){null!==this.Ar&&(this.Ar.cancel(),this.Ar=null)},ku.prototype.pr=function(){return(Math.random()-.5)*this.mr},ku);function ku(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Tr=t,this.Er=e,this.Ir=n,this.wr=r,this.Rr=i,this.mr=0,this.Ar=null,this.Pr=Date.now(),this.reset()}function xu(t){for(var e="",n=0;n<t.length;n++)0<e.length&&(e=Ru(e)),e=Ou(t.get(n),e);return Ru(e)}function Ou(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function Ru(t){return t+"\x01\x01"}function Vu(t){var e=t.length;if(Zs(2<=e),2===e)return Zs("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),Cr.G;for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||n<s)&&Js(),t.charAt(s+1)){case"\x01":var u=t.substring(o,s),a=void 0;0===i.length?a=u:(a=i+=u,i=""),r.push(a);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Js()}o=s+2}return new Cr(r)}var Pu=(Uu.prototype.vr=function(t,e){return this.br.add(e),cu.resolve()},Uu.prototype.ir=function(t,e){return cu.resolve(this.br.getEntries(e))},Uu),Lu=(ju.prototype.add=function(t){var e=t.O(),n=t.M(),r=this.index[e]||new os(Cr.N),i=!r.has(n);return this.index[e]=r.add(n),i},ju.prototype.has=function(t){var e=t.O(),n=t.M(),r=this.index[e];return r&&r.has(n)},ju.prototype.getEntries=function(t){return(this.index[t]||new os(Cr.N)).W()},ju),Cu=(Mu.prototype.vr=function(t,e){var n=this;if(this.Sr.has(e))return cu.resolve();var r=e.O(),i=e.M();t.qn((function(){n.Sr.add(e)}));var o={collectionId:r,parent:xu(i)};return qu(t).put(o)},Mu.prototype.ir=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[iu(e),""],!1,!0);return qu(t).Dr(r).next((function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Vu(o.parent))}return n}))},Mu);function Mu(){this.Sr=new Lu}function ju(){this.index={}}function Uu(){this.br=new Lu}function qu(t){return ua.Cr(t,Ua.store)}var Fu,Bu=(Gu.prototype.Nn=function(t,e,n){return Wu(t).put(Qu(e),n)},Gu.prototype.kn=function(t,e){var n=Wu(t),r=Qu(e);return n.delete(r)},Gu.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next((function(r){return r.byteSize+=e,n.Fr(t,r)}))},Gu.prototype.Mn=function(t,e){var n=this;return Wu(t).get(Qu(e)).next((function(t){return n.Nr(t)}))},Gu.prototype.$r=function(t,e){var n=this;return Wu(t).get(Qu(e)).next((function(t){var e=n.Nr(t);return e?{kr:e,size:Hu(t)}:null}))},Gu.prototype.getEntries=function(t,e){var n=this,r=fs();return this.Mr(t,e,(function(t,e){var i=n.Nr(e);r=r.me(t,i)})).next((function(){return r}))},Gu.prototype.Lr=function(t,e){var n=this,r=fs(),i=new Jo(Xr.N);return this.Mr(t,e,(function(t,e){var o=n.Nr(e);i=o?(r=r.me(t,o),i.me(t,Hu(e))):(r=r.me(t,null),i.me(t,0))})).next((function(){return{Or:r,xr:i}}))},Gu.prototype.Mr=function(t,e,n){if(e.B())return cu.resolve();var r=IDBKeyRange.bound(e.first().path.W(),e.last().path.W()),i=e.be(),o=i.Ne();return Wu(t).Br({range:r},(function(t,e,r){for(var s=Xr.st(t);o&&Xr.N(o,s)<0;)n(o,null),o=i.Ne();o&&o.isEqual(s)&&(n(o,e),o=i.$e()?i.Ne():null),o?r.qr(o.path.W()):r.done()})).next((function(){for(;o;)n(o,null),o=i.$e()?i.Ne():null}))},Gu.prototype.Zn=function(t,e,n){var r=this,i=ps(),o=e.path.length+1,s={};if(n.isEqual(Pr.min())){var u=e.path.W();s.range=IDBKeyRange.lowerBound(u)}else{var a=e.path.W(),h=this.serializer.Ur(n);s.range=IDBKeyRange.lowerBound([a,h],!0),s.index=Pa.collectionReadTimeIndex}return Wu(t).Br(s,(function(t,n,s){if(t.length===o){var u=r.serializer.Qr(n);e.path.q(u.key.path)?u instanceof To&&e.matches(u)&&(i=i.me(u.key,u)):s.done()}})).next((function(){return i}))},Gu.prototype.Wr=function(t,e){var n=this,r=cs(),i=this.serializer.Ur(e),o=Wu(t),s=IDBKeyRange.lowerBound(i,!0);return o.Br({index:Pa.readTimeIndex,range:s},(function(t,e){var o=n.serializer.Qr(e);r=r.me(o.key,o),i=e.readTime})).next((function(){return{jr:r,readTime:n.serializer.Kr(i)}}))},Gu.prototype.Gr=function(t){var e=this,n=Wu(t),r=Pr.min();return n.Br({index:Pa.readTimeIndex,reverse:!0},(function(t,n,i){n.readTime&&(r=e.serializer.Kr(n.readTime)),i.done()})).next((function(){return r}))},Gu.prototype.zr=function(t){return new Gu.Hr(this,!!t&&t.Yr)},Gu.prototype.Jr=function(t){return this.getMetadata(t).next((function(t){return t.byteSize}))},Gu.prototype.getMetadata=function(t){return zu(t).get(La.key).next((function(t){return Zs(!!t),t}))},Gu.prototype.Fr=function(t,e){return zu(t).put(La.key,e)},Gu.prototype.Nr=function(t){if(t){var e=this.serializer.Qr(t);return e instanceof Io&&e.version.isEqual(Pr.min())?null:e}return null},Gu);function Gu(t,e){this.serializer=t,this.jn=e}function zu(t){return ua.Cr(t,La.store)}function Wu(t){return ua.Cr(t,Pa.store)}function Qu(t){return t.path.W()}function Hu(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Js();e=t.noDocument}return JSON.stringify(e).length}function Ku(t,e){var n=this;return(n=Fu.call(this)||this).Xr=t,n.Yr=e,n.Zr=new uu((function(t){return t.toString()})),n}Bu.Hr=(s(Ku,Fu=fu),Ku.prototype.xn=function(t){var e=this,n=[],r=0,i=new os((function(t,e){return nu(t.j(),e.j())}));return this.Dn.forEach((function(o,s){var u=e.Zr.get(o);if(s){var a=e.Xr.serializer.th(s,e.readTime);i=i.add(o.path.M());var h=Hu(a);r+=h-u,n.push(e.Xr.Nn(t,o,a))}else if(r-=u,e.Yr){var c=e.Xr.serializer.th(new Io(o,Pr.min()),e.readTime);n.push(e.Xr.Nn(t,o,c))}else n.push(e.Xr.kn(t,o))})),i.forEach((function(r){n.push(e.Xr.jn.vr(t,r))})),n.push(this.Xr.updateMetadata(t,r)),cu.vn(n)},Ku.prototype.Ln=function(t,e){var n=this;return this.Xr.$r(t,e).next((function(t){return null===t?(n.Zr.set(e,0),null):(n.Zr.set(e,t.size),t.kr)}))},Ku.prototype.On=function(t,e){var n=this;return this.Xr.Lr(t,e).next((function(t){var e=t.Or;return t.xr.forEach((function(t,e){n.Zr.set(t,e)})),e}))},Ku);var Yu=(Ju.prototype.next=function(){return this.eh+=2,this.eh},Ju.sh=function(){return new Ju(0)},Ju.ih=function(){return new Ju(-1)},Ju),Xu=($u.prototype.rh=function(t){var e=this;return this.hh(t).next((function(n){var r=new Yu(n.highestTargetId);return n.highestTargetId=r.next(),e.oh(t,n).next((function(){return n.highestTargetId}))}))},$u.prototype.ah=function(t){return this.hh(t).next((function(t){return Pr.v(new Vr(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))}))},$u.prototype.uh=function(t){return ea(t._h)},$u.prototype.lh=function(t,e,n){var r=this;return this.hh(t).next((function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.C()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.oh(t,i)}))},$u.prototype.dh=function(t,e){var n=this;return this.fh(t,e).next((function(){return n.hh(t).next((function(r){return r.targetCount+=1,n.Th(e,r),n.oh(t,r)}))}))},$u.prototype.Eh=function(t,e){return this.fh(t,e)},$u.prototype.Ih=function(t,e){var n=this;return this.wh(t,e.targetId).next((function(){return Zu(t).delete(e.targetId)})).next((function(){return n.hh(t)})).next((function(e){return Zs(0<e.targetCount),--e.targetCount,n.oh(t,e)}))},$u.prototype.Rh=function(t,e,n){var r=this,i=0,o=[];return Zu(t).Br((function(s,u){var a=r.serializer.mh(u);a.sequenceNumber<=e&&null===n.get(a.targetId)&&(i++,o.push(r.Ih(t,a)))})).next((function(){return cu.vn(o)})).next((function(){return i}))},$u.prototype.js=function(t,e){var n=this;return Zu(t).Br((function(t,r){var i=n.serializer.mh(r);e(i)}))},$u.prototype.hh=function(t){return ta(t._h)},$u.prototype.oh=function(t,e){return ua.Cr(t,ja.store).put(ja.key,e)},$u.prototype.fh=function(t,e){return Zu(t).put(this.serializer.Ah(e))},$u.prototype.Th=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},$u.prototype.Ph=function(t){return this.hh(t).next((function(t){return t.targetCount}))},$u.prototype.Vh=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return Zu(t).Br({range:i,index:Ca.queryTargetsIndexName},(function(t,r,i){var s=n.serializer.mh(r);e.isEqual(s.target)&&(o=s,i.done())})).next((function(){return o}))},$u.prototype.gh=function(t,e,n){var r=this,i=[],o=na(t);return e.forEach((function(e){var s=xu(e.path);i.push(o.put(new Ma(n,s))),i.push(r.nh.ph(t,n,e))})),cu.vn(i)},$u.prototype.yh=function(t,e,n){var r=this,i=na(t);return cu.forEach(e,(function(e){var o=xu(e.path);return cu.vn([i.delete([n,o]),r.nh.bh(t,n,e)])}))},$u.prototype.wh=function(t,e){var n=na(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},$u.prototype.vh=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=na(t),i=ms();return r.Br({range:n,Sh:!0},(function(t,e,n){var r=Vu(t[1]),o=new Xr(r);i=i.add(o)})).next((function(){return i}))},$u.prototype.Dh=function(t,e){var n=xu(e.path),r=IDBKeyRange.bound([n],[iu(n)],!1,!0),i=0;return na(t).Br({index:Ma.documentTargetsIndex,Sh:!0,range:r},(function(t,e,n){var r=t[0];t[1],0!==r&&(i++,n.done())})).next((function(){return 0<i}))},$u.prototype.si=function(t,e){var n=this;return Zu(t).get(e).next((function(t){return t?n.serializer.mh(t):null}))},$u);function $u(t,e){this.nh=t,this.serializer=e}function Ju(t){this.eh=t}function Zu(t){return ua.Cr(t,Ca.store)}function ta(t){return za.Cr(t,ja.store).get(ja.key).next((function(t){return Zs(null!==t),t}))}function ea(t){return ta(t).next((function(t){return t.highestListenSequenceNumber}))}function na(t){return ua.Cr(t,Ma.store)}var ra,ia=(ca.prototype.Qr=function(t){if(t.document)return this.Ch.Ai(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Xr.st(t.noDocument.path),n=this.Fh(t.noDocument.readTime);return new Io(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){var r=Xr.st(t.unknownDocument.path),i=this.Fh(t.unknownDocument.version);return new No(r,i)}return Js()},ca.prototype.th=function(t,e){var n=this.Ur(e),r=t.key.path.M().W();if(t instanceof To){var i=this.Ch.mi(t),o=t.hasCommittedMutations;return new Pa(null,null,i,o,n,r)}if(t instanceof Io){var s=t.key.path.W(),u=this.Nh(t.version),a=t.hasCommittedMutations;return new Pa(null,new Ra(s,u),null,a,n,r)}if(t instanceof No){var h=t.key.path.W(),c=this.Nh(t.version);return new Pa(new Va(h,c),null,null,!0,n,r)}return Js()},ca.prototype.Ur=function(t){var e=t.C();return[e.seconds,e.nanoseconds]},ca.prototype.Kr=function(t){var e=new Vr(t[0],t[1]);return Pr.v(e)},ca.prototype.Nh=function(t){var e=t.C();return new _a(e.seconds,e.nanoseconds)},ca.prototype.Fh=function(t){var e=new Vr(t.seconds,t.nanoseconds);return Pr.v(e)},ca.prototype.$h=function(t,e){var n=this,r=e.baseMutations.map((function(t){return n.Ch.vi(t)})),i=e.mutations.map((function(t){return n.Ch.vi(t)}));return new ka(t,e.batchId,e.Tn.toMillis(),r,i)},ca.prototype.kh=function(t){var e=this,n=(t.baseMutations||[]).map((function(t){return e.Ch.Fi(t)})),r=t.mutations.map((function(t){return e.Ch.Fi(t)})),i=Vr.fromMillis(t.localWriteTimeMs);return new au(t.batchId,i,n,r)},ca.prototype.mh=function(t){var e,n=this.Fh(t.readTime),r=void 0!==t.lastLimboFreeSnapshotVersion?this.Fh(t.lastLimboFreeSnapshotVersion):Pr.min();return e=void 0!==t.query.documents?this.Ch.xi(t.query):this.Ch.Wi(t.query),new Lo(e,t.targetId,0,t.lastListenSequenceNumber,n,r,ei.fromBase64String(t.resumeToken))},ca.prototype.Ah=function(t){var e,n=this.Nh(t.Ee),r=this.Nh(t.lastLimboFreeSnapshotVersion);e=t.target.Ot()?this.Ch.Oi(t.target):this.Ch.Bi(t.target);var i=t.resumeToken.toBase64();return new Ca(t.targetId,t.target.canonicalId(),n,i,t.sequenceNumber,r,e)},ca),oa="Failed to obtain exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",sa=(s(ha,ra=pu),ha),ua=(aa.Cr=function(t,e){if(t instanceof sa)return za.Cr(t._h,e);throw Js()},aa.prototype.start=function(){var t=this;return za.Yh(this.Kh,Ia,new Na(this.serializer)).then((function(e){return t.Jh=e,t.Xh()})).then((function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new Dr(Sr.FAILED_PRECONDITION,oa);return t.Zh(),t.to(),t.eo(),t.Jh.runTransaction("readonly",[ja.store],(function(t){return ea(t)}))})).then((function(e){t.Oh=new vu(e,t.Lh)})).then((function(){t.xh=!0})).catch((function(e){return t.Jh&&t.Jh.close(),Promise.reject(e)}))},aa.prototype.so=function(t){var e=this;return this.Wh=function(n){return u(e,void 0,void 0,(function(){return a(this,(function(e){return this.io?[2,t(n)]:[2]}))}))},t(this.isPrimary)},aa.prototype.no=function(t){var e=this;this.Jh.ro((function(n){return u(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))}))}))},aa.prototype.ho=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Tr.oo((function(){return u(e,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.io?[4,this.Xh()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))})))},aa.prototype.Xh=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(e){return la(e).put(new Fa(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next((function(){if(t.isPrimary)return t.ao(e).next((function(e){e||(t.isPrimary=!1,t.Tr.oo((function(){return t.Wh(!1)})))}))})).next((function(){return t.uo(e)})).next((function(n){return t.isPrimary&&!n?t.co(e).next((function(){return!1})):!!n&&t._o(e).next((function(){return!0}))}))})).catch((function(e){if(t.allowTabSynchronization)return Ys("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1;if(Xa(e))return Ys("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;throw e})).then((function(e){t.isPrimary!==e&&t.Tr.oo((function(){return t.Wh(e)})),t.isPrimary=e}))},aa.prototype.ao=function(t){var e=this;return fa(t).get(Aa.key).next((function(t){return cu.resolve(e.lo(t))}))},aa.prototype.do=function(t){return la(t).delete(this.clientId)},aa.prototype.fo=function(){return u(this,void 0,void 0,(function(){var t=this;return a(this,(function(e){switch(e.label){case 0:return!this.isPrimary||this.To(this.Qh,18e5)?[3,2]:(this.Qh=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var n=aa.Cr(e,Fa.store);return n.Dr().next((function(e){var r=t.Eo(e,18e5),i=e.filter((function(t){return-1===r.indexOf(t)}));return cu.forEach(i,(function(t){return n.delete(t.clientId)})).next((function(){return i}))}))})).catch((function(){return[]}))]);case 1:e.sent().forEach((function(e){t.window.localStorage.removeItem(t.Io(e.clientId))})),e.label=2;case 2:return[2]}}))}))},aa.prototype.eo=function(){var t=this;this.Uh=this.Tr.yr("client_metadata_refresh",4e3,(function(){return t.Xh().then((function(){return t.fo()})).then((function(){return t.eo()}))}))},aa.prototype.lo=function(t){return!!t&&t.ownerId===this.clientId},aa.prototype.uo=function(t){var e=this;return fa(t).get(Aa.key).next((function(n){if(null!==n&&e.To(n.leaseTimestampMs,5e3)&&!e.wo(n.ownerId)){if(e.lo(n)&&e.networkEnabled)return!0;if(!e.lo(n)){if(!n.allowTabSynchronization)throw new Dr(Sr.FAILED_PRECONDITION,oa);return!1}}return!(!e.networkEnabled||!e.inForeground)||la(t).Dr().next((function(t){return void 0===e.Eo(t,5e3).find((function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1}))}))})).next((function(t){return e.isPrimary!==t&&Ys("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t}))},aa.prototype.Ro=function(){return u(this,void 0,void 0,(function(){var t=this;return a(this,(function(e){switch(e.label){case 0:return this.xh=!1,this.mo(),this.Uh&&(this.Uh.cancel(),this.Uh=null),this.Ao(),this.Po(),[4,this.runTransaction("shutdown","readwrite",(function(e){return t.co(e).next((function(){return t.do(e)}))})).catch((function(t){Ys("IndexedDbPersistence","Proceeding with shutdown despite failure: ",t)}))];case 1:return e.sent(),this.Jh.close(),this.Vo(),[2]}}))}))},aa.prototype.Eo=function(t,e){var n=this;return t.filter((function(t){return n.To(t.updateTimeMs,e)&&!n.wo(t.clientId)}))},aa.prototype.po=function(){var t=this;return this.runTransaction("getActiveClients","readonly",(function(e){return la(e).Dr().next((function(e){return t.Eo(e,18e5).map((function(t){return t.clientId}))}))}))},aa.clearPersistence=function(t){return u(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return aa.jh()?(e=t+aa.Gh,[4,za.delete(e)]):[2,Promise.resolve()];case 1:return n.sent(),[2]}}))}))},Object.defineProperty(aa.prototype,"io",{get:function(){return this.xh},enumerable:!0,configurable:!0}),aa.prototype.yo=function(t){return va.bo(t,this.serializer,this.jn,this.nh)},aa.prototype.vo=function(){return this.zh},aa.prototype.So=function(){return this.Qn},aa.prototype.Do=function(){return this.jn},aa.prototype.runTransaction=function(t,e,n){var r=this;Ys("IndexedDbPersistence","Starting transaction:",t);var i,o="readonly"===e?"readonly":"readwrite";return this.Jh.runTransaction(o,Ga,(function(o){return i=new sa(o,r.Oh?r.Oh.next():vu.dr),"readwrite-primary"===e?r.ao(i).next((function(t){return!!t||r.uo(i)})).next((function(e){if(!e)throw Xs("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.Tr.oo((function(){return r.Wh(!1)})),new Dr(Sr.FAILED_PRECONDITION,lu);return n(i)})).next((function(t){return r._o(i).next((function(){return t}))})):r.Co(i).next((function(){return n(i)}))})).then((function(t){return i.Un(),t}))},aa.prototype.Co=function(t){var e=this;return fa(t).get(Aa.key).next((function(t){if(null!==t&&e.To(t.leaseTimestampMs,5e3)&&!e.wo(t.ownerId)&&!e.lo(t)&&(!e.allowTabSynchronization||!t.allowTabSynchronization))throw new Dr(Sr.FAILED_PRECONDITION,oa)}))},aa.prototype._o=function(t){var e=new Aa(this.clientId,this.allowTabSynchronization,Date.now());return fa(t).put(Aa.key,e)},aa.jh=function(){return za.jh()},aa.Fo=function(t){var e=t.ii.projectId;return t.ii.ln||(e+="."+t.ii.database),"firestore/"+t.persistenceKey+"/"+e+"/"},aa.prototype.co=function(t){var e=this,n=fa(t);return n.get(Aa.key).next((function(t){return e.lo(t)?(Ys("IndexedDbPersistence","Releasing primary lease."),n.delete(Aa.key)):cu.resolve()}))},aa.prototype.To=function(t,e){var n=Date.now();return!(t<n-e||n<t&&(Xs("Detected an update time that is in the future: "+t+" > "+n),1))},aa.prototype.Zh=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.qh=function(){t.Tr.oo((function(){return t.inForeground="visible"===t.document.visibilityState,t.Xh()}))},this.document.addEventListener("visibilitychange",this.qh),this.inForeground="visible"===this.document.visibilityState)},aa.prototype.Ao=function(){this.qh&&(this.document.removeEventListener("visibilitychange",this.qh),this.qh=null)},aa.prototype.to=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.Bh=function(){t.mo(),t.Tr.oo((function(){return t.Ro()}))},this.window.addEventListener("unload",this.Bh))},aa.prototype.Po=function(){this.Bh&&(this.window.removeEventListener("unload",this.Bh),this.Bh=null)},aa.prototype.wo=function(t){try{var e=null!==this.Hh.getItem(this.Io(t));return Ys("IndexedDbPersistence","Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Xs("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},aa.prototype.mo=function(){try{this.Hh.setItem(this.Io(this.clientId),String(Date.now()))}catch(n){Xs("Failed to set zombie client id.",n)}},aa.prototype.Vo=function(){try{this.Hh.removeItem(this.Io(this.clientId))}catch(n){}},aa.prototype.Io=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},aa);function aa(t,e,n,r,i,o,s,u){if(this.allowTabSynchronization=t,this.persistenceKey=e,this.clientId=n,this.Tr=o,this.Lh=u,this.Oh=null,this.xh=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Bh=null,this.inForeground=!1,this.qh=null,this.Uh=null,this.Qh=Number.NEGATIVE_INFINITY,this.Wh=function(t){return Promise.resolve()},!aa.jh())throw new Dr(Sr.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");if(this.nh=new pa(this,i),this.Kh=e+aa.Gh,this.serializer=new ia(s),this.document=r.document,this.zh=new Xu(this.nh,this.serializer),this.jn=new Cu,this.Qn=new Bu(this.serializer,this.jn),!r.window||!r.window.localStorage)throw new Dr(Sr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=r.window,this.Hh=this.window.localStorage}function ha(t,e){var n=this;return(n=ra.call(this)||this)._h=t,n.Mh=e,n}function ca(t){this.Ch=t}function fa(t){return ua.Cr(t,Aa.store)}function la(t){return ua.Cr(t,Fa.store)}ua.Gh="main";var pa=(da.prototype.$o=function(t){var e=this.ko(t);return this.db.vo().Ph(t).next((function(t){return e.next((function(e){return t+e}))}))},da.prototype.ko=function(t){var e=0;return this.Mo(t,(function(t){e++})).next((function(){return e}))},da.prototype.js=function(t,e){return this.db.vo().js(t,e)},da.prototype.Mo=function(t,e){return this.Lo(t,(function(t,n){return e(n)}))},da.prototype.ph=function(t,e,n){return ya(t,n)},da.prototype.bh=function(t,e,n){return ya(t,n)},da.prototype.Rh=function(t,e,n){return this.db.vo().Rh(t,e,n)},da.prototype.Oo=function(t,e){return ya(t,e)},da.prototype.xo=function(t,e){return r=e,i=!1,Ta(n=t).Bo((function(t){return ga(n,t,r).next((function(t){return t&&(i=!0),cu.resolve(!t)}))})).next((function(){return i}));var n,r,i},da.prototype.qo=function(t,e){var n=this,r=this.db.So().zr(),i=[],o=0;return this.Lo(t,(function(s,u){if(u<=e){var a=n.xo(t,s).next((function(e){if(!e)return o++,r.Mn(t,s).next((function(){return r.kn(s),na(t).delete([0,xu(s.path)])}))}));i.push(a)}})).next((function(){return cu.vn(i)})).next((function(){return r.apply(t)})).next((function(){return o}))},da.prototype.removeTarget=function(t,e){var n=e.Ie(t.Mh);return this.db.vo().Eh(t,n)},da.prototype.Uo=function(t,e){return ya(t,e)},da.prototype.Lo=function(t,e){var n,r=na(t),i=vu.dr;return r.Br({index:Ma.documentTargetsIndex},(function(t,r){var o=t[0],s=(t[1],r.path),u=r.sequenceNumber;0===o?(i!==vu.dr&&e(new Xr(Vu(n)),i),i=u,n=s):i=vu.dr})).next((function(){i!==vu.dr&&e(new Xr(Vu(n)),i)}))},da.prototype.Qo=function(t){return this.db.So().Jr(t)},da);function da(t,e){this.db=t,this.No=new vh(this,e)}function ya(t,e){return na(t).put((n=e,r=t.Mh,new Ma(0,xu(n.path),r)));var n,r}var va=(ma.bo=function(t,e,n,r){return Zs(""!==t.uid),new ma(t.t()?t.uid:"",e,n,r)},ma.prototype.jo=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return ba(t).Br({index:ka.userMutationsIndex,range:n},(function(t,n,r){e=!1,r.done()})).next((function(){return e}))},ma.prototype.Ko=function(t,e,n){return this.Go(t).next((function(e){return e.lastStreamToken=n.toBase64(),Ta(t).put(e)}))},ma.prototype.zo=function(t){return this.Go(t).next((function(t){return ei.fromBase64String(t.lastStreamToken)}))},ma.prototype.Ho=function(t,e){return this.Go(t).next((function(n){return n.lastStreamToken=e.toBase64(),Ta(t).put(n)}))},ma.prototype.Yo=function(t,e,n,r){var i=this,o=Ea(t),s=ba(t);return s.add({}).next((function(u){Zs("number"==typeof u);for(var a=new au(u,e,n,r),h=i.serializer.$h(i.userId,a),c=[],f=new os((function(t,e){return nu(t.j(),e.j())})),l=0,p=r;l<p.length;l++){var d=p[l],y=xa.key(i.userId,d.key.path,u);f=f.add(d.key.path.M()),c.push(s.put(h)),c.push(o.put(y,xa.PLACEHOLDER))}return f.forEach((function(e){c.push(i.jn.vr(t,e))})),t.qn((function(){i.Wo[u]=a.keys()})),cu.vn(c).next((function(){return a}))}))},ma.prototype.Jo=function(t,e){var n=this;return ba(t).get(e).next((function(t){return t?(Zs(t.userId===n.userId),n.serializer.kh(t)):null}))},ma.prototype.Xo=function(t,e){var n=this;return this.Wo[e]?cu.resolve(this.Wo[e]):this.Jo(t,e).next((function(t){if(t){var r=t.keys();return n.Wo[e]=r}return null}))},ma.prototype.Zo=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return ba(t).Br({index:ka.userMutationsIndex,range:i},(function(t,e,i){e.userId===n.userId&&(Zs(e.batchId>=r),o=n.serializer.kh(e)),i.done()})).next((function(){return o}))},ma.prototype.ta=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return ba(t).Br({index:ka.userMutationsIndex,range:e,reverse:!0},(function(t,e,r){n=e.batchId,r.done()})).next((function(){return n}))},ma.prototype.ea=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return ba(t).Dr(ka.userMutationsIndex,n).next((function(t){return t.map((function(t){return e.serializer.kh(t)}))}))},ma.prototype.Gn=function(t,e){var n=this,r=xa.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return Ea(t).Br({range:i},(function(r,i,s){var u=r[0],a=r[1],h=r[2],c=Vu(a);if(u===n.userId&&e.path.isEqual(c))return ba(t).get(h).next((function(t){if(!t)throw Js();Zs(t.userId===n.userId),o.push(n.serializer.kh(t))}));s.done()})).next((function(){return o}))},ma.prototype.Xn=function(t,e){var n=this,r=new os(nu),i=[];return e.forEach((function(e){var o=xa.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),u=Ea(t).Br({range:s},(function(t,i,o){var s=t[0],u=t[1],a=t[2],h=Vu(u);s===n.userId&&e.path.isEqual(h)?r=r.add(a):o.done()}));i.push(u)})),cu.vn(i).next((function(){return n.sa(t,r)}))},ma.prototype.nr=function(t,e){var n=this,r=e.path,i=r.length+1,o=xa.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),u=new os(nu);return Ea(t).Br({range:s},(function(t,e,o){var s=t[0],a=t[1],h=t[2],c=Vu(a);s===n.userId&&r.q(c)?c.length===i&&(u=u.add(h)):o.done()})).next((function(){return n.sa(t,u)}))},ma.prototype.sa=function(t,e){var n=this,r=[],i=[];return e.forEach((function(e){i.push(ba(t).get(e).next((function(t){if(null===t)throw Js();Zs(t.userId===n.userId),r.push(n.serializer.kh(t))})))})),cu.vn(i).next((function(){return r}))},ma.prototype.ia=function(t,e){var n=this;return wa(t._h,this.userId,e).next((function(r){return t.qn((function(){n.na(e.batchId)})),cu.forEach(r,(function(e){return n.nh.Oo(t,e)}))}))},ma.prototype.na=function(t){delete this.Wo[t]},ma.prototype.ra=function(t){var e=this;return this.jo(t).next((function(n){if(!n)return cu.resolve();var r=IDBKeyRange.lowerBound(xa.prefixForUser(e.userId)),i=[];return Ea(t).Br({range:r},(function(t,n,r){if(t[0]===e.userId){var o=Vu(t[1]);i.push(o)}else r.done()})).next((function(){Zs(0===i.length)}))}))},ma.prototype.Dh=function(t,e){return ga(t,this.userId,e)},ma.prototype.Go=function(t){var e=this;return Ta(t).get(this.userId).next((function(t){return t||new Da(e.userId,-1,"")}))},ma);function ma(t,e,n,r){this.userId=t,this.serializer=e,this.jn=n,this.nh=r,this.Wo={}}function ga(t,e,n){var r=xa.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return Ea(t).Br({range:o,Sh:!0},(function(t,n,r){var o=t[0],u=t[1];t[2],o===e&&u===i&&(s=!0),r.done()})).next((function(){return s}))}function wa(t,e,n){var r=t.store(ka.store),i=t.store(xa.store),o=[],s=IDBKeyRange.only(n.batchId),u=0,a=r.Br({range:s},(function(t,e,n){return u++,n.delete()}));o.push(a.next((function(){Zs(1===u)})));for(var h=[],c=0,f=n.mutations;c<f.length;c++){var l=f[c],p=xa.key(e,l.key.path,n.batchId);o.push(i.delete(p)),h.push(l.key)}return cu.vn(o).next((function(){return h}))}function ba(t){return ua.Cr(t,ka.store)}function Ea(t){return ua.Cr(t,xa.store)}function Ta(t){return ua.Cr(t,Da.store)}var Ia=10,Na=(Sa.prototype.createOrUpgrade=function(t,e,n,r){var i=this;Zs(n<r&&0<=n&&r<=Ia);var o,s=new $a(e);n<1&&1<=r&&(t.createObjectStore(Aa.store),(o=t).createObjectStore(Da.store,{keyPath:Da.keyPath}),o.createObjectStore(ka.store,{keyPath:ka.keyPath,autoIncrement:!0}).createIndex(ka.userMutationsIndex,ka.userMutationsKeyPath,{unique:!0}),o.createObjectStore(xa.store),qa(t),t.createObjectStore(Pa.store));var u,a=cu.resolve();return n<3&&3<=r&&(0!==n&&((u=t).deleteObjectStore(Ma.store),u.deleteObjectStore(Ca.store),u.deleteObjectStore(ja.store),qa(t)),a=a.next((function(){return t=s.store(ja.store),e=new ja(0,0,Pr.min().C(),0),t.put(ja.key,e);var t,e}))),n<4&&4<=r&&(0!==n&&(a=a.next((function(){return e=t,(n=s).store(ka.store).Dr().next((function(t){e.deleteObjectStore(ka.store),e.createObjectStore(ka.store,{keyPath:ka.keyPath,autoIncrement:!0}).createIndex(ka.userMutationsIndex,ka.userMutationsKeyPath,{unique:!0});var r=n.store(ka.store),i=t.map((function(t){return r.put(t)}));return cu.vn(i)}));var e,n}))),a=a.next((function(){t.createObjectStore(Fa.store,{keyPath:Fa.keyPath})}))),n<5&&5<=r&&(a=a.next((function(){return i.removeAcknowledgedMutations(s)}))),n<6&&6<=r&&(a=a.next((function(){return t.createObjectStore(La.store),i.addDocumentGlobal(s)}))),n<7&&7<=r&&(a=a.next((function(){return i.ensureSequenceNumbers(s)}))),n<8&&8<=r&&(a=a.next((function(){return i.createCollectionParentIndex(t,s)}))),n<9&&9<=r&&(a=a.next((function(){var n,r;(r=t).objectStoreNames.contains("remoteDocumentChanges")&&r.deleteObjectStore("remoteDocumentChanges"),(n=e.objectStore(Pa.store)).createIndex(Pa.readTimeIndex,Pa.readTimeIndexPath,{unique:!1}),n.createIndex(Pa.collectionReadTimeIndex,Pa.collectionReadTimeIndexPath,{unique:!1})}))),n<10&&10<=r&&(a=a.next((function(){return i.rewriteCanonicalIds(s)}))),a},Sa.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Pa.store).Br((function(t,n){e+=Hu(n)})).next((function(){var n=new La(e);return t.store(La.store).put(La.key,n)}))},Sa.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(Da.store),r=t.store(ka.store);return n.Dr().next((function(n){return cu.forEach(n,(function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Dr(ka.userMutationsIndex,i).next((function(r){return cu.forEach(r,(function(r){Zs(r.userId===n.userId);var i=e.serializer.kh(r);return wa(t,n.userId,i).next((function(){}))}))}))}))}))},Sa.prototype.ensureSequenceNumbers=function(t){var e=t.store(Ma.store),n=t.store(Pa.store);return ea(t).next((function(t){var r=[];return n.Br((function(n,i){var o=new Cr(n),s=[0,xu(o)];r.push(e.get(s).next((function(n){return n?cu.resolve():(r=o,e.put(new Ma(0,xu(r),t)));var r})))})).next((function(){return cu.vn(r)}))}))},Sa.prototype.createCollectionParentIndex=function(t,e){function n(t){if(i.add(t)){var e=t.O(),n=t.M();return r.put({collectionId:e,parent:xu(n)})}}t.createObjectStore(Ua.store,{keyPath:Ua.keyPath});var r=e.store(Ua.store),i=new Lu;return e.store(Pa.store).Br({Sh:!0},(function(t,e){return n(new Cr(t).M())})).next((function(){return e.store(xa.store).Br({Sh:!0},(function(t,e){t[0];var r=t[1];return n((t[2],Vu(r)).M())}))}))},Sa.prototype.rewriteCanonicalIds=function(t){var e=this,n=t.store(Ca.store);return n.Br((function(t,r){var i=e.serializer.mh(r),o=e.serializer.Ah(i);return n.put(o)}))},Sa),_a=function(t,e){this.seconds=t,this.nanoseconds=e},Aa=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};function Sa(t){this.serializer=t}Aa.store="owner",Aa.key="owner";var Da=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};Da.store="mutationQueues",Da.keyPath="userId";var ka=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};ka.store="mutations",ka.keyPath="batchId",ka.userMutationsIndex="userMutationsIndex",ka.userMutationsKeyPath=["userId","batchId"];var xa=(Oa.prefixForUser=function(t){return[t]},Oa.prefixForPath=function(t,e){return[t,xu(e)]},Oa.key=function(t,e,n){return[t,xu(e),n]},Oa);function Oa(){}xa.store="documentMutations",xa.PLACEHOLDER=new xa;var Ra=function(t,e){this.path=t,this.readTime=e},Va=function(t,e){this.path=t,this.version=e},Pa=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Pa.store="remoteDocuments",Pa.readTimeIndex="readTimeIndex",Pa.readTimeIndexPath="readTime",Pa.collectionReadTimeIndex="collectionReadTimeIndex",Pa.collectionReadTimeIndexPath=["parentPath","readTime"];var La=function(t){this.byteSize=t};La.store="remoteDocumentGlobal",La.key="remoteDocumentGlobalKey";var Ca=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Ca.store="targets",Ca.keyPath="targetId",Ca.queryTargetsIndexName="queryTargetsIndex",Ca.queryTargetsKeyPath=["canonicalId","targetId"];var Ma=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Ma.store="targetDocuments",Ma.keyPath=["targetId","path"],Ma.documentTargetsIndex="documentTargetsIndex",Ma.documentTargetsKeyPath=["path","targetId"];var ja=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};ja.key="targetGlobalKey",ja.store="targetGlobal";var Ua=function(t,e){this.collectionId=t,this.parent=e};function qa(t){t.createObjectStore(Ma.store,{keyPath:Ma.keyPath}).createIndex(Ma.documentTargetsIndex,Ma.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Ca.store,{keyPath:Ca.keyPath}).createIndex(Ca.queryTargetsIndexName,Ca.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(ja.store)}Ua.store="collectionParents",Ua.keyPath=["collectionId","parent"];var Fa=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Fa.store="clientMetadata",Fa.keyPath="clientId";var Ba,Ga=h(h(h([Da.store,ka.store,xa.store,Pa.store,Ca.store,Aa.store,ja.store,Ma.store],[Fa.store]),[La.store]),[Ua.store]),za=(Ya.Yh=function(t,e,n){return Ys("SimpleDb","Opening database:",t),new cu((function(r,i){var o=window.indexedDB.open(t,e);o.onsuccess=function(t){var e=t.target.result;r(new Ya(e))},o.onblocked=function(){i(new Dr(Sr.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},o.onerror=function(t){var e=t.target.error;"VersionError"===e.name?i(new Dr(Sr.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):i(e)},o.onupgradeneeded=function(e){Ys("SimpleDb",'Database "'+t+'" requires upgrade from version:',e.oldVersion);var r=e.target.result;n.createOrUpgrade(r,o.transaction,e.oldVersion,Ia).next((function(){Ys("SimpleDb","Database upgrade to version "+Ia+" complete")}))}})).yn()},Ya.delete=function(t){return Ys("SimpleDb","Removing database:",t),eh(window.indexedDB.deleteDatabase(t)).yn()},Ya.jh=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(Ya.oa())return!0;if(void 0===window.navigator)return!1;var t=v(),e=Ya.ha(t),n=0<e&&e<10,r=Ya.aa(t),i=0<r&&r<4.5;return!(0<t.indexOf("MSIE ")||0<t.indexOf("Trident/")||0<t.indexOf("Edge/")||n||i)},Ya.oa=function(){var t;return"undefined"!=typeof __PRIVATE_process&&"YES"===(null===(t=__PRIVATE_process.__PRIVATE_env)||void 0===t?void 0:t.ua)},Ya.Cr=function(t,e){return t.store(e)},Ya.ha=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},Ya.aa=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},Ya.prototype.ro=function(t){this.db.onversionchange=function(e){return t(e)}},Ya.prototype.runTransaction=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s,u;return a(this,(function(h){switch(h.label){case 0:r="readonly"===t,i=0,o=function(){var t,o,u,h,c;return a(this,(function(a){switch(a.label){case 0:++i,t=$a.open(s.db,r?"readonly":"readwrite",e),a.label=1;case 1:return a.trys.push([1,3,,4]),o=n(t).catch((function(e){return t.abort(e),cu.reject(e)})).yn(),u={},o.catch((function(){})),[4,t.ca];case 2:return[2,(u.value=(a.sent(),o),u)];case 3:return h=a.sent(),c="FirebaseError"!==h.name&&i<3,Ys("SimpleDb","Transaction failed with error: %s. Retrying: %s.",h.message,c),c?[3,4]:[2,{value:Promise.reject(h)}];case 4:return[2]}}))},s=this,h.label=1;case 1:return[5,o()];case 2:if("object"==typeof(u=h.sent()))return[2,u.value];h.label=3;case 3:return[3,1];case 4:return[2]}}))}))},Ya.prototype.close=function(){this.db.close()},Ya),Wa=(Object.defineProperty(Ka.prototype,"Pn",{get:function(){return this.la},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"fa",{get:function(){return this.da},enumerable:!0,configurable:!0}),Object.defineProperty(Ka.prototype,"cursor",{set:function(t){this._a=t},enumerable:!0,configurable:!0}),Ka.prototype.done=function(){this.la=!0},Ka.prototype.qr=function(t){this.da=t},Ka.prototype.delete=function(){return eh(this._a.delete())},Ka),Qa=(s(Ha,Ba=Dr),Ha);function Ha(t){var e=this;return(e=Ba.call(this,Sr.UNAVAILABLE,"IndexedDB transaction failed: "+t)||this).name="IndexedDbTransactionError",e}function Ka(t){this._a=t,this.la=!1,this.da=null}function Ya(t){this.db=t,12.2===Ya.ha(v())&&Xs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}function Xa(t){return"IndexedDbTransactionError"===t.name}var $a=(th.open=function(t,e,n){return new th(t.transaction(n,e))},Object.defineProperty(th.prototype,"ca",{get:function(){return this.Ta.promise},enumerable:!0,configurable:!0}),th.prototype.abort=function(t){t&&this.Ta.reject(t),this.aborted||(Ys("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},th.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Ja(e)},th),Ja=(Za.prototype.put=function(t,e){return eh(void 0!==e?(Ys("SimpleDb","PUT",this.store.name,t,e),this.store.put(e,t)):(Ys("SimpleDb","PUT",this.store.name,"<auto-key>",t),this.store.put(t)))},Za.prototype.add=function(t){return Ys("SimpleDb","ADD",this.store.name,t,t),eh(this.store.add(t))},Za.prototype.get=function(t){var e=this;return eh(this.store.get(t)).next((function(n){return void 0===n&&(n=null),Ys("SimpleDb","GET",e.store.name,t,n),n}))},Za.prototype.delete=function(t){return Ys("SimpleDb","DELETE",this.store.name,t),eh(this.store.delete(t))},Za.prototype.count=function(){return Ys("SimpleDb","COUNT",this.store.name),eh(this.store.count())},Za.prototype.Dr=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.Ea(n,(function(t,e){r.push(e)})).next((function(){return r}))},Za.prototype.Ia=function(t,e){Ys("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Sh=!1;var r=this.cursor(n);return this.Ea(r,(function(t,e,n){return n.delete()}))},Za.prototype.Br=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.Ea(r,e)},Za.prototype.Bo=function(t){var e=this.cursor({});return new cu((function(n,r){e.onerror=function(t){var e=rh(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next((function(t){t?r.continue():n()})):n()}}))},Za.prototype.Ea=function(t,e){var n=[];return new cu((function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Wa(i),s=e(i.primaryKey,i.value,o);if(s instanceof cu){var u=s.catch((function(t){return o.done(),cu.reject(t)}));n.push(u)}o.Pn?r():null===o.fa?i.continue():i.continue(o.fa)}else r()}})).next((function(){return cu.vn(n)}))},Za.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},Za.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Sh?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},Za);function Za(t){this.store=t}function th(t){var e=this;this.transaction=t,this.aborted=!1,this.Ta=new Su,this.transaction.oncomplete=function(){e.Ta.resolve()},this.transaction.onabort=function(){t.error?e.Ta.reject(new Qa(t.error)):e.Ta.resolve()},this.transaction.onerror=function(t){var n=rh(t.target.error);e.Ta.reject(new Qa(n))}}function eh(t){return new cu((function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=rh(t.target.error);n(e)}}))}var nh=!1;function rh(t){var e=za.ha(v());if(12.2<=e&&e<13){var n="An internal error was encountered in the Indexed Database server";if(0<=t.message.indexOf(n)){var r=new Dr("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return nh||(nh=!0,setTimeout((function(){throw r}),0)),r}}return t}var ih=(uh.Pa=function(t,e,n,r,i){var o=new uh(t,e,Date.now()+n,r,i);return o.start(n),o},uh.prototype.start=function(t){var e=this;this.Va=setTimeout((function(){return e.ga()}),t)},uh.prototype.pa=function(){return this.ga()},uh.prototype.cancel=function(t){null!==this.Va&&(this.clearTimeout(),this.Aa.reject(new Dr(Sr.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},uh.prototype.ga=function(){var t=this;this.wa.oo((function(){return null!==t.Va?(t.clearTimeout(),t.op().then((function(e){return t.Aa.resolve(e)}))):Promise.resolve()}))},uh.prototype.clearTimeout=function(){null!==this.Va&&(this.ma(this),clearTimeout(this.Va),this.Va=null)},uh),oh=(Object.defineProperty(sh.prototype,"Ma",{get:function(){return this.va},enumerable:!0,configurable:!0}),sh.prototype.oo=function(t){this.enqueue(t)},sh.prototype.La=function(t){this.Oa(),this.xa(t)},sh.prototype.Ba=function(t){return this.Oa(),this.xa(t)},sh.prototype.qa=function(t){return u(this,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:return this.Oa(),this.va?[3,2]:(this.va=!0,(e=zs.nt().window)&&e.removeEventListener("visibilitychange",this.$a),[4,this.Ba(t)]);case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},sh.prototype.enqueue=function(t){return this.Oa(),this.va?new Promise((function(t){})):this.xa(t)},sh.prototype.Ua=function(t){var e=this;this.Oa(),this.va||(this.ba=this.ba.then((function(){var n=new Su,r=function(){return u(e,void 0,void 0,(function(){var e;return a(this,(function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,t()];case 1:return i.sent(),n.resolve(),this.Na.reset(),[3,3];case 2:if(!Xa(e=i.sent()))throw n.resolve(),e;return Ys("AsyncQueue","Operation failed with retryable error: "+e),this.Na.gr(r),[3,3];case 3:return[2]}}))}))};return e.oo(r),n.promise})))},sh.prototype.xa=function(t){var e=this,n=this.ya.then((function(){return e.Ca=!0,t().catch((function(t){throw e.Da=t,e.Ca=!1,Xs("INTERNAL UNHANDLED ERROR: ",t.stack||t.message||""),t})).then((function(t){return e.Ca=!1,t}))}));return this.ya=n},sh.prototype.yr=function(t,e,n){var r=this;this.Oa(),-1<this.Fa.indexOf(t)&&(e=0);var i=ih.Pa(this,t,e,n,(function(t){return r.Qa(t)}));return this.Sa.push(i),i},sh.prototype.Oa=function(){this.Da&&Js()},sh.prototype.Wa=function(){},sh.prototype.ja=function(){return u(this,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return[4,t=this.ya];case 1:e.sent(),e.label=2;case 2:if(t!==this.ya)return[3,0];e.label=3;case 3:return[2]}}))}))},sh.prototype.Ka=function(t){for(var e=0,n=this.Sa;e<n.length;e++)if(n[e].Er===t)return!0;return!1},sh.prototype.ka=function(t){var e=this;return this.ja().then((function(){e.Sa.sort((function(t,e){return t.Ra-e.Ra}));for(var n=0,r=e.Sa;n<r.length;n++){var i=r[n];if(i.pa(),"all"!==t&&i.Er===t)break}return e.ja()}))},sh.prototype.Ga=function(t){this.Fa.push(t)},sh.prototype.Qa=function(t){var e=this.Sa.indexOf(t);this.Sa.splice(e,1)},sh);function sh(){var t=this;this.ya=Promise.resolve(),this.ba=Promise.resolve(),this.va=!1,this.Sa=[],this.Da=null,this.Ca=!1,this.Fa=[],this.Na=new Du(this,"async_queue_retry"),this.$a=function(){t.ka("async_queue_retry")};var e=zs.nt().window;e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.$a)}function uh(t,e,n,r,i){this.wa=t,this.Er=e,this.Ra=n,this.op=r,this.ma=i,this.Aa=new Su,this.then=this.Aa.promise.then.bind(this.Aa.promise),this.catch=this.Aa.promise.catch.bind(this.Aa.promise),this.Aa.promise.catch((function(t){}))}function ah(t,e){if(Xs("AsyncQueue",e+": "+t),Xa(t))return new Dr(Sr.UNAVAILABLE,e+": "+t);throw t}function hh(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],s=nu(n,i);return 0===s?nu(r,o):s}var ch=(dh.prototype.Ya=function(){return++this.Ha},dh.prototype.Ja=function(t){var e=[t,this.Ya()];if(this.buffer.size<this.za)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();hh(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(dh.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),dh),fh={Xa:!1,Za:0,tu:0,eu:0},lh=(ph.ru=function(t){return new ph(t,ph.hu,ph.ou)},ph);function ph(t,e,n){this.su=t,this.iu=e,this.nu=n}function dh(t){this.za=t,this.buffer=new os(hh),this.Ha=0}lh.au=-1,lh.uu=1048576,lh.cu=41943040,lh.hu=10,lh.ou=1e3,lh._u=new lh(lh.cu,lh.hu,lh.ou),lh.DISABLED=new lh(lh.au,0,0);var yh=(bh.prototype.start=function(t){this.No.fu.su!==lh.au&&this.Tu(t)},bh.prototype.stop=function(){this.du&&(this.du.cancel(),this.du=null)},Object.defineProperty(bh.prototype,"io",{get:function(){return null!==this.du},enumerable:!0,configurable:!0}),bh.prototype.Tu=function(t){var e=this,n=this.lu?3e5:6e4;Ys("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.du=this.wa.yr("lru_garbage_collection",n,(function(){return u(e,void 0,void 0,(function(){var e;return a(this,(function(n){switch(n.label){case 0:this.du=null,this.lu=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.Eu(this.No)];case 2:return n.sent(),[3,7];case 3:return Xa(e=n.sent())?(Ys("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Nh(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.Tu(t)];case 8:return n.sent(),[2]}}))}))}))},bh),vh=(wh.prototype.wu=function(t,e){return this.Iu.$o(t).next((function(t){return Math.floor(e/100*t)}))},wh.prototype.Ru=function(t,e){var n=this;if(0===e)return cu.resolve(vu.dr);var r=new ch(e);return this.Iu.js(t,(function(t){return r.Ja(t.sequenceNumber)})).next((function(){return n.Iu.Mo(t,(function(t){return r.Ja(t)}))})).next((function(){return r.maxValue}))},wh.prototype.Rh=function(t,e,n){return this.Iu.Rh(t,e,n)},wh.prototype.qo=function(t,e){return this.Iu.qo(t,e)},wh.prototype.mu=function(t,e){var n=this;return this.fu.su===lh.au?(Ys("LruGarbageCollector","Garbage collection skipped; disabled"),cu.resolve(fh)):this.Qo(t).next((function(r){return r<n.fu.su?(Ys("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.fu.su),fh):n.Au(t,e)}))},wh.prototype.Qo=function(t){return this.Iu.Qo(t)},wh.prototype.Au=function(t,e){var n,i,o,s,u,a,h,c=this,f=Date.now();return this.wu(t,this.fu.iu).next((function(e){return i=e>c.fu.nu?(Ys("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.fu.nu+" from "+e),c.fu.nu):e,s=Date.now(),c.Ru(t,i)})).next((function(r){return n=r,u=Date.now(),c.Rh(t,n,e)})).next((function(e){return o=e,a=Date.now(),c.qo(t,n)})).next((function(t){return h=Date.now(),Hs()<=r.DEBUG&&Ys("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(s-f)+"ms\n\tDetermined least recently used "+i+" in "+(u-s)+"ms\n\tRemoved "+o+" targets in "+(a-u)+"ms\n\tRemoved "+t+" documents in "+(h-a)+"ms\nTotal Duration: "+(h-f)+"ms"),cu.resolve({Xa:!0,Za:i,tu:o,eu:t})}))},wh),mh=(gh.prototype.start=function(){return Promise.resolve()},gh.prototype.Su=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i=this;return a(this,(function(o){switch(o.label){case 0:return e=this.Wn,n=this.bu,[4,this.persistence.runTransaction("Handle user change","readonly",(function(r){var o;return i.Wn.ea(r).next((function(s){return o=s,e=i.persistence.yo(t),n=new du(i.yu,e,i.persistence.Do()),e.ea(r)})).next((function(t){for(var e=[],i=[],s=ms(),u=0,a=o;u<a.length;u++){var h=a[u];e.push(h.batchId);for(var c=0,f=h.mutations;c<f.length;c++){var l=f[c];s=s.add(l.key)}}for(var p=0,d=t;p<d.length;p++){var y=d[p];i.push(y.batchId);for(var v=0,m=y.mutations;v<m.length;v++){var g=m[v];s=s.add(g.key)}}return n.Yn(r,s).next((function(t){return{Du:t,Cu:e,Fu:i}}))}))}))];case 1:return r=o.sent(),[2,(this.Wn=e,this.bu=n,this.Pu.vu(this.bu),r)]}}))}))},gh.prototype.Nu=function(t){var e,n=this,r=Vr.now(),i=t.reduce((function(t,e){return t.add(e.key)}),ms());return this.persistence.runTransaction("Locally write mutations","readwrite",(function(o){return n.bu.Yn(o,i).next((function(i){e=i;for(var s=[],u=0,a=t;u<a.length;u++){var h=a[u],c=h.Pt(e.get(h.key));null!=c&&s.push(new zi(h.key,c,uo(c.proto.mapValue),Fi.exists(!0)))}return n.Wn.Yo(o,r,s,t)}))})).then((function(t){var n=t.In(e);return{batchId:t.batchId,Dn:n}}))},gh.prototype.Ko=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(n){var r=t.batch.keys(),i=e.yu.zr({Yr:!0});return e.Wn.Ko(n,t.batch,t.streamToken).next((function(){return e.$u(n,t,i)})).next((function(){return i.apply(n)})).next((function(){return e.Wn.ra(n)})).next((function(){return e.bu.Yn(n,r)}))}))},gh.prototype.ku=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",(function(n){var r;return e.Wn.Jo(n,t).next((function(t){return Zs(null!==t),r=t.keys(),e.Wn.ia(n,t)})).next((function(){return e.Wn.ra(n)})).next((function(){return e.bu.Yn(n,r)}))}))},gh.prototype.ta=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.Wn.ta(e)}))},gh.prototype.zo=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",(function(e){return t.Wn.zo(e)}))},gh.prototype.Ho=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",(function(n){return e.Wn.Ho(n,t)}))},gh.prototype.ah=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.zh.ah(e)}))},gh.prototype.Mu=function(t){var e=this,n=t.Ee,r=this.Vu;return this.persistence.runTransaction("Apply remote event","readwrite-primary",(function(i){var o=e.yu.zr({Yr:!0});r=e.Vu;var s=[];t.as.forEach((function(t,o){var u=r.get(o);if(u){s.push(e.zh.yh(i,t.Is,o).next((function(){return e.zh.gh(i,t.Ts,o)})));var a=t.resumeToken;if(0<a.rt()){var h=u.we(a,n).Ie(i.Mh);r=r.me(o,h),gh.Lu(u,h,t)&&s.push(e.zh.Eh(i,h))}}}));var u=cs(),a=ms();if(t.cs.forEach((function(t,e){a=a.add(t)})),s.push(o.getEntries(i,a).next((function(r){t.cs.forEach((function(a,h){var c=r.get(a);h instanceof Io&&h.version.isEqual(Pr.min())?(o.kn(a,n),u=u.me(a,h)):null==c||0<h.version.S(c.version)||0===h.version.S(c.version)&&c.hasPendingWrites?(o.Nn(h,n),u=u.me(a,h)):Ys("LocalStore","Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",h.version),t._s.has(a)&&s.push(e.persistence.nh.Uo(i,a))}))}))),!n.isEqual(Pr.min())){var h=e.zh.ah(i).next((function(t){return e.zh.lh(i,i.Mh,n)}));s.push(h)}return cu.vn(s).next((function(){return o.apply(i)})).next((function(){return e.bu.Jn(i,u)}))})).then((function(t){return e.Vu=r,t}))},gh.Lu=function(t,e,n){return Zs(0<e.resumeToken.rt()),0===t.resumeToken.rt()||e.Ee.D()-t.Ee.D()>=this.Ou||0<n.Ts.size+n.Es.size+n.Is.size},gh.prototype.xu=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,o,s,u,h,c=this;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return cu.forEach(t,(function(t){return cu.forEach(t.hr,(function(n){return c.persistence.nh.ph(e,t.targetId,n)})).next((function(){return cu.forEach(t.or,(function(n){return c.persistence.nh.bh(e,t.targetId,n)}))}))}))}))];case 1:return a.sent(),[3,3];case 2:if(!Xa(e=a.sent()))throw e;return Ys("LocalStore","Failed to update sequence numbers: "+e),[3,3];case 3:for(n=0,r=t;n<r.length;n++)i=r[n],o=i.targetId,i.fromCache||(s=this.Vu.get(o),u=s.Ee,h=s.Re(u),this.Vu=this.Vu.me(o,h));return[2]}}))}))},gh.prototype.Bu=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",(function(n){return void 0===t&&(t=-1),e.Wn.Zo(n,t)}))},gh.prototype.qu=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",(function(n){return e.bu.Kn(n,t)}))},gh.prototype.Uu=function(t){var e=this;return this.persistence.runTransaction("Allocate target","readwrite",(function(n){var r;return e.zh.Vh(n,t).next((function(i){return i?(r=i,cu.resolve(r)):e.zh.rh(n).next((function(i){return r=new Lo(t,i,0,n.Mh),e.zh.dh(n,r).next((function(){return r}))}))}))})).then((function(n){return null===e.Vu.get(n.targetId)&&(e.Vu=e.Vu.me(n.targetId,n),e.gu.set(t,n.targetId)),n}))},gh.prototype.Vh=function(t,e){var n=this.gu.get(e);return void 0!==n?cu.resolve(this.Vu.get(n)):this.zh.Vh(t,e)},gh.prototype.Qu=function(t,e){var n=this,r=this.Vu.get(t),i=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release target",i,(function(t){return e?cu.resolve():n.persistence.nh.removeTarget(t,r)})).then((function(){n.Vu=n.Vu.remove(t),n.gu.delete(r.target)}))},gh.prototype.Wu=function(t,e){var n=this,r=Pr.min(),i=ms();return this.persistence.runTransaction("Execute query","readonly",(function(o){return n.Vh(o,t.ee()).next((function(t){if(t)return r=t.lastLimboFreeSnapshotVersion,n.zh.vh(o,t.targetId).next((function(t){i=t}))})).next((function(){return n.Pu.Zn(o,t,e?r:Pr.min(),e?i:ms())})).next((function(t){return{documents:t,ju:i}}))}))},gh.prototype.$u=function(t,e,n){var r=this,i=e.batch,o=i.keys(),s=cu.resolve();return o.forEach((function(r){s=s.next((function(){return n.Mn(t,r)})).next((function(t){var o=t,s=e.Rn.get(r);Zs(null!==s),(!o||o.version.S(s)<0)&&(o=i.at(r,o,e))&&n.Nn(o,e.wn)}))})),s.next((function(){return r.Wn.ia(t,i)}))},gh.prototype.Eu=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return t.mu(n,e.Vu)}))},gh);function gh(t,e,n){this.persistence=t,this.Pu=e,this.Vu=new Jo(nu),this.gu=new uu((function(t){return t.canonicalId()})),this.pu=Pr.min(),this.Wn=t.yo(n),this.yu=t.So(),this.zh=t.vo(),this.bu=new du(this.yu,this.Wn,this.persistence.Do()),this.Pu.vu(this.bu)}function wh(t,e){this.Iu=t,this.fu=e}function bh(t,e){this.No=t,this.wa=e,this.lu=!1,this.du=null}mh.Ou=3e8;var Eh,Th=(s(Ih,Eh=mh),Ih.prototype.start=function(){return this.Ku()},Ih.prototype.Gu=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",(function(n){return e.Wn.Xo(n,t).next((function(t){return t?e.bu.Yn(n,t):cu.resolve(null)}))}))},Ih.prototype.zu=function(t){this.Wn.na(t)},Ih.prototype.ho=function(t){this.persistence.ho(t)},Ih.prototype.po=function(){return this.persistence.po()},Ih.prototype.Hu=function(t){var e=this,n=this.Vu.get(t);return n?Promise.resolve(n.target):this.persistence.runTransaction("Get target data","readonly",(function(n){return e.zh.si(n,t).next((function(t){return t?t.target:null}))}))},Ih.prototype.Wr=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",(function(e){return t.yu.Wr(e,t.pu)})).then((function(e){var n=e.jr,r=e.readTime;return t.pu=r,n}))},Ih.prototype.Ku=function(){return u(this,void 0,void 0,(function(){var t,e=this;return a(this,(function(n){switch(n.label){case 0:return[4,(t=this).persistence.runTransaction("Synchronize last document change read time","readonly",(function(t){return e.yu.Gr(t)}))];case 1:return t.pu=n.sent(),[2]}}))}))},Ih);function Ih(t,e,n){var r=this;return(r=Eh.call(this,t,e,n)||this).persistence=t,r.Wn=t.yo(n),r.yu=t.So(),r.zh=t.vo(),r}function Nh(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){if(t.code!==Sr.FAILED_PRECONDITION||t.message!==lu)throw t;return Ys("LocalStore","Unexpectedly lost primary lease"),[2]}))}))}var _h=(Dh.prototype.B=function(){return this.Yu.B()},Dh.prototype.ph=function(t,e){var n=new Ah(t,e);this.Yu=this.Yu.add(n),this.Xu=this.Xu.add(n)},Dh.prototype.tc=function(t,e){var n=this;t.forEach((function(t){return n.ph(t,e)}))},Dh.prototype.bh=function(t,e){this.ec(new Ah(t,e))},Dh.prototype.sc=function(t,e){var n=this;t.forEach((function(t){return n.bh(t,e)}))},Dh.prototype.ic=function(t){var e=this,n=Xr.EMPTY,r=new Ah(n,t),i=new Ah(n,t+1),o=[];return this.Xu.Ke([r,i],(function(t){e.ec(t),o.push(t.key)})),o},Dh.prototype.nc=function(){var t=this;this.Yu.forEach((function(e){return t.ec(e)}))},Dh.prototype.ec=function(t){this.Yu=this.Yu.delete(t),this.Xu=this.Xu.delete(t)},Dh.prototype.rc=function(t){var e=Xr.EMPTY,n=new Ah(e,t),r=new Ah(e,t+1),i=ms();return this.Xu.Ke([n,r],(function(t){i=i.add(t.key)})),i},Dh.prototype.Dh=function(t){var e=new Ah(t,0),n=this.Yu.ze(e);return null!==n&&t.isEqual(n.key)},Dh),Ah=(Sh.Ju=function(t,e){return Xr.N(t.key,e.key)||nu(t.hc,e.hc)},Sh.Zu=function(t,e){return nu(t.hc,e.hc)||Xr.N(t.key,e.key)},Sh);function Sh(t,e){this.key=t,this.hc=e}function Dh(){this.Yu=new os(Ah.Ju),this.Xu=new os(Ah.Zu)}function kh(t,e){if(0!==e.length)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+Qh(e.length,"argument")+".")}function xh(t,e,n){if(e.length!==n)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires "+Qh(n,"argument")+", but was called with "+Qh(e.length,"argument")+".")}function Oh(t,e,n){if(e.length<n)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires at least "+Qh(n,"argument")+", but was called with "+Qh(e.length,"argument")+".")}function Rh(t,e,n,r){if(e.length<n||e.length>r)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+Qh(e.length,"argument")+".")}function Vh(t,e,n,r){jh(t,e,Wh(n)+" argument",r)}function Ph(t,e,n,r){void 0!==r&&Vh(t,e,n,r)}function Lh(t,e,n,r){jh(t,e,n+" option",r)}function Ch(t,e,n,r){void 0!==r&&Lh(t,e,n,r)}function Mh(t,e,n,r,i){void 0!==r&&function(t,e,n){for(var r=[],o=0,s=i;o<s.length;o++){var u=s[o];if(u===n)return;r.push(qh(u))}var a=qh(n);throw new Dr(Sr.INVALID_ARGUMENT,"Invalid value "+a+" provided to function "+t+'() for option "'+e+'". Acceptable values: '+r.join(", "))}(t,n,r)}function jh(t,e,n,r){if(!("object"===e?Uh(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=qh(r);throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Uh(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function qh(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return 20<t.length&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"!=typeof t)return"function"==typeof t?"a function":Js();if(t instanceof Array)return"an array";var e=function(){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&1<e.length)return e[1]}return null}();return e?"a custom "+e+" object":"an object"}function Fh(t,e,n){if(void 0===n)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+Wh(e)+" argument, but it was undefined.")}function Bh(t,e,n){Zr(e,(function(e,r){if(n.indexOf(e)<0)throw new Dr(Sr.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))}))}function Gh(t,e,n,r){var i=qh(r);return new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires its "+Wh(n)+" argument to be a "+e+", but it was: "+i)}function zh(t,e,n){if(n<=0)throw new Dr(Sr.INVALID_ARGUMENT,'Function "'+t+'()" requires its '+Wh(e)+" argument to be a positive number, but it was: "+n+".")}function Wh(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function Qh(t,e){return t+" "+e+(1===t?"":"s")}function Hh(){if("undefined"==typeof Uint8Array)throw new Dr(Sr.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function Kh(){if(!zs.nt().oc)throw new Dr(Sr.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var Yh=(Jh.fromBase64String=function(t){xh("Blob.fromBase64String",arguments,1),Vh("Blob.fromBase64String","string",1,t),Kh();try{return new Jh(ei.fromBase64String(t))}catch(t){throw new Dr(Sr.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},Jh.fromUint8Array=function(t){if(xh("Blob.fromUint8Array",arguments,1),Hh(),!(t instanceof Uint8Array))throw Gh("Blob.fromUint8Array","Uint8Array",1,t);return new Jh(ei.fromUint8Array(t))},Jh.prototype.toBase64=function(){return xh("Blob.toBase64",arguments,0),Kh(),this.ac.toBase64()},Jh.prototype.toUint8Array=function(){return xh("Blob.toUint8Array",arguments,0),Hh(),this.ac.toUint8Array()},Jh.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},Jh.prototype.isEqual=function(t){return this.ac.isEqual(t.ac)},Jh),Xh=($h.documentId=function(){return $h.cc},$h.prototype.isEqual=function(t){if(!(t instanceof $h))throw Gh("isEqual","FieldPath",1,t);return this.uc.isEqual(t.uc)},$h);function $h(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(){if(!(t instanceof Array)||t.length<1)throw new Dr(Sr.INVALID_ARGUMENT,"Function FieldPath() requires its fieldNames argument to be an array with at least 1 element.")}();for(var n=0;n<t.length;++n)if(Vh("FieldPath","string",n,t[n]),0===t[n].length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this.uc=new Kr(t)}function Jh(t){Kh(),this.ac=t}Xh.cc=new Xh(Kr.J().j());var Zh,tc,ec,nc,rc,ic=new RegExp("[~\\*/\\[\\]]"),oc=function(t){this._c=t},sc=(s(Tc,rc=oc),Tc.prototype.Di=function(t){if(2!==t.lc)throw 1===t.lc?t.dc("FieldValue.delete() can only appear at the top level of your update data"):t.dc("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");return t.Vt.push(t.path),null},Tc.prototype.isEqual=function(t){return t instanceof Tc},Tc),uc=(s(Ec,nc=oc),Ec.prototype.Di=function(t){return new qi(t.path,Ni.instance)},Ec.prototype.isEqual=function(t){return t instanceof Ec},Ec),ac=(s(bc,ec=oc),bc.prototype.Di=function(t){var e=new Nc({lc:3,methodName:this._c,Tc:!0},t.ii,t.serializer),n=this.fc.map((function(t){return Dc(t,e)})),r=new Ai(n);return new qi(t.path,r)},bc.prototype.isEqual=function(t){return this===t},bc),hc=(s(wc,tc=oc),wc.prototype.Di=function(t){var e=new Nc({lc:3,methodName:this._c,Tc:!0},t.ii,t.serializer),n=this.fc.map((function(t){return Dc(t,e)})),r=new Si(n);return new qi(t.path,r)},wc.prototype.isEqual=function(t){return this===t},wc),cc=(s(gc,Zh=oc),gc.prototype.Di=function(t){var e=new Nc({lc:3,methodName:this._c},t.ii,t.serializer),n=Dc(this.Ec,e),r=new Di(t.serializer,n);return new qi(t.path,r)},gc.prototype.isEqual=function(t){return this===t},gc),fc=(Object.defineProperty(mc.prototype,"latitude",{get:function(){return this.Ic},enumerable:!0,configurable:!0}),Object.defineProperty(mc.prototype,"longitude",{get:function(){return this.wc},enumerable:!0,configurable:!0}),mc.prototype.isEqual=function(t){return this.Ic===t.Ic&&this.wc===t.wc},mc.prototype.p=function(t){return nu(this.Ic,t.Ic)||nu(this.wc,t.wc)},mc),lc=/^__.*__$/,pc=(vc.prototype.Rc=function(t,e){var n=[];return null!==this.Vt?n.push(new zi(t,this.data,this.Vt,e)):n.push(new Gi(t,this.data,e)),0<this.fieldTransforms.length&&n.push(new Wi(t,this.fieldTransforms)),n},vc),dc=(yc.prototype.Rc=function(t,e){var n=[new zi(t,this.data,this.Vt,e)];return 0<this.fieldTransforms.length&&n.push(new Wi(t,this.fieldTransforms)),n},yc);function yc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function vc(t,e,n){this.data=t,this.Vt=e,this.fieldTransforms=n}function mc(t,e){if(xh("GeoPoint",arguments,2),Vh("GeoPoint","number",1,t),Vh("GeoPoint","number",2,e),!isFinite(t)||t<-90||90<t)throw new Dr(Sr.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||180<e)throw new Dr(Sr.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this.Ic=t,this.wc=e}function gc(t){var e=this;return(e=Zh.call(this,"FieldValue.increment")||this).Ec=t,e}function wc(t){var e=this;return(e=tc.call(this,"FieldValue.arrayRemove")||this).fc=t,e}function bc(t){var e=this;return(e=ec.call(this,"FieldValue.arrayUnion")||this).fc=t,e}function Ec(){return nc.call(this,"FieldValue.serverTimestamp")||this}function Tc(){return rc.call(this,"FieldValue.delete")||this}function Ic(t){switch(t){case 0:case 2:case 1:return 1;case 3:case 4:return;default:throw Js()}}var Nc=(Object.defineProperty(Sc.prototype,"path",{get:function(){return this.settings.path},enumerable:!0,configurable:!0}),Object.defineProperty(Sc.prototype,"lc",{get:function(){return this.settings.lc},enumerable:!0,configurable:!0}),Sc.prototype.Ac=function(t){return new Sc(Object.assign(Object.assign({},this.settings),t),this.ii,this.serializer,this.fieldTransforms,this.Vt)},Sc.prototype.Pc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Ac({path:n,Tc:!1});return r.Vc(t),r},Sc.prototype.gc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Ac({path:n,Tc:!1});return r.mc(),r},Sc.prototype.pc=function(t){return this.Ac({path:void 0,Tc:!0})},Sc.prototype.dc=function(t){var e=!this.path||this.path.B()?"":" (found in field "+this.path.toString()+")";return new Dr(Sr.INVALID_ARGUMENT,"Function "+this.settings.methodName+"() called with invalid data. "+t+e)},Sc.prototype.contains=function(t){return void 0!==this.Vt.find((function(e){return t.q(e)}))||void 0!==this.fieldTransforms.find((function(e){return t.q(e.field)}))},Sc.prototype.mc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.Vc(this.path.get(t))},Sc.prototype.Vc=function(t){if(0===t.length)throw this.dc("Document fields must not be empty");if(Ic(this.lc)&&lc.test(t))throw this.dc('Document fields cannot begin and end with "__"')},Sc),_c=(Ac.prototype.bc=function(t,e){var n=this.vc(0,t);Oc("Data must be an object, but it was:",n,e);var r=kc(e,n);return new pc(new Ki(r),null,n.fieldTransforms)},Ac.prototype.Sc=function(t,e,n){var r=this.vc(2,t);Oc("Data must be an object, but it was:",r,e);var i,o,s=kc(e,r);if(n){for(var u=[],a=0,h=n;a<h.length;a++){var c=h[a],f=void 0;if(c instanceof Xh)f=c.uc;else{if("string"!=typeof c)throw Js();f=Vc(t,c)}if(!r.contains(f))throw new Dr(Sr.INVALID_ARGUMENT,"Field '"+f+"' is specified in your field mask but missing from your input data.");Pc(u,f)||u.push(f)}i=new Ui(u),o=r.fieldTransforms.filter((function(t){return i.dt(t.field)}))}else i=new Ui(r.Vt),o=r.fieldTransforms;return new pc(new Ki(s),i,o)},Ac.prototype.Dc=function(t,e){var n=this.vc(1,t);Oc("Data must be an object, but it was:",n,e);var r=[],i=new Yi;Zr(e,(function(e,o){var s=Vc(t,e),u=n.gc(s);if(o instanceof sc)r.push(s);else{var a=Dc(o,u);null!=a&&(r.push(s),i.set(s,a))}}));var o=new Ui(r);return new dc(i.yt(),o,n.fieldTransforms)},Ac.prototype.Cc=function(t,e,n,r){var i=this.vc(1,t),o=[Rc(t,e)],s=[n];if(r.length%2!=0)throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var u=0;u<r.length;u+=2)o.push(Rc(t,r[u])),s.push(r[u+1]);for(var a=[],h=new Yi,c=o.length-1;0<=c;--c)if(!Pc(a,o[c])){var f=o[c],l=s[c],p=i.gc(f);if(l instanceof sc)a.push(f);else{var d=Dc(l,p);null!=d&&(a.push(f),h.set(f,d))}}var y=new Ui(a);return new dc(h.yt(),y,i.fieldTransforms)},Ac.prototype.vc=function(t,e){return new Nc({lc:t,methodName:e,path:Kr.G,Tc:!1},this.ii,this.serializer)},Ac.prototype.Fc=function(t,e,n){return void 0===n&&(n=!1),Dc(e,this.vc(n?4:3,t))},Ac);function Ac(t,e){this.ii=t,this.serializer=e||zs.nt().yc(t)}function Sc(t,e,n,r,i){this.settings=t,this.ii=e,this.serializer=n,void 0===r&&this.mc(),this.fieldTransforms=r||[],this.Vt=i||[]}function Dc(t,e){if(xc(t))return Oc("Unsupported field value:",e,t),kc(t,e);if(t instanceof oc)return function(t,e){if(!Ic(e.lc))throw e.dc(t._c+"() can only be used with update() and set()");if(null===e.path)throw e.dc(t._c+"() is not currently supported inside arrays");var n=t.Di(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(e.path&&e.Vt.push(e.path),t instanceof Array){if(e.settings.Tc&&4!==e.lc)throw e.dc("Nested arrays are not supported");return function(e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Dc(o[i],e.pc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(e)}return function(t,e){if(null===t)return{nullValue:"NULL_VALUE"};if("number"==typeof t)return e.serializer.ai(t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=Vr.fromDate(t);return{timestampValue:e.serializer.C(n)}}if(t instanceof Vr){var r=new Vr(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:e.serializer.C(r)}}if(t instanceof fc)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof Yh)return{bytesValue:e.serializer.ui(t)};if(t instanceof yl){var i=e.ii,o=t.firestore.Nc;if(!o.isEqual(i))throw e.dc("Document reference is for database "+o.projectId+"/"+o.database+" but should be for database "+i.projectId+"/"+i.database);return{referenceValue:e.serializer._i(t.$c.path,t.firestore.Nc)}}throw e.dc("Unsupported field value: "+qh(t))}(t,e)}function kc(t,e){var n={};return ti(t)?e.path&&0<e.path.length&&e.Vt.push(e.path):Zr(t,(function(t,r){var i=Dc(r,e.Pc(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}function xc(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Vr||t instanceof fc||t instanceof Yh||t instanceof yl||t instanceof oc)}function Oc(t,e,n){if(!xc(n)||!Uh(n)){var r=qh(n);throw"an object"===r?e.dc(t+" a custom object"):e.dc(t+" "+r)}}function Rc(t,e){if(e instanceof Xh)return e.uc;if("string"==typeof e)return Vc(t,e);throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Vc(t,e){try{return function(e){if(0<=e.search(ic))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(Xh.bind.apply(Xh,h([void 0],e.split("."))))}catch(t){throw new Dr(Sr.INVALID_ARGUMENT,"Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e).uc}catch(e){var n=e instanceof Error?e.message:e.toString();throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function Pc(t,e){return t.some((function(t){return t.isEqual(e)}))}var Lc,Cc,Mc,jc=($c.prototype.Bc=function(){return 1===this.state||2===this.state||4===this.state},$c.prototype.qc=function(){return 2===this.state},$c.prototype.start=function(){3!==this.state?this.auth():this.Uc()},$c.prototype.stop=function(){return u(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.Bc()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},$c.prototype.Qc=function(){this.state=0,this.Na.reset()},$c.prototype.Wc=function(){var t=this;this.qc()&&null===this.xc&&(this.xc=this.Tr.yr(this.kc,6e4,(function(){return t.jc()})))},$c.prototype.Kc=function(t){this.Gc(),this.stream.send(t)},$c.prototype.jc=function(){return u(this,void 0,void 0,(function(){return a(this,(function(t){return this.qc()?[2,this.close(0)]:[2]}))}))},$c.prototype.Gc=function(){this.xc&&(this.xc.cancel(),this.xc=null)},$c.prototype.close=function(t,e){return u(this,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return this.Gc(),this.Na.cancel(),this.Oc++,3!==t?this.Na.reset():e&&e.code===Sr.RESOURCE_EXHAUSTED?(Xs(e.toString()),Xs("Using maximum backoff delay to prevent overloading the backend."),this.Na.Vr()):e&&e.code===Sr.UNAUTHENTICATED&&this.Lc._(),null!==this.stream&&(this.zc(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Hc(e)];case 1:return n.sent(),[2]}}))}))},$c.prototype.zc=function(){},$c.prototype.auth=function(){var t=this;this.state=1;var e=this.Yc(this.Oc),n=this.Oc;this.Lc.getToken().then((function(e){t.Oc===n&&t.Jc(e)}),(function(n){e((function(){var e=new Dr(Sr.UNKNOWN,"Fetching auth token failed: "+n.message);return t.Xc(e)}))}))},$c.prototype.Jc=function(t){var e=this,n=this.Yc(this.Oc);this.stream=this.Zc(t),this.stream.t_((function(){n((function(){return e.state=2,e.listener.t_()}))})),this.stream.Hc((function(t){n((function(){return e.Xc(t)}))})),this.stream.onMessage((function(t){n((function(){return e.onMessage(t)}))}))},$c.prototype.Uc=function(){var t=this;this.state=4,this.Na.gr((function(){return u(t,void 0,void 0,(function(){return a(this,(function(t){return this.state=0,this.start(),[2]}))}))}))},$c.prototype.Xc=function(t){return Ys("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},$c.prototype.Yc=function(t){var e=this;return function(n){e.Tr.oo((function(){return e.Oc===t?n():(Ys("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}},$c),Uc=(s(Xc,Mc=jc),Xc.prototype.Zc=function(t){return this.Mc.e_("Listen",t)},Xc.prototype.onMessage=function(t){this.Na.reset();var e=this.serializer.pi(t),n=this.serializer.bi(t);return this.listener.s_(e,n)},Xc.prototype.i_=function(t){var e={};e.database=this.serializer.wi,e.addTarget=this.serializer.ee(t);var n=this.serializer.zi(t);n&&(e.labels=n),this.Kc(e)},Xc.prototype.n_=function(t){var e={};e.database=this.serializer.wi,e.removeTarget=t,this.Kc(e)},Xc),qc=(s(Yc,Cc=jc),Object.defineProperty(Yc.prototype,"h_",{get:function(){return this.r_},enumerable:!0,configurable:!0}),Yc.prototype.start=function(){this.r_=!1,Cc.prototype.start.call(this)},Yc.prototype.zc=function(){this.r_&&this.o_([])},Yc.prototype.Zc=function(t){return this.Mc.e_("Write",t)},Yc.prototype.onMessage=function(t){if(Zs(!!t.streamToken),this.lastStreamToken=this.serializer.ci(t.streamToken),this.r_){this.Na.reset();var e=this.serializer.Li(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.a_(n,e)}return Zs(!t.writeResults||0===t.writeResults.length),this.r_=!0,this.listener.u_()},Yc.prototype.c_=function(){var t={};t.database=this.serializer.wi,this.Kc(t)},Yc.prototype.o_=function(t){var e=this,n={streamToken:this.serializer.ui(this.lastStreamToken),writes:t.map((function(t){return e.serializer.vi(t)}))};this.Kc(n)},Yc),Fc=(s(Kc,Lc=function(){this.__=void 0}),Kc.prototype.l_=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.Mc.l_(t,e,r)})).catch((function(t){throw t.code===Sr.UNAUTHENTICATED&&n.credentials._(),t}))},Kc.prototype.d_=function(t,e){var n=this;return this.credentials.getToken().then((function(r){return n.Mc.d_(t,e,r)})).catch((function(t){throw t.code===Sr.UNAUTHENTICATED&&n.credentials._(),t}))},Kc),Bc=(Hc.prototype.R_=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:if(this.m_(),0<this.mutations.length)throw new Dr(Sr.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s;return a(this,(function(u){switch(u.label){case 0:return r={database:(n=t).serializer.wi,documents:e.map((function(t){return n.serializer.fi(t)}))},[4,n.d_("BatchGetDocuments",r)];case 1:return i=u.sent(),o=new Map,i.forEach((function(t){var e=n.serializer.gi(t);o.set(e.key.toString(),e)})),s=[],[2,(e.forEach((function(t){var e=o.get(t.toString());Zs(!!e),s.push(e)})),s)]}}))}))}(this.f_,t)];case 1:return[2,((e=r.sent()).forEach((function(t){t instanceof Io||t instanceof To?n.A_(t):Js()})),e)]}}))}))},Hc.prototype.set=function(t,e){this.write(e.Rc(t,this.Rt(t))),this.w_.add(t)},Hc.prototype.update=function(t,e){try{this.write(e.Rc(t,this.P_(t)))}catch(t){this.I_=t}this.w_.add(t)},Hc.prototype.delete=function(t){this.write([new Qi(t,this.Rt(t))]),this.w_.add(t)},Hc.prototype.commit=function(){return u(this,void 0,void 0,(function(){var t,e=this;return a(this,(function(n){switch(n.label){case 0:if(this.m_(),this.I_)throw this.I_;return t=this.T_,this.mutations.forEach((function(e){t=t.remove(e.key)})),t.forEach((function(t,n){e.mutations.push(new Hi(t,e.Rt(t)))})),[4,function(t,e){return u(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:return r={database:(n=t).serializer.wi,writes:e.map((function(t){return n.serializer.vi(t)}))},[4,n.l_("Commit",r)];case 1:return i=o.sent(),[2,n.serializer.Li(i.writeResults,i.commitTime)]}}))}))}(this.f_,this.mutations)];case 1:return n.sent(),this.E_=!0,[2]}}))}))},Hc.prototype.A_=function(t){var e;if(t instanceof To)e=t.version;else{if(!(t instanceof Io))throw Js();e=Pr.min()}var n=this.T_.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Dr(Sr.ABORTED,"Document version changed between two reads.")}else this.T_=this.T_.me(t.key,e)},Hc.prototype.Rt=function(t){var e=this.T_.get(t);return!this.w_.has(t)&&e?Fi.updateTime(e):Fi.ft()},Hc.prototype.P_=function(t){var e=this.T_.get(t);if(this.w_.has(t)||!e)return Fi.exists(!0);if(e.isEqual(Pr.min()))throw new Dr(Sr.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Fi.updateTime(e)},Hc.prototype.write=function(t){this.m_(),this.mutations=this.mutations.concat(t)},Hc.prototype.m_=function(){},Hc),Gc=(Qc.prototype.b_=function(){var t=this;0===this.g_&&(this.v_("Unknown"),this.p_=this.wa.yr("online_state_timeout",1e4,(function(){return t.p_=null,t.S_("Backend didn't respond within 10 seconds."),t.v_("Offline"),Promise.resolve()})))},Qc.prototype.D_=function(t){"Online"===this.state?this.v_("Unknown"):(this.g_++,1<=this.g_&&(this.C_(),this.S_("Connection failed 1 times. Most recent error: "+t.toString()),this.v_("Offline")))},Qc.prototype.set=function(t){this.C_(),this.g_=0,"Online"===t&&(this.y_=!1),this.v_(t)},Qc.prototype.v_=function(t){t!==this.state&&(this.state=t,this.V_(t))},Qc.prototype.S_=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.y_?(Xs(e),this.y_=!1):Ys("OnlineStateTracker",e)},Qc.prototype.C_=function(){null!==this.p_&&(this.p_.cancel(),this.p_=null)},Qc),zc=(Wc.prototype.start=function(){return this.enableNetwork()},Wc.prototype.enableNetwork=function(){return this.networkEnabled=!0,this.J_()},Wc.prototype.J_=function(){return u(this,void 0,void 0,(function(){var t;return a(this,(function(e){switch(e.label){case 0:return this.B_()?(t=this.G_,[4,this.F_.zo()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.X_()?this.Z_():this.U_.set("Unknown"),[4,this.tl()];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))},Wc.prototype.disableNetwork=function(){return u(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.U_.set("Offline"),[2]}}))}))},Wc.prototype.el=function(){return u(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.G_.stop()];case 1:return t.sent(),[4,this.Q_.stop()];case 2:return t.sent(),0<this.N_.length&&(Ys("RemoteStore","Stopping write stream with "+this.N_.length+" pending writes"),this.N_=[]),this.sl(),[2]}}))}))},Wc.prototype.Ro=function(){return u(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return Ys("RemoteStore","RemoteStore shutting down."),this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.O_.Ro(),this.U_.set("Unknown"),[2]}}))}))},Wc.prototype.listen=function(t){this.k_.has(t.targetId)||(this.k_.set(t.targetId,t),this.X_()?this.Z_():this.Q_.qc()&&this.il(t))},Wc.prototype.nl=function(t){this.k_.delete(t),this.Q_.qc()&&this.rl(t),0===this.k_.size&&(this.Q_.qc()?this.Q_.Wc():this.B_()&&this.U_.set("Unknown"))},Wc.prototype.si=function(t){return this.k_.get(t)||null},Wc.prototype.ei=function(t){return this.hl.ei(t)},Wc.prototype.il=function(t){this.M_.Ns(t.targetId),this.Q_.i_(t)},Wc.prototype.rl=function(t){this.M_.Ns(t),this.Q_.n_(t)},Wc.prototype.Z_=function(){this.M_=new ks(this),this.Q_.start(),this.U_.b_()},Wc.prototype.X_=function(){return this.B_()&&!this.Q_.Bc()&&0<this.k_.size},Wc.prototype.B_=function(){return!this.L_&&this.isPrimary&&this.networkEnabled},Wc.prototype.sl=function(){this.M_=null},Wc.prototype.W_=function(){return u(this,void 0,void 0,(function(){var t=this;return a(this,(function(e){return this.k_.forEach((function(e,n){t.il(e)})),[2]}))}))},Wc.prototype.j_=function(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){return this.sl(),this.X_()?(this.U_.D_(t),this.Z_()):this.U_.set("Unknown"),[2]}))}))},Wc.prototype.K_=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:if(this.U_.set("Online"),!(t instanceof Ts&&2===t.state&&t.cause))return[3,6];o.label=1;case 1:return o.trys.push([1,3,,5]),[4,this.ol(t)];case 2:return o.sent(),[3,5];case 3:return n=o.sent(),Ys("RemoteStore","Failed to remove targets %s: %s ",t.targetIds.join(","),n),[4,this.al(n)];case 4:return o.sent(),[3,5];case 5:return[3,13];case 6:if(t instanceof bs?this.M_.qs(t):t instanceof Es?this.M_.Hs(t):this.M_.Ws(t),e.isEqual(Pr.min()))return[3,13];o.label=7;case 7:return o.trys.push([7,11,,13]),[4,this.F_.ah()];case 8:return r=o.sent(),0<=e.S(r)?[4,this.ul(e)]:[3,10];case 9:o.sent(),o.label=10;case 10:return[3,13];case 11:return Ys("RemoteStore","Failed to raise snapshot:",i=o.sent()),[4,this.al(i)];case 12:return o.sent(),[3,13];case 13:return[2]}}))}))},Wc.prototype.al=function(t){return u(this,void 0,void 0,(function(){var e=this;return a(this,(function(n){switch(n.label){case 0:if(!Xa(t))throw t;return this.L_=!0,[4,this.el()];case 1:return n.sent(),this.U_.set("Offline"),this.wa.Ua((function(){return u(e,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return Ys("RemoteStore","Retrying IndexedDB access"),[4,this.F_.ah()];case 1:return t.sent(),this.L_=!1,[4,this.J_()];case 2:return t.sent(),[2]}}))}))})),[2]}}))}))},Wc.prototype.ul=function(t){var e=this,n=this.M_.Xs(t);return n.as.forEach((function(n,r){if(0<n.resumeToken.rt()){var i=e.k_.get(r);i&&e.k_.set(r,i.we(n.resumeToken,t))}})),n.us.forEach((function(t){var n=e.k_.get(t);if(n){e.k_.set(t,n.we(ei.ht,n.Ee)),e.rl(t);var r=new Lo(n.target,t,1,n.sequenceNumber);e.il(r)}})),this.hl.Mu(n)},Wc.prototype.ol=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i;return a(this,(function(o){switch(o.label){case 0:e=t.cause,n=0,r=t.targetIds,o.label=1;case 1:return n<r.length?(i=r[n],this.k_.has(i)?[4,this.hl.cl(i,e)]:[3,3]):[3,5];case 2:o.sent(),this.k_.delete(i),this.M_.removeTarget(i),o.label=3;case 3:o.label=4;case 4:return n++,[3,1];case 5:return[2]}}))}))},Wc.prototype.tl=function(){return u(this,void 0,void 0,(function(){var t,e;return a(this,(function(n){switch(n.label){case 0:return this._l()?(t=0<this.N_.length?this.N_[this.N_.length-1].batchId:-1,[4,this.F_.Bu(t)]):[3,5];case 1:return null!==(e=n.sent())?[3,2]:(0===this.N_.length&&this.G_.Wc(),[3,4]);case 2:return this.ll(e),[4,this.tl()];case 3:n.sent(),n.label=4;case 4:n.label=5;case 5:return this.dl()&&this.fl(),[2]}}))}))},Wc.prototype._l=function(){return this.B_()&&this.N_.length<10},Wc.prototype.Tl=function(){return this.N_.length},Wc.prototype.ll=function(t){this.N_.push(t),this.G_.qc()&&this.G_.h_&&this.G_.o_(t.mutations)},Wc.prototype.dl=function(){return this.B_()&&!this.G_.Bc()&&0<this.N_.length},Wc.prototype.fl=function(){this.G_.start()},Wc.prototype.z_=function(){return u(this,void 0,void 0,(function(){return a(this,(function(t){return this.G_.c_(),[2]}))}))},Wc.prototype.Y_=function(){var t=this;return this.F_.Ho(this.G_.lastStreamToken).then((function(){for(var e=0,n=t.N_;e<n.length;e++){var r=n[e];t.G_.o_(r.mutations)}})).catch(Nh)},Wc.prototype.a_=function(t,e){var n=this,r=this.N_.shift(),i=hu.from(r,t,e,this.G_.lastStreamToken);return this.hl.El(i).then((function(){return n.tl()}))},Wc.prototype.H_=function(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return t&&0<this.N_.length?this.G_.h_?[4,this.Il(t)]:[3,2]:[3,5];case 1:return e.sent(),[3,4];case 2:return[4,this.wl(t)];case 3:e.sent(),e.label=4;case 4:this.dl()&&this.fl(),e.label=5;case 5:return[2]}}))}))},Wc.prototype.wl=function(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){return Xo(t.code)?[2,(Ys("RemoteStore","RemoteStore error before completed handshake; resetting stream token: ",this.G_.lastStreamToken),this.G_.lastStreamToken=ei.ht,this.F_.Ho(ei.ht).catch(Nh))]:[2]}))}))},Wc.prototype.Il=function(t){return u(this,void 0,void 0,(function(){var e,n,r=this;return a(this,(function(i){return Xo(n=t.code)&&n!==Sr.ABORTED?(e=this.N_.shift(),[2,(this.G_.Qc(),this.hl.Rl(e.batchId,t).then((function(){return r.tl()})))]):[2]}))}))},Wc.prototype.ml=function(){return new Bc(this.f_)},Wc.prototype.q_=function(){return u(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.el()];case 1:return t.sent(),this.U_.set("Unknown"),[4,this.enableNetwork()];case 2:return t.sent(),[2]}}))}))},Wc.prototype.Al=function(){return u(this,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.B_()?(Ys("RemoteStore","RemoteStore restarting streams for new credential"),[4,this.q_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},Wc.prototype.Pl=function(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return(this.isPrimary=t)&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,5];case 2:return t?[3,4]:[4,this.el()];case 3:e.sent(),this.U_.set("Unknown"),e.label=4;case 4:e.label=5;case 5:return[2]}}))}))},Wc);function Wc(t,e,n,r,i){var o,s,h,c,f,l,p,d,y=this;this.F_=t,this.f_=e,this.wa=n,this.N_=[],this.k_=new Map,this.M_=null,this.networkEnabled=!1,this.isPrimary=!1,this.L_=!1,this.O_=i,this.O_.x_((function(t){n.oo((function(){return u(y,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.B_()?(Ys("RemoteStore","Restarting streams for network reachability change."),[4,this.q_()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))}))})),this.U_=new Gc(n,r),this.Q_=(f=this.f_,l=n,p={t_:this.W_.bind(this),Hc:this.j_.bind(this),s_:this.K_.bind(this)},new Uc(l,(d=f).Mc,d.credentials,d.serializer,p)),this.G_=(o=this.f_,s=n,h={t_:this.z_.bind(this),Hc:this.H_.bind(this),u_:this.Y_.bind(this),a_:this.a_.bind(this)},new qc(s,(c=o).Mc,c.credentials,c.serializer,h))}function Qc(t,e){this.wa=t,this.V_=e,this.state="Unknown",this.g_=0,this.p_=null,this.y_=!0}function Hc(t){this.f_=t,this.T_=ys(),this.mutations=[],this.E_=!1,this.I_=null,this.w_=new Set}function Kc(t,e,n){var r=this;return(r=Lc.call(this)||this).Mc=t,r.credentials=e,r.serializer=n,r}function Yc(t,e,n,r,i){var o=this;return(o=Cc.call(this,t,"write_stream_connection_backoff","write_stream_idle",e,n,i)||this).serializer=r,o.r_=!1,o.lastStreamToken=ei.ht,o}function Xc(t,e,n,r,i){var o=this;return(o=Mc.call(this,t,"listen_stream_connection_backoff","listen_stream_idle",e,n,i)||this).serializer=r,o}function $c(t,e,n,r,i,o){this.Tr=t,this.kc=n,this.Mc=r,this.Lc=i,this.listener=o,this.state=0,this.Oc=0,this.xc=null,this.stream=null,this.Na=new Du(t,e)}function Jc(t,e){return"firestore_clients_"+t+"_"+e}function Zc(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.t()&&(r+="_"+e.uid),r}function tf(t,e){return"firestore_targets_"+t+"_"+e}function ef(t){this.key=t}function nf(t){this.key=t}function rf(t,e,n){this.query=t,this.targetId=e,this.view=n}function of(t){this.key=t,this.Bd=!1}function sf(){this.Vf=void 0,this.gf=[]}var uf,af,hf=(qf.Vl=function(t,e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["pending","acknowledged","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Dr(r.error.code,r.error.message)),i?new qf(t,e,r.state,o):(Xs("SharedClientState","Failed to parse mutation state for ID '"+e+"': "+n),null)},qf.prototype.gl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},qf),cf=(Uf.Vl=function(t,e){var n=JSON.parse(e),r="object"==typeof n&&-1!==["not-current","current","rejected"].indexOf(n.state)&&(void 0===n.error||"object"==typeof n.error),i=void 0;return r&&n.error&&(r="string"==typeof n.error.message&&"string"==typeof n.error.code)&&(i=new Dr(n.error.code,n.error.message)),r?new Uf(t,n.state,i):(Xs("SharedClientState","Failed to parse target state for ID '"+t+"': "+e),null)},Uf.prototype.gl=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},Uf),ff=(jf.Vl=function(t,e){for(var n=JSON.parse(e),r="object"==typeof n&&n.activeTargetIds instanceof Array,i=ws(),o=0;r&&o<n.activeTargetIds.length;++o)r=oi(n.activeTargetIds[o]),i=i.add(n.activeTargetIds[o]);return r?new jf(t,i):(Xs("SharedClientState","Failed to parse client data for instance '"+t+"': "+e),null)},jf),lf=(Mf.Vl=function(t){var e=JSON.parse(t);return"object"==typeof e&&-1!==["Unknown","Online","Offline"].indexOf(e.onlineState)&&"string"==typeof e.clientId?new Mf(e.clientId,e.onlineState):(Xs("SharedClientState","Failed to parse online state: "+t),null)},Mf),pf=(Cf.prototype.pl=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},Cf.prototype.yl=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},Cf.prototype.gl=function(){var t={activeTargetIds:this.activeTargetIds.W(),updateTimeMs:Date.now()};return JSON.stringify(t)},Cf),df=(Lf.jh=function(t){return!(!t.window||null==t.window.localStorage)},Lf.prototype.start=function(){return u(this,void 0,void 0,(function(){var t,e,n,r,i,o,s,u,h,c,f,l=this;return a(this,(function(a){switch(a.label){case 0:return[4,this.hl.po()];case 1:for(t=a.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.bl&&(i=this.getItem(Jc(this.persistenceKey,r)))&&(o=ff.Vl(r,i))&&(this.Dl=this.Dl.me(o.clientId,o));for(this.Ol(),(s=this.storage.getItem(this.Ll))&&(u=this.xl(s))&&this.Bl(u),h=0,c=this.Cl;h<c.length;h++)f=c[h],this.Sl(f);return this.Cl=[],this.platform.window.addEventListener("unload",(function(){return l.Ro()})),this.io=!0,[2]}}))}))},Lf.prototype.lr=function(t){this.setItem(this.Nl,JSON.stringify(t))},Lf.prototype.ql=function(){return this.Ul(this.Dl)},Lf.prototype.Ql=function(t){var e=!1;return this.Dl.forEach((function(n,r){r.activeTargetIds.has(t)&&(e=!0)})),e},Lf.prototype.Wl=function(t){this.jl(t,"pending")},Lf.prototype.Kl=function(t,e,n){this.jl(t,e,n),this.Gl(t)},Lf.prototype.zl=function(t){var e="not-current";if(this.Ql(t)){var n=this.storage.getItem(tf(this.persistenceKey,t));if(n){var r=cf.Vl(t,n);r&&(e=r.state)}}return this.Hl.pl(t),this.Ol(),e},Lf.prototype.Yl=function(t){this.Hl.yl(t),this.Ol()},Lf.prototype.Jl=function(t){return this.Hl.activeTargetIds.has(t)},Lf.prototype.Xl=function(t){this.removeItem(tf(this.persistenceKey,t))},Lf.prototype.Zl=function(t,e,n){this.td(t,e,n)},Lf.prototype.Su=function(t,e,n){var r=this;e.forEach((function(t){r.Gl(t)})),this.currentUser=t,n.forEach((function(t){r.Wl(t)}))},Lf.prototype.ed=function(t){this.sd(t)},Lf.prototype.Ro=function(){this.io&&(this.platform.window.removeEventListener("storage",this.vl),this.removeItem(this.Fl),this.io=!1)},Lf.prototype.getItem=function(t){var e=this.storage.getItem(t);return Ys("SharedClientState","READ",t,e),e},Lf.prototype.setItem=function(t,e){Ys("SharedClientState","SET",t,e),this.storage.setItem(t,e)},Lf.prototype.removeItem=function(t){Ys("SharedClientState","REMOVE",t),this.storage.removeItem(t)},Lf.prototype.Sl=function(t){var e=this;if(t.storageArea===this.storage){if(Ys("SharedClientState","EVENT",t.key,t.newValue),t.key===this.Fl)return void Xs("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Tr.Ua((function(){return u(e,void 0,void 0,(function(){var e,n,r,i,o,s;return a(this,(function(u){if(this.io){if(null!==t.key)if(this.$l.test(t.key)){if(null==t.newValue)return e=this.nd(t.key),[2,this.rd(e,null)];if(n=this.hd(t.key,t.newValue))return[2,this.rd(n.clientId,n)]}else if(this.kl.test(t.key)){if(null!==t.newValue&&(r=this.od(t.key,t.newValue)))return[2,this.ad(r)]}else if(this.Ml.test(t.key)){if(null!==t.newValue&&(i=this.ud(t.key,t.newValue)))return[2,this._d(i)]}else if(t.key===this.Ll){if(null!==t.newValue&&(o=this.xl(t.newValue)))return[2,this.Bl(o)]}else t.key===this.Nl&&(s=function(t){var e=vu.dr;if(null!=t)try{var n=JSON.parse(t);Zs("number"==typeof n),e=n}catch(t){Xs("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==vu.dr&&this.ur(s)}else this.Cl.push(t);return[2]}))}))}))}},Object.defineProperty(Lf.prototype,"Hl",{get:function(){return this.Dl.get(this.bl)},enumerable:!0,configurable:!0}),Lf.prototype.Ol=function(){this.setItem(this.Fl,this.Hl.gl())},Lf.prototype.jl=function(t,e,n){var r=new hf(this.currentUser,t,e,n),i=Zc(this.persistenceKey,this.currentUser,t);this.setItem(i,r.gl())},Lf.prototype.Gl=function(t){var e=Zc(this.persistenceKey,this.currentUser,t);this.removeItem(e)},Lf.prototype.sd=function(t){var e={clientId:this.bl,onlineState:t};this.storage.setItem(this.Ll,JSON.stringify(e))},Lf.prototype.td=function(t,e,n){var r=tf(this.persistenceKey,t),i=new cf(t,e,n);this.setItem(r,i.gl())},Lf.prototype.nd=function(t){var e=this.$l.exec(t);return e?e[1]:null},Lf.prototype.hd=function(t,e){var n=this.nd(t);return ff.Vl(n,e)},Lf.prototype.od=function(t,e){var n=this.kl.exec(t),r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return hf.Vl(new Tr(i),r,e)},Lf.prototype.ud=function(t,e){var n=this.Ml.exec(t),r=Number(n[1]);return cf.Vl(r,e)},Lf.prototype.xl=function(t){return lf.Vl(t)},Lf.prototype.ad=function(t){return u(this,void 0,void 0,(function(){return a(this,(function(e){return t.user.uid===this.currentUser.uid?[2,this.hl.ld(t.batchId,t.state,t.error)]:(Ys("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])}))}))},Lf.prototype._d=function(t){return this.hl.dd(t.targetId,t.state,t.error)},Lf.prototype.rd=function(t,e){var n=this,r=e?this.Dl.me(t,e):this.Dl.remove(t),i=this.Ul(this.Dl),o=this.Ul(r),s=[],u=[];return o.forEach((function(t){i.has(t)||s.push(t)})),i.forEach((function(t){o.has(t)||u.push(t)})),this.hl.fd(s,u).then((function(){n.Dl=r}))},Lf.prototype.Bl=function(t){this.Dl.get(t.clientId)&&this.V_(t.onlineState)},Lf.prototype.Ul=function(t){var e=ws();return t.forEach((function(t,n){e=e.He(n.activeTargetIds)})),e},Lf),yf=(Pf.prototype.Wl=function(t){},Pf.prototype.Kl=function(t,e,n){},Pf.prototype.zl=function(t){return this.Td.pl(t),this.Ed[t]||"not-current"},Pf.prototype.Zl=function(t,e,n){this.Ed[t]=e},Pf.prototype.Yl=function(t){this.Td.yl(t)},Pf.prototype.Jl=function(t){return this.Td.activeTargetIds.has(t)},Pf.prototype.Xl=function(t){delete this.Ed[t]},Pf.prototype.ql=function(){return this.Td.activeTargetIds},Pf.prototype.Ql=function(t){return this.Td.activeTargetIds.has(t)},Pf.prototype.start=function(){return this.Td=new pf,Promise.resolve()},Pf.prototype.Su=function(t,e,n){},Pf.prototype.ed=function(t){},Pf.prototype.Ro=function(){},Pf.prototype.lr=function(t){},Pf),vf=(Object.defineProperty(Vf.prototype,"Ad",{get:function(){return this.Id},enumerable:!0,configurable:!0}),Vf.prototype.Pd=function(t,e){var n=this,r=e?e.Vd:new Ns,i=e?e.md:this.md,o=e?e.ns:this.ns,s=i,u=!1,a=this.query.oe()&&i.size===this.query.limit?i.last():null,h=this.query.ae()&&i.size===this.query.limit?i.first():null;if(t.pe((function(t,e){var c=i.get(t),f=e instanceof To?e:null;f=f&&(n.query.matches(f)?f:null);var l=!!c&&n.ns.has(c.key),p=!!f&&(f.At||n.ns.has(f.key)&&f.hasCommittedMutations),d=!1;c&&f?c.data().isEqual(f.data())?l!==p&&(r.track({type:3,doc:f}),d=!0):n.gd(c,f)||(r.track({type:2,doc:f}),d=!0,(a&&0<n.query.se(f,a)||h&&n.query.se(f,h)<0)&&(u=!0)):!c&&f?(r.track({type:0,doc:f}),d=!0):c&&!f&&(r.track({type:1,doc:c}),d=!0,(a||h)&&(u=!0)),d&&(o=f?(s=s.add(f),p?o.add(t):o.delete(t)):(s=s.delete(t),o.delete(t)))})),this.query.oe()||this.query.ae())for(;s.size>this.query.limit;){var c=this.query.oe()?s.last():s.first();s=s.delete(c.key),o=o.delete(c.key),r.track({type:1,doc:c})}return{md:s,Vd:r,pd:u,ns:o}},Vf.prototype.gd=function(t,e){return t.At&&e.hasCommittedMutations&&!e.At},Vf.prototype.xn=function(t,e,n){var r=this,i=this.md;this.md=t.md,this.ns=t.ns;var o=t.Vd.es();o.sort((function(t,e){return i=t.type,o=e.type,n(i)-n(o)||r.query.se(t.doc,e.doc);function n(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Js()}}var i,o})),this.yd(n);var s=e?this.bd():[],u=0===this.Rd.size&&this.fs?1:0,a=u!==this.wd;return this.wd=u,0!==o.length||a?{snapshot:new _s(this.query,t.md,i,o,t.ns,0==u,a,!1),vd:s}:{vd:s}},Vf.prototype.Sd=function(t){return this.fs&&"Offline"===t?(this.fs=!1,this.xn({md:this.md,Vd:new Ns,ns:this.ns,pd:!1},!1)):{vd:[]}},Vf.prototype.Dd=function(t){return!this.Id.has(t)&&!!this.md.has(t)&&!this.md.get(t).At},Vf.prototype.yd=function(t){var e=this;t&&(t.Ts.forEach((function(t){return e.Id=e.Id.add(t)})),t.Es.forEach((function(t){})),t.Is.forEach((function(t){return e.Id=e.Id.delete(t)})),this.fs=t.fs)},Vf.prototype.bd=function(){var t=this;if(!this.fs)return[];var e=this.Rd;this.Rd=ms(),this.md.forEach((function(e){t.Dd(e.key)&&(t.Rd=t.Rd.add(e.key))}));var n=[];return e.forEach((function(e){t.Rd.has(e)||n.push(new nf(e))})),this.Rd.forEach((function(t){e.has(t)||n.push(new ef(t))})),n},Vf.prototype.Cd=function(t){this.Id=t.ju,this.Rd=ms();var e=this.Pd(t.documents);return this.xn(e,!0)},Vf.prototype.Fd=function(){return _s.os(this.query,this.md,this.ns,0===this.wd)},Vf),mf=(Rf.prototype.kd=function(){this.Md()},Rf.prototype.Md=function(){var t=this;this.Na.gr((function(){return u(t,void 0,void 0,(function(){var t,e,n=this;return a(this,(function(r){return t=this.Nd.ml(),(e=this.Ld(t))&&e.then((function(e){n.wa.oo((function(){return t.commit().then((function(){n.Aa.resolve(e)})).catch((function(t){n.Od(t)}))}))})).catch((function(t){n.Od(t)})),[2]}))}))}))},Rf.prototype.Ld=function(t){try{var e=this.updateFunction(t);return!ri(e)&&e.catch&&e.then?e:(this.Aa.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.Aa.reject(t),null}},Rf.prototype.Od=function(t){var e=this;0<this.$d&&this.xd(t)?(--this.$d,this.wa.oo((function(){return e.Md(),Promise.resolve()}))):this.Aa.reject(t)},Rf.prototype.xd=function(t){if("FirebaseError"!==t.name)return!1;var e=t.code;return"aborted"===e||"failed-precondition"===e||!Xo(e)},Rf),gf=(Object.defineProperty(Of.prototype,"Zd",{get:function(){return!0},enumerable:!0,configurable:!0}),Of.prototype.subscribe=function(t){this.Qd=t},Of.prototype.listen=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,o;return a(this,(function(s){switch(s.label){case 0:return this.tf("listen()"),(r=this.Wd.get(t))?(e=r.targetId,this.qd.zl(e),n=r.view.Fd(),[3,4]):[3,1];case 1:return[4,this.F_.Uu(t.ee())];case 2:return i=s.sent(),o=this.qd.zl(i.targetId),e=i.targetId,[4,this.ef(t,e,"current"===o)];case 3:n=s.sent(),this.Zd&&this.Nd.listen(i),s.label=4;case 4:return[2,n]}}))}))},Of.prototype.ef=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i,o,s,u,h;return a(this,(function(a){switch(a.label){case 0:return[4,this.F_.Wu(t,!0)];case 1:return r=a.sent(),i=new vf(t,r.ju),o=i.Pd(r.documents),s=Ss.ds(e,n&&"Offline"!==this.onlineState),u=i.xn(o,this.Zd,s),this.sf(e,u.vd),h=new rf(t,e,i),[2,(this.Wd.set(t,h),this.jd.has(e)?this.jd.get(e).push(t):this.jd.set(e,[t]),u.snapshot)]}}))}))},Of.prototype.nl=function(t){return u(this,void 0,void 0,(function(){var e,n,r=this;return a(this,(function(i){switch(i.label){case 0:return this.tf("unlisten()"),e=this.Wd.get(t),1<(n=this.jd.get(e.targetId)).length?[2,(this.jd.set(e.targetId,n.filter((function(e){return!e.isEqual(t)}))),void this.Wd.delete(t))]:this.Zd?(this.qd.Yl(e.targetId),this.qd.Ql(e.targetId)?[3,2]:[4,this.F_.Qu(e.targetId,!1).then((function(){r.qd.Xl(e.targetId),r.Nd.nl(e.targetId),r.if(e.targetId)})).catch(Nh)]):[3,3];case 1:i.sent(),i.label=2;case 2:return[3,5];case 3:return this.if(e.targetId),[4,this.F_.Qu(e.targetId,!0)];case 4:i.sent(),i.label=5;case 5:return[2]}}))}))},Of.prototype.write=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:this.tf("write()"),o.label=1;case 1:return o.trys.push([1,5,,6]),[4,this.F_.Nu(t)];case 2:return n=o.sent(),this.qd.Wl(n.batchId),this.nf(n.batchId,e),[4,this.rf(n.Dn)];case 3:return o.sent(),[4,this.Nd.tl()];case 4:return o.sent(),[3,6];case 5:return r=o.sent(),i=ah(r,"Failed to persist write"),e.reject(i),[3,6];case 6:return[2]}}))}))},Of.prototype.runTransaction=function(t,e,n){new mf(t,this.Nd,e,n).kd()},Of.prototype.Mu=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:this.tf("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.F_.Mu(t)];case 2:return e=r.sent(),t.as.forEach((function(t,e){var r=n.zd.get(e);r&&(Zs(t.Ts.size+t.Es.size+t.Is.size<=1),0<t.Ts.size?r.Bd=!0:0<t.Es.size?Zs(r.Bd):0<t.Is.size&&(Zs(r.Bd),r.Bd=!1))})),[4,this.rf(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,Nh(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},Of.prototype.Sd=function(t,e){this.tf("applyOnlineStateChange()");var n=[];this.Wd.forEach((function(e,r){var i=r.view.Sd(t);i.snapshot&&n.push(i.snapshot)})),this.Qd.hf(t),this.Qd.s_(n),this.onlineState=t},Of.prototype.cl=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,u=this;return a(this,(function(a){switch(a.label){case 0:return this.tf("rejectListens()"),this.qd.Zl(t,"rejected",e),n=this.zd.get(t),(r=n&&n.key)?(i=(i=new Jo(Xr.N)).me(r,new Io(r,Pr.min())),o=ms().add(r),s=new As(Pr.min(),new Map,new os(nu),i,o),[4,this.Mu(s)]):[3,2];case 1:return a.sent(),this.Gd=this.Gd.remove(r),this.zd.delete(t),this.af(),[3,4];case 2:return[4,this.F_.Qu(t,!1).then((function(){return u.if(t,e)})).catch(Nh)];case 3:a.sent(),a.label=4;case 4:return[2]}}))}))},Of.prototype.El=function(t){return u(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:this.tf("applySuccessfulWrite()"),e=t.batch.batchId,this.uf(e,null),this.cf(e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.F_.Ko(t)];case 2:return n=r.sent(),this.qd.Kl(e,"acknowledged"),[4,this.rf(n)];case 3:return r.sent(),[3,6];case 4:return[4,Nh(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},Of.prototype.Rl=function(t,e){return u(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:this.tf("rejectFailedWrite()"),this.uf(t,e),this.cf(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.F_.ku(t)];case 2:return n=r.sent(),this.qd.Kl(t,"rejected",e),[4,this.rf(n)];case 3:return r.sent(),[3,6];case 4:return[4,Nh(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}}))}))},Of.prototype._f=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i;return a(this,(function(o){switch(o.label){case 0:this.Nd.B_()||Ys("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),o.label=1;case 1:return o.trys.push([1,3,,4]),[4,this.F_.ta()];case 2:return-1===(e=o.sent())?[2,void t.resolve()]:((n=this.Jd.get(e)||[]).push(t),this.Jd.set(e,n),[3,4]);case 3:return r=o.sent(),i=ah(r,"Initialization of waitForPendingWrites() operation failed"),t.reject(i),[3,4];case 4:return[2]}}))}))},Of.prototype.cf=function(t){(this.Jd.get(t)||[]).forEach((function(t){t.resolve()})),this.Jd.delete(t)},Of.prototype.lf=function(t){this.Jd.forEach((function(e){e.forEach((function(e){e.reject(new Dr(Sr.CANCELLED,t))}))})),this.Jd.clear()},Of.prototype.nf=function(t,e){var n=this.Yd[this.currentUser.s()];n=(n=n||new Jo(nu)).me(t,e),this.Yd[this.currentUser.s()]=n},Of.prototype.uf=function(t,e){var n=this.Yd[this.currentUser.s()];if(n){var r=n.get(t);r&&(e?r.reject(e):r.resolve(),n=n.remove(t)),this.Yd[this.currentUser.s()]=n}},Of.prototype.if=function(t,e){var n=this;void 0===e&&(e=null),this.qd.Yl(t);for(var r=0,i=this.jd.get(t);r<i.length;r++){var o=i[r];this.Wd.delete(o),e&&this.Qd.df(o,e)}this.jd.delete(t),this.Zd&&this.Hd.ic(t).forEach((function(t){n.Hd.Dh(t)||n.ff(t)}))},Of.prototype.ff=function(t){var e=this.Gd.get(t);null!==e&&(this.Nd.nl(e),this.Gd=this.Gd.remove(t),this.zd.delete(e),this.af())},Of.prototype.sf=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];i instanceof ef?(this.Hd.ph(i.key,t),this.Tf(i)):i instanceof nf?(Ys("SyncEngine","Document no longer in limbo: "+i.key),this.Hd.bh(i.key,t),this.Hd.Dh(i.key)||this.ff(i.key)):Js()}},Of.prototype.Tf=function(t){var e=t.key;this.Gd.get(e)||(Ys("SyncEngine","New document in limbo: "+e),this.Kd.push(e),this.af())},Of.prototype.af=function(){for(;0<this.Kd.length&&this.Gd.size<this.Ud;){var t=this.Kd.shift(),e=this.Xd.next();this.zd.set(e,new of(t)),this.Gd=this.Gd.me(t,e),this.Nd.listen(new Lo(Ao.Wt(t.path).ee(),e,2,vu.dr))}},Of.prototype.Ef=function(){return this.Gd},Of.prototype.If=function(){return this.Kd},Of.prototype.rf=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o=this;return a(this,(function(s){switch(s.label){case 0:return n=[],r=[],i=[],this.Wd.forEach((function(s,u){i.push(Promise.resolve().then((function(){var e=u.view.Pd(t);return e.pd?o.F_.Wu(u.query,!1).then((function(t){var n=t.documents;return u.view.Pd(n,e)})):e})).then((function(t){var i=e&&e.as.get(u.targetId),s=u.view.xn(t,o.Zd,i);if(o.sf(u.targetId,s.vd),s.snapshot){o.Zd&&o.qd.Zl(u.targetId,s.snapshot.fromCache?"not-current":"current"),n.push(s.snapshot);var a=yu.ar(u.targetId,s.snapshot);r.push(a)}})))})),[4,Promise.all(i)];case 1:return s.sent(),this.Qd.s_(n),[4,this.F_.xu(r)];case 2:return s.sent(),[2]}}))}))},Of.prototype.tf=function(t){},Of.prototype.Al=function(t){return u(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?(this.lf("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.F_.Su(t)]):[3,3];case 1:return n=r.sent(),this.qd.Su(t,n.Cu,n.Fu),[4,this.rf(n.Du)];case 2:r.sent(),r.label=3;case 3:return[4,this.Nd.Al()];case 4:return r.sent(),[2]}}))}))},Of.prototype.enableNetwork=function(){return this.Nd.enableNetwork()},Of.prototype.disableNetwork=function(){return this.Nd.disableNetwork()},Of.prototype.ei=function(t){var e=this.zd.get(t);if(e&&e.Bd)return ms().add(e.key);var n=ms(),r=this.jd.get(t);if(!r)return n;for(var i=0,o=r;i<o.length;i++){var s=o[i],u=this.Wd.get(s);n=n.He(u.view.Ad)}return n},Of),wf=(s(xf,uf=gf),Object.defineProperty(xf.prototype,"Zd",{get:function(){return!0===this.wf},enumerable:!0,configurable:!0}),xf.prototype.enableNetwork=function(){return this.F_.ho(!0),uf.prototype.enableNetwork.call(this)},xf.prototype.disableNetwork=function(){return this.F_.ho(!1),uf.prototype.disableNetwork.call(this)},xf.prototype.Rf=function(t){return u(this,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:return[4,this.F_.Wu(t.query,!0)];case 1:return e=r.sent(),n=t.view.Cd(e),[2,(this.wf&&this.sf(t.targetId,n.vd),n)]}}))}))},xf.prototype.Sd=function(t,e){this.Zd&&0===e&&(uf.prototype.Sd.call(this,t,e),this.qd.ed(t)),this.Zd||1!==e||uf.prototype.Sd.call(this,t,e)},xf.prototype.ld=function(t,e,n){return u(this,void 0,void 0,(function(){var r;return a(this,(function(i){switch(i.label){case 0:return this.tf("applyBatchState()"),[4,this.F_.Gu(t)];case 1:return null===(r=i.sent())?[3,6]:"pending"!==e?[3,3]:[4,this.Nd.tl()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.uf(t,n||null),this.F_.zu(t)):Js(),i.label=4;case 4:return[4,this.rf(r)];case 5:return i.sent(),[3,7];case 6:Ys("SyncEngine","Cannot apply mutation batch with id: "+t),i.label=7;case 7:return[2]}}))}))},xf.prototype.Pl=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,o,s,u,h=this;return a(this,(function(a){switch(a.label){case 0:return!0!==t||!0===this.wf?[3,3]:(e=this.qd.ql(),[4,this.mf(e.W(),!0)]);case 1:return n=a.sent(),this.wf=!0,[4,this.Nd.Pl(!0)];case 2:for(a.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.Nd.listen(o);return[3,7];case 3:return!1!==t||!1===this.wf?[3,7]:(s=[],u=Promise.resolve(),this.jd.forEach((function(t,e){h.qd.Jl(e)?s.push(e):u=u.then((function(){return h.if(e),h.F_.Qu(e,!0)})),h.Nd.nl(e)})),[4,u]);case 4:return a.sent(),[4,this.mf(s,!1)];case 5:return a.sent(),this.Af(),this.wf=!1,[4,this.Nd.Pl(!1)];case 6:a.sent(),a.label=7;case 7:return[2]}}))}))},xf.prototype.Af=function(){var t=this;this.zd.forEach((function(e,n){t.Nd.nl(n)})),this.Hd.nc(),this.zd=new Map,this.Gd=new Jo(Xr.N)},xf.prototype.mf=function(t,e){return u(this,void 0,void 0,(function(){var e,n,r,i,o,s,u,h,c,f,l,p,d;return a(this,(function(a){switch(a.label){case 0:e=[],n=[],r=0,i=t,a.label=1;case 1:return r<i.length?(o=i[r],s=void 0,(u=this.jd.get(o))&&0!==u.length?[4,this.F_.Qu(o,!0)]:[3,8]):[3,14];case 2:return a.sent(),[4,this.F_.Uu(u[0].ee())];case 3:s=a.sent(),h=0,c=u,a.label=4;case 4:return h<c.length?(f=c[h],l=this.Wd.get(f),[4,this.Rf(l)]):[3,7];case 5:(p=a.sent()).snapshot&&n.push(p.snapshot),a.label=6;case 6:return h++,[3,4];case 7:return[3,12];case 8:return[4,this.F_.Hu(o)];case 9:return d=a.sent(),[4,this.F_.Uu(d)];case 10:return s=a.sent(),[4,this.ef(this.Pf(d),o,!1)];case 11:a.sent(),a.label=12;case 12:e.push(s),a.label=13;case 13:return r++,[3,1];case 14:return[2,(this.Qd.s_(n),e)]}}))}))},xf.prototype.Pf=function(t){return new Ao(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)},xf.prototype.po=function(){return this.F_.po()},xf.prototype.dd=function(t,e,n){return u(this,void 0,void 0,(function(){var r,i;return a(this,(function(o){switch(o.label){case 0:return this.wf?(Ys("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!this.jd.has(t))return[3,8];switch(e){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,this.F_.Wr()];case 3:return r=o.sent(),i=As.ls(t,"current"===e),[4,this.rf(r,i)];case 4:return o.sent(),[3,8];case 5:return[4,this.F_.Qu(t,!0)];case 6:return o.sent(),this.if(t,n),[3,8];case 7:Js(),o.label=8;case 8:return[2]}}))}))},xf.prototype.fd=function(t,e){return u(this,void 0,void 0,(function(){var n,r,i,o,s,u,h,c,f,l,p=this;return a(this,(function(d){switch(d.label){case 0:if(!this.wf)return[3,10];n=0,r=t,d.label=1;case 1:return n<r.length?(i=r[n],this.jd.has(i)?(Ys("SyncEngine","Adding an already active target "+i),[3,5]):[4,this.F_.Hu(i)]):[3,6];case 2:return o=d.sent(),[4,this.F_.Uu(o)];case 3:return s=d.sent(),[4,this.ef(this.Pf(o),s.targetId,!1)];case 4:d.sent(),this.Nd.listen(s),d.label=5;case 5:return n++,[3,1];case 6:u=function(t){return a(this,(function(e){switch(e.label){case 0:return h.jd.has(t)?[4,h.F_.Qu(t,!1).then((function(){p.Nd.nl(t),p.if(t)})).catch(Nh)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}}))},h=this,c=0,f=e,d.label=7;case 7:return c<f.length?(l=f[c],[5,u(l)]):[3,10];case 8:d.sent(),d.label=9;case 9:return c++,[3,7];case 10:return[2]}}))}))},xf),bf=(kf.prototype.listen=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i,o,s;return a(this,(function(u){switch(u.label){case 0:if(e=t.query,n=!1,(r=this.pf.get(e))||(n=!0,r=new sf),!n)return[3,4];u.label=1;case 1:return u.trys.push([1,3,,4]),i=r,[4,this.hl.listen(e)];case 2:return i.Vf=u.sent(),[3,4];case 3:return o=u.sent(),s=ah(o,"Initialization of query '"+t.query+"' failed"),[2,void t.onError(s)];case 4:return this.pf.set(e,r),r.gf.push(t),t.Sd(this.onlineState),r.Vf&&t.bf(r.Vf)&&this.vf(),[2]}}))}))},kf.prototype.nl=function(t){return u(this,void 0,void 0,(function(){var e,n,r,i;return a(this,(function(o){return e=t.query,n=!1,(r=this.pf.get(e))&&0<=(i=r.gf.indexOf(t))&&(r.gf.splice(i,1),n=0===r.gf.length),n?[2,(this.pf.delete(e),this.hl.nl(e))]:[2]}))}))},kf.prototype.s_=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,s=this.pf.get(o);if(s){for(var u=0,a=s.gf;u<a.length;u++)a[u].bf(i)&&(e=!0);s.Vf=i}}e&&this.vf()},kf.prototype.df=function(t,e){var n=this.pf.get(t);if(n)for(var r=0,i=n.gf;r<i.length;r++)i[r].onError(e);this.pf.delete(t)},kf.prototype.hf=function(t){this.onlineState=t;var e=!1;this.pf.forEach((function(n,r){for(var i=0,o=r.gf;i<o.length;i++)o[i].Sd(t)&&(e=!0)})),e&&this.vf()},kf.prototype.Sf=function(t){this.yf.add(t),t.next()},kf.prototype.Df=function(t){this.yf.delete(t)},kf.prototype.vf=function(){this.yf.forEach((function(t){t.next()}))},kf),Ef=(Df.prototype.bf=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new _s(t.query,t.docs,t.ss,e,t.ns,t.fromCache,t.rs,!0)}var o=!1;return this.Ff?this.$f(t)&&(this.Cf.next(t),o=!0):this.kf(t,this.onlineState)&&(this.Mf(t),o=!0),this.Nf=t,o},Df.prototype.onError=function(t){this.Cf.error(t)},Df.prototype.Sd=function(t){this.onlineState=t;var e=!1;return this.Nf&&!this.Ff&&this.kf(this.Nf,t)&&(this.Mf(this.Nf),e=!0),e},Df.prototype.kf=function(t,e){if(!t.fromCache)return!0;var n="Offline"!==e;return!(this.options.Lf&&n||t.docs.B()&&"Offline"!==e)},Df.prototype.$f=function(t){if(0<t.docChanges.length)return!0;var e=this.Nf&&this.Nf.hasPendingWrites!==t.hasPendingWrites;return!(!t.rs&&!e)&&!0===this.options.includeMetadataChanges},Df.prototype.Mf=function(t){t=_s.os(t.query,t.docs,t.ns,t.fromCache),this.Ff=!0,this.Cf.next(t)},Df),Tf=(Sf.prototype.vu=function(t){this.Of=t},Sf.prototype.Zn=function(t,e,n,i){var o=this;return e.te()||n.isEqual(Pr.min())?this.xf(t,e):this.Of.Yn(t,i).next((function(s){var u=o.Bf(e,s);return(e.oe()||e.ae())&&o.pd(e.Bt,u,i,n)?o.xf(t,e):(Hs()<=r.DEBUG&&Ys("IndexFreeQueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),e.toString()),o.Of.Zn(t,e,n).next((function(t){return u.forEach((function(e){t=t.me(e.key,e)})),t})))}))},Sf.prototype.Bf=function(t,e){var n=new os((function(e,n){return t.se(e,n)}));return e.forEach((function(e,r){r instanceof To&&t.matches(r)&&(n=n.add(r))})),n},Sf.prototype.pd=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||0<i.version.S(r))},Sf.prototype.xf=function(t,e){return Hs()<=r.DEBUG&&Ys("IndexFreeQueryEngine","Using full collection scan to execute query: %s",e.toString()),this.Of.Zn(t,e,Pr.min())},Sf),If=(Af.prototype.jo=function(t){return cu.resolve(0===this.Wn.length)},Af.prototype.Ko=function(t,e,n){var r=e.batchId,i=this.Qf(r,"acknowledged");return Zs(0===i),this.Wn[i],this.lastStreamToken=n,cu.resolve()},Af.prototype.zo=function(t){return cu.resolve(this.lastStreamToken)},Af.prototype.Ho=function(t,e){return this.lastStreamToken=e,cu.resolve()},Af.prototype.Yo=function(t,e,n,r){var i=this.qf;this.qf++,0<this.Wn.length&&this.Wn[this.Wn.length-1];var o=new au(i,e,n,r);this.Wn.push(o);for(var s=0,u=r;s<u.length;s++){var a=u[s];this.Uf=this.Uf.add(new Ah(a.key,i)),this.jn.vr(t,a.key.path.M())}return cu.resolve(o)},Af.prototype.Jo=function(t,e){return cu.resolve(this.Wf(e))},Af.prototype.Zo=function(t,e){var n=e+1,r=this.jf(n),i=r<0?0:r;return cu.resolve(this.Wn.length>i?this.Wn[i]:null)},Af.prototype.ta=function(){return cu.resolve(0===this.Wn.length?-1:this.qf-1)},Af.prototype.ea=function(t){return cu.resolve(this.Wn.slice())},Af.prototype.Gn=function(t,e){var n=this,r=new Ah(e,0),i=new Ah(e,Number.POSITIVE_INFINITY),o=[];return this.Uf.Ke([r,i],(function(t){var e=n.Wf(t.hc);o.push(e)})),cu.resolve(o)},Af.prototype.Xn=function(t,e){var n=this,r=new os(nu);return e.forEach((function(t){var e=new Ah(t,0),i=new Ah(t,Number.POSITIVE_INFINITY);n.Uf.Ke([e,i],(function(t){r=r.add(t.hc)}))})),cu.resolve(this.Kf(r))},Af.prototype.nr=function(t,e){var n=e.path,r=n.length+1,i=n;Xr.et(i)||(i=i.child(""));var o=new Ah(new Xr(i),0),s=new os(nu);return this.Uf.Ge((function(t){var e=t.key.path;return!!n.q(e)&&(e.length===r&&(s=s.add(t.hc)),!0)}),o),cu.resolve(this.Kf(s))},Af.prototype.Kf=function(t){var e=this,n=[];return t.forEach((function(t){var r=e.Wf(t);null!==r&&n.push(r)})),n},Af.prototype.ia=function(t,e){var n=this;Zs(0===this.Qf(e.batchId,"removed")),this.Wn.shift();var r=this.Uf;return cu.forEach(e.mutations,(function(i){var o=new Ah(i.key,e.batchId);return r=r.delete(o),n.nh.Oo(t,i.key)})).next((function(){n.Uf=r}))},Af.prototype.na=function(t){},Af.prototype.Dh=function(t,e){var n=new Ah(e,0),r=this.Uf.ze(n);return cu.resolve(e.isEqual(r&&r.key))},Af.prototype.ra=function(t){return this.Wn.length,cu.resolve()},Af.prototype.Qf=function(t,e){return this.jf(t)},Af.prototype.jf=function(t){return 0===this.Wn.length?0:t-this.Wn[0].batchId},Af.prototype.Wf=function(t){var e=this.jf(t);return e<0||e>=this.Wn.length?null:this.Wn[e]},Af),Nf=(_f.prototype.Nn=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.Gf(e);return this.docs=this.docs.me(r,{kr:e,size:s,readTime:n}),this.size+=s-o,this.jn.vr(t,r.path.M())},_f.prototype.kn=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},_f.prototype.Mn=function(t,e){var n=this.docs.get(e);return cu.resolve(n?n.kr:null)},_f.prototype.getEntries=function(t,e){var n=this,r=fs();return e.forEach((function(t){var e=n.docs.get(t);r=r.me(t,e?e.kr:null)})),cu.resolve(r)},_f.prototype.Zn=function(t,e,n){for(var r=ps(),i=new Xr(e.path.child("")),o=this.docs.ve(i);o.$e();){var s=o.Ne(),u=s.key,a=s.value,h=a.kr,c=a.readTime;if(!e.path.q(u.path))break;c.S(n)<=0||h instanceof To&&e.matches(h)&&(r=r.me(h.key,h))}return cu.resolve(r)},_f.prototype.zf=function(t,e){return cu.forEach(this.docs,(function(t){return e(t)}))},_f.prototype.zr=function(t){return new _f.Hr(this)},_f.prototype.Jr=function(t){return cu.resolve(this.size)},_f);function _f(t,e){this.jn=t,this.Gf=e,this.docs=new Jo(Xr.N),this.size=0}function Af(t,e){this.jn=t,this.nh=e,this.Wn=[],this.qf=1,this.lastStreamToken=ei.ht,this.Uf=new os(Ah.Ju)}function Sf(){}function Df(t,e,n){this.query=t,this.Cf=e,this.Ff=!1,this.Nf=null,this.onlineState="Unknown",this.options=n||{}}function kf(t){this.hl=t,this.pf=new uu((function(t){return t.canonicalId()})),this.onlineState="Unknown",this.yf=new Set,this.hl.subscribe(this)}function xf(t,e,n,r,i){var o=this;return(o=uf.call(this,t,e,n,r,i)||this).F_=t,o.wf=void 0,o}function Of(t,e,n,r,i){this.F_=t,this.Nd=e,this.qd=n,this.currentUser=r,this.Ud=i,this.Qd=null,this.Wd=new uu((function(t){return t.canonicalId()})),this.jd=new Map,this.Kd=[],this.Gd=new Jo(Xr.N),this.zd=new Map,this.Hd=new _h,this.Yd={},this.Jd=new Map,this.Xd=Yu.ih(),this.onlineState="Unknown"}function Rf(t,e,n,r){this.wa=t,this.Nd=e,this.updateFunction=n,this.Aa=r,this.$d=5,this.Na=new Du(this.wa,"transaction_retry")}function Vf(t,e){this.query=t,this.Id=e,this.wd=null,this.fs=!1,this.Rd=ms(),this.ns=ms(),this.md=new Is(t.se.bind(t))}function Pf(){this.Td=new pf,this.Ed={},this.hl=null,this.V_=null,this.ur=null}function Lf(t,e,n,r,i){if(this.Tr=t,this.platform=e,this.persistenceKey=n,this.bl=r,this.hl=null,this.V_=null,this.ur=null,this.vl=this.Sl.bind(this),this.Dl=new Jo(nu),this.io=!1,this.Cl=[],!Lf.jh(this.platform))throw new Dr(Sr.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=i,this.Fl=Jc(this.persistenceKey,this.bl),this.Nl="firestore_sequence_number_"+this.persistenceKey,this.Dl=this.Dl.me(this.bl,new pf),this.$l=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.kl=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.Ml=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Ll="firestore_online_state_"+this.persistenceKey,this.platform.window.addEventListener("storage",this.vl)}function Cf(){this.activeTargetIds=ws()}function Mf(t,e){this.clientId=t,this.onlineState=e}function jf(t,e){this.clientId=t,this.activeTargetIds=e}function Uf(t,e,n){this.targetId=t,this.state=e,this.error=n}function qf(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}function Ff(t){var e=this;return(e=af.call(this)||this).Xr=t,e}Nf.Hr=(s(Ff,af=fu),Ff.prototype.xn=function(t){var e=this,n=[];return this.Dn.forEach((function(r,i){i?n.push(e.Xr.Nn(t,i,e.readTime)):e.Xr.kn(r)})),cu.vn(n)},Ff.prototype.Ln=function(t,e){return this.Xr.Mn(t,e)},Ff.prototype.On=function(t,e){return this.Xr.getEntries(t,e)},Ff);var Bf,Gf,zf=(ol.prototype.js=function(t,e){return this.Hf.forEach((function(t,n){return e(n)})),cu.resolve()},ol.prototype.ah=function(t){return cu.resolve(this.lastRemoteSnapshotVersion)},ol.prototype.uh=function(t){return cu.resolve(this.Yf)},ol.prototype.rh=function(t){return this.highestTargetId=this.Xf.next(),cu.resolve(this.highestTargetId)},ol.prototype.lh=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Yf&&(this.Yf=e),cu.resolve()},ol.prototype.fh=function(t){this.Hf.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.Xf=new Yu(e),this.highestTargetId=e),t.sequenceNumber>this.Yf&&(this.Yf=t.sequenceNumber)},ol.prototype.dh=function(t,e){return this.fh(e),this.targetCount+=1,cu.resolve()},ol.prototype.Eh=function(t,e){return this.fh(e),cu.resolve()},ol.prototype.Ih=function(t,e){return this.Hf.delete(e.target),this.Jf.ic(e.targetId),--this.targetCount,cu.resolve()},ol.prototype.Rh=function(t,e,n){var r=this,i=0,o=[];return this.Hf.forEach((function(s,u){u.sequenceNumber<=e&&null===n.get(u.targetId)&&(r.Hf.delete(s),o.push(r.wh(t,u.targetId)),i++)})),cu.vn(o).next((function(){return i}))},ol.prototype.Ph=function(t){return cu.resolve(this.targetCount)},ol.prototype.Vh=function(t,e){var n=this.Hf.get(e)||null;return cu.resolve(n)},ol.prototype.gh=function(t,e,n){return this.Jf.tc(e,n),cu.resolve()},ol.prototype.yh=function(t,e,n){this.Jf.sc(e,n);var r=this.persistence.nh,i=[];return r&&e.forEach((function(e){i.push(r.Oo(t,e))})),cu.vn(i)},ol.prototype.wh=function(t,e){return this.Jf.ic(e),cu.resolve()},ol.prototype.vh=function(t,e){var n=this.Jf.rc(e);return cu.resolve(n)},ol.prototype.Dh=function(t,e){return cu.resolve(this.Jf.Dh(e))},ol),Wf=(il.prototype.start=function(){return Promise.resolve()},il.prototype.Ro=function(){return this.xh=!1,Promise.resolve()},Object.defineProperty(il.prototype,"io",{get:function(){return this.xh},enumerable:!0,configurable:!0}),il.prototype.no=function(){},il.prototype.Do=function(){return this.jn},il.prototype.yo=function(t){var e=this.Zf[t.s()];return e||(e=new If(this.jn,this.nh),this.Zf[t.s()]=e),e},il.prototype.vo=function(){return this.zh},il.prototype.So=function(){return this.Qn},il.prototype.runTransaction=function(t,e,n){var r=this;Ys("MemoryPersistence","Starting transaction:",t);var i=new Qf(this.Oh.next());return this.nh.eT(),n(i).next((function(t){return r.nh.sT(i).next((function(){return t}))})).yn().then((function(t){return i.Un(),t}))},il.prototype.iT=function(t,e){return cu.Sn(Object.values(this.Zf).map((function(n){return function(){return n.Dh(t,e)}})))},il),Qf=(s(rl,Gf=pu),rl),Hf=(nl.hT=function(t){return new nl(t)},Object.defineProperty(nl.prototype,"oT",{get:function(){if(this.rT)return this.rT;throw Js()},enumerable:!0,configurable:!0}),nl.prototype.ph=function(t,e,n){return this.nT.ph(n,e),this.oT.delete(n),cu.resolve()},nl.prototype.bh=function(t,e,n){return this.nT.bh(n,e),this.oT.add(n),cu.resolve()},nl.prototype.Oo=function(t,e){return this.oT.add(e),cu.resolve()},nl.prototype.removeTarget=function(t,e){var n=this;this.nT.ic(e.targetId).forEach((function(t){return n.oT.add(t)}));var r=this.persistence.vo();return r.vh(t,e.targetId).next((function(t){t.forEach((function(t){return n.oT.add(t)}))})).next((function(){return r.Ih(t,e)}))},nl.prototype.eT=function(){this.rT=new Set},nl.prototype.sT=function(t){var e=this,n=this.persistence.So().zr();return cu.forEach(this.oT,(function(r){return e.aT(t,r).next((function(t){t||n.kn(r)}))})).next((function(){return e.rT=null,n.apply(t)}))},nl.prototype.Uo=function(t,e){var n=this;return this.aT(t,e).next((function(t){t?n.oT.delete(e):n.oT.add(e)}))},nl.prototype.tT=function(t){return 0},nl.prototype.aT=function(t,e){var n=this;return cu.Sn([function(){return cu.resolve(n.nT.Dh(e))},function(){return n.persistence.vo().Dh(t,e)},function(){return n.persistence.iT(t,e)}])},nl),Kf=(el.prototype.initialize=function(t){return u(this,void 0,void 0,(function(){var e=this;return a(this,(function(n){switch(n.label){case 0:return this.qd=this.uT(t),this.persistence=this.cT(t),[4,this.persistence.start()];case 1:return n.sent(),this._T=this.lT(t),this.F_=this.dT(t),this.Nd=this.fT(t),this.hl=this.TT(t),this.ET=this.IT(t),this.qd.V_=function(t){return e.hl.Sd(t,1)},this.Nd.hl=this.hl,[4,this.F_.start()];case 2:return n.sent(),[4,this.qd.start()];case 3:return n.sent(),[4,this.Nd.start()];case 4:return n.sent(),[4,this.Nd.Pl(this.hl.Zd)];case 5:return n.sent(),[2]}}))}))},el.prototype.IT=function(t){return new bf(this.hl)},el.prototype.lT=function(t){return null},el.prototype.dT=function(t){return new mh(this.persistence,new Tf,t.wT)},el.prototype.cT=function(t){return new Wf(Hf.hT)},el.prototype.fT=function(t){var e=this;return new zc(this.F_,t.f_,t.wa,(function(t){return e.hl.Sd(t,0)}),t.platform.RT())},el.prototype.uT=function(t){return new yf},el.prototype.TT=function(t){return new gf(this.F_,this.Nd,this.qd,t.wT,t.Ud)},el.prototype.clearPersistence=function(t){throw new Dr(Sr.FAILED_PRECONDITION,"You are using the memory-only build of Firestore. Persistence support is only available via the @firebase/firestore bundle or the firebase-firestore.js build.")},el),Yf=(s(tl,Bf=Kf),tl.prototype.initialize=function(t){return u(this,void 0,void 0,(function(){var e=this;return a(this,(function(n){switch(n.label){case 0:return[4,Bf.prototype.initialize.call(this,t)];case 1:return n.sent(),[4,this.persistence.so((function(t){return u(e,void 0,void 0,(function(){return a(this,(function(e){switch(e.label){case 0:return[4,this.hl.Pl(t)];case 1:return e.sent(),this._T&&(t&&!this._T.io?this._T.start(this.F_):t||this._T.stop()),[2]}}))}))}))];case 2:return n.sent(),[2]}}))}))},tl.prototype.dT=function(t){return new Th(this.persistence,new Tf,t.wT)},tl.prototype.TT=function(t){var e=new wf(this.F_,this.Nd,this.qd,t.wT,t.Ud);return this.qd instanceof df&&(this.qd.hl=e),e},tl.prototype.lT=function(t){var e=this.persistence.nh.No;return new yh(e,t.wa)},tl.prototype.cT=function(t){var e=ua.Fo(t.mT),n=t.platform.yc(t.mT.ii);return new ua(t.AT.synchronizeTabs,e,t.clientId,t.platform,lh.ru(t.AT.cacheSizeBytes),t.wa,n,this.qd)},tl.prototype.uT=function(t){if(t.AT.PT&&t.AT.synchronizeTabs){if(!df.jh(t.platform))throw new Dr(Sr.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var e=ua.Fo(t.mT);return new df(t.wa,t.platform,e,t.clientId,t.wT)}return new yf},tl.prototype.clearPersistence=function(t){var e=ua.Fo(t);return ua.clearPersistence(e)},tl),Xf=(Zf.prototype.start=function(t,e){var n=this;this.VT();var r=new Su,i=new Su,o=!1;return this.credentials.l((function(s){if(!o)return o=!0,Ys("FirestoreClient","Initializing. user=",s.uid),n.gT(t,e,s,i).then(r.resolve,r.reject);n.wa.oo((function(){return n.Al(s)}))})),this.wa.oo((function(){return r.promise})),i.promise},Zf.prototype.enableNetwork=function(){var t=this;return this.VT(),this.wa.enqueue((function(){return t.hl.enableNetwork()}))},Zf.prototype.gT=function(t,e,n,r){return u(this,void 0,void 0,(function(){var i,o,s,h,c=this;return a(this,(function(f){switch(f.label){case 0:return f.trys.push([0,3,,4]),[4,this.platform.pT(this.mT)];case 1:return i=f.sent(),o=this.platform.yc(this.mT.ii),l=i,p=this.credentials,s=new Fc(l,p,o),[4,t.initialize({wa:this.wa,mT:this.mT,platform:this.platform,f_:s,clientId:this.clientId,wT:n,Ud:100,AT:e})];case 2:return f.sent(),this.persistence=t.persistence,this.qd=t.qd,this.F_=t.F_,this.Nd=t.Nd,this.hl=t.hl,this._T=t._T,this.yT=t.ET,this.persistence.no((function(){return u(c,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}}))}))})),r.resolve(),[3,4];case 3:if(h=f.sent(),r.reject(h),!this.bT(h))throw h;return[2,(console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+h),this.gT(new Kf,{PT:!1},n,r))];case 4:return[2]}var l,p}))}))},Zf.prototype.bT=function(t){return"FirebaseError"===t.name?t.code===Sr.FAILED_PRECONDITION||t.code===Sr.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code},Zf.prototype.VT=function(){if(this.wa.Ma)throw new Dr(Sr.FAILED_PRECONDITION,"The client has already been terminated.")},Zf.prototype.Al=function(t){return this.wa.Wa(),Ys("FirestoreClient","Credential Changed. Current user: "+t.uid),this.hl.Al(t)},Zf.prototype.disableNetwork=function(){var t=this;return this.VT(),this.wa.enqueue((function(){return t.hl.disableNetwork()}))},Zf.prototype.terminate=function(){var t=this;return this.wa.qa((function(){return u(t,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this._T&&this._T.stop(),[4,this.Nd.Ro()];case 1:return t.sent(),[4,this.qd.Ro()];case 2:return t.sent(),[4,this.persistence.Ro()];case 3:return t.sent(),this.credentials.T(),[2]}}))}))}))},Zf.prototype.waitForPendingWrites=function(){var t=this;this.VT();var e=new Su;return this.wa.oo((function(){return t.hl._f(e)})),e.promise},Zf.prototype.listen=function(t,e,n){var r=this;this.VT();var i=new Ef(t,e,n);return this.wa.oo((function(){return r.yT.listen(i)})),i},Zf.prototype.nl=function(t){var e=this;this.vT||this.wa.oo((function(){return e.yT.nl(t)}))},Zf.prototype.ST=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:return this.VT(),e=new Su,[4,this.wa.enqueue((function(){return u(n,void 0,void 0,(function(){var n,r,i;return a(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,this.F_.qu(t)];case 1:return(n=o.sent())instanceof To?e.resolve(n):n instanceof Io?e.resolve(null):e.reject(new Dr(Sr.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=ah(r,"Failed to get document '"+t+" from cache"),e.reject(i),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(r.sent(),e.promise)]}}))}))},Zf.prototype.DT=function(t){return u(this,void 0,void 0,(function(){var e,n=this;return a(this,(function(r){switch(r.label){case 0:return this.VT(),e=new Su,[4,this.wa.enqueue((function(){return u(n,void 0,void 0,(function(){var n,r,i,o,s,u;return a(this,(function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),[4,this.F_.Wu(t,!0)];case 1:return n=a.sent(),r=new vf(t,n.ju),i=r.Pd(n.documents),o=r.xn(i,!1),e.resolve(o.snapshot),[3,3];case 2:return s=a.sent(),u=ah(s,"Failed to execute query '"+t+" against cache"),e.reject(u),[3,3];case 3:return[2]}}))}))}))];case 1:return[2,(r.sent(),e.promise)]}}))}))},Zf.prototype.write=function(t){var e=this;this.VT();var n=new Su;return this.wa.oo((function(){return e.hl.write(t,n)})),n.promise},Zf.prototype.ii=function(){return this.mT.ii},Zf.prototype.Sf=function(t){var e=this;this.VT(),this.wa.oo((function(){return e.yT.Sf(t),Promise.resolve()}))},Zf.prototype.Df=function(t){var e=this;this.vT||this.wa.oo((function(){return e.yT.Df(t),Promise.resolve()}))},Object.defineProperty(Zf.prototype,"vT",{get:function(){return this.wa.Ma},enumerable:!0,configurable:!0}),Zf.prototype.transaction=function(t){var e=this;this.VT();var n=new Su;return this.wa.oo((function(){return e.hl.runTransaction(e.wa,t,n),Promise.resolve()})),n.promise},Zf),$f=(Jf.prototype.next=function(t){this.CT(this.observer.next,t)},Jf.prototype.error=function(t){this.CT(this.observer.error,t)},Jf.prototype.FT=function(){this.muted=!0},Jf.prototype.CT=function(t,e){var n=this;this.muted||setTimeout((function(){n.muted||t(e)}),0)},Jf);function Jf(t){this.observer=t,this.muted=!1}function Zf(t,e,n,r){this.platform=t,this.mT=e,this.credentials=n,this.wa=r,this.clientId=tu.cn()}function tl(){return null!==Bf&&Bf.apply(this,arguments)||this}function el(){}function nl(t){this.persistence=t,this.nT=new _h,this.rT=null}function rl(t){var e=this;return(e=Gf.call(this)||this).Mh=t,e}function il(t){var e=this;this.Zf={},this.Oh=new vu(0),this.xh=!1,this.xh=!0,this.nh=t(this),this.zh=new zf(this),this.jn=new Pu,this.Qn=new Nf(this.jn,(function(t){return e.nh.tT(t)}))}function ol(t){this.persistence=t,this.Hf=new uu((function(t){return t.canonicalId()})),this.lastRemoteSnapshotVersion=Pr.min(),this.highestTargetId=0,this.Yf=0,this.Jf=new _h,this.targetCount=0,this.Xf=Yu.sh()}function sl(t){return function(){if("object"==typeof t&&null!==t)for(var e=t,n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in e&&"function"==typeof e[i])return 1}}()}var ul,al,hl=(Vl.prototype.$T=function(t){switch(hi(t)){case 0:return null;case 1:return t.booleanValue;case 2:return vi(t.integerValue||t.doubleValue);case 3:return this.kT(t.timestampValue);case 4:return this.MT(t);case 5:return t.stringValue;case 6:return new Yh(mi(t.bytesValue));case 7:return this.LT(t.referenceValue);case 8:return this.OT(t.geoPointValue);case 9:return this.xT(t.arrayValue);case 10:return this.BT(t.mapValue);default:throw Js()}},Vl.prototype.BT=function(t){var e=this,n={};return Zr(t.fields||{},(function(t,r){n[t]=e.$T(r)})),n},Vl.prototype.OT=function(t){return new fc(vi(t.latitude),vi(t.longitude))},Vl.prototype.xT=function(t){var e=this;return(t.values||[]).map((function(t){return e.$T(t)}))},Vl.prototype.MT=function(t){switch(this.NT){case"previous":var e=function t(e){var n=e.mapValue.fields.__previous_value__;return si(n)?t(n):n}(t);return null==e?null:this.$T(e);case"estimate":return this.kT(ui(t));default:return null}},Vl.prototype.kT=function(t){var e=yi(t),n=new Vr(e.seconds,e.nanos);return this.timestampsInSnapshots?n:n.toDate()},Vl.prototype.LT=function(t){var e=Cr.K(t);Zs(Gs(e));var n=new su(e.get(1),e.get(3)),r=new Xr(e.k(5));return n.isEqual(this.firestore.Nc)||Xs("Document "+r+" contains a document reference within a different database ("+n.projectId+"/"+n.database+") which is not supported. It will be treated as a reference in the current database ("+this.firestore.Nc.projectId+"/"+this.firestore.Nc.database+") instead."),new yl(r,this.firestore,this.converter)},Vl),cl=lh.au,fl=(Rl.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},Rl),ll=(Ol.prototype.settings=function(t){xh("Firestore.settings",arguments,1),Vh("Firestore.settings","object",1,t);var e=new fl(t);if(this.WT&&!this.HT.isEqual(e))throw new Dr(Sr.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");void 0!==(this.HT=e).credentials&&(this.GT=function(t){if(!t)return new kr;switch(t.type){case"gapi":var e=t.JT;return Zs(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Rr(e,t.V||"0");case"provider":return t.JT;default:throw new Dr(Sr.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},Ol.prototype.enableNetwork=function(){return this.QT(),this.WT.enableNetwork()},Ol.prototype.disableNetwork=function(){return this.QT(),this.WT.disableNetwork()},Ol.prototype.enablePersistence=function(t){var e,n;if(this.WT)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var r=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Xs("The 'experimentalTabSynchronization' setting will be removed. Use 'synchronizeTabs' instead."),r=null!==(n=null!==(e=t.synchronizeTabs)&&void 0!==e?e:t.experimentalTabSynchronization)&&void 0!==n&&n),this.XT(this.zT,{PT:!0,cacheSizeBytes:this.HT.cacheSizeBytes,synchronizeTabs:r})},Ol.prototype.clearPersistence=function(){return u(this,void 0,void 0,(function(){var t,e=this;return a(this,(function(n){if(void 0!==this.WT&&!this.WT.vT)throw new Dr(Sr.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return t=new Su,[2,(this.UT.La((function(){return u(e,void 0,void 0,(function(){var e,n;return a(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),e=this.ZT(),[4,this.zT.clearPersistence(e)];case 1:return r.sent(),t.resolve(),[3,3];case 2:return n=r.sent(),t.reject(n),[3,3];case 3:return[2]}}))}))})),t.promise)]}))}))},Ol.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(Ol.prototype,"tE",{get:function(){return this.QT(),this.WT.vT},enumerable:!0,configurable:!0}),Ol.prototype.waitForPendingWrites=function(){return this.QT(),this.WT.waitForPendingWrites()},Ol.prototype.onSnapshotsInSync=function(t){if(this.QT(),sl(t))return this.eE(t);Vh("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.eE(e)},Ol.prototype.eE=function(t){var e=this,n=new $f({next:function(){t.next&&t.next()},error:function(t){throw Js()}});return this.WT.Sf(n),function(){n.FT(),e.WT.Df(n)}},Ol.prototype.QT=function(){return this.WT||this.XT(new Kf,{PT:!1}),this.WT},Ol.prototype.ZT=function(){return new ou(this.Nc,this.KT,this.HT.host,this.HT.ssl,this.HT.forceLongPolling)},Ol.prototype.XT=function(t,e){var n=this.ZT();return this.WT=new Xf(zs.nt(),n,this.GT,this.UT),this.WT.start(t,e)},Ol.jT=function(t){if(e=t.options,!Object.prototype.hasOwnProperty.call(e,"projectId"))throw new Dr(Sr.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var e,n=t.options.projectId;if(!n||"string"!=typeof n)throw new Dr(Sr.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new su(n)},Object.defineProperty(Ol.prototype,"app",{get:function(){if(!this.qT)throw new Dr(Sr.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.qT},enumerable:!0,configurable:!0}),Ol.prototype.collection=function(t){return xh("Firestore.collection",arguments,1),Vh("Firestore.collection","non-empty string",1,t),this.QT(),new El(Cr.K(t),this)},Ol.prototype.doc=function(t){return xh("Firestore.doc",arguments,1),Vh("Firestore.doc","non-empty string",1,t),this.QT(),yl.sE(Cr.K(t),this)},Ol.prototype.collectionGroup=function(t){if(xh("Firestore.collectionGroup",arguments,1),Vh("Firestore.collectionGroup","non-empty string",1,t),0<=t.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.QT(),new wl(new Ao(Cr.G,t),this)},Ol.prototype.runTransaction=function(t){var e=this;return xh("Firestore.runTransaction",arguments,1),Vh("Firestore.runTransaction","function",1,t),this.QT().transaction((function(n){return t(new pl(e,n))}))},Ol.prototype.batch=function(){return this.QT(),new dl(this)},Object.defineProperty(Ol,"logLevel",{get:function(){switch(Hs()){case r.DEBUG:return"debug";case r.SILENT:return"silent";default:return"error"}},enumerable:!0,configurable:!0}),Ol.setLogLevel=function(t){switch(xh("Firestore.setLogLevel",arguments,1),Vh("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":Ks(r.DEBUG);break;case"error":Ks(r.ERROR);break;case"silent":Ks(r.SILENT);break;default:throw new Dr(Sr.INVALID_ARGUMENT,"Invalid log level: "+t)}},Ol.prototype.iE=function(){return this.HT.timestampsInSnapshots},Ol),pl=(xl.prototype.get=function(t){var e=this;xh("Transaction.get",arguments,1);var n=Ml("Transaction.get",t,this.nE);return this.rE.R_([n.$c]).then((function(t){if(!t||1!==t.length)return Js();var r=t[0];if(r instanceof Io)return new ml(e.nE,n.$c,null,!1,!1,n.hE);if(r instanceof To)return new ml(e.nE,n.$c,r,!1,!1,n.hE);throw Js()}))},xl.prototype.set=function(t,e,n){Rh("Transaction.set",arguments,2,3);var r=Ml("Transaction.set",t,this.nE);n=Pl("Transaction.set",n);var i=jl(r.hE,e,"Transaction.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.nE.YT.Sc(s,o,n.mergeFields):this.nE.YT.bc(s,o);return this.rE.set(r.$c,u),this},xl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return i="string"==typeof e||e instanceof Xh?(Oh("Transaction.update",arguments,3),r=Ml("Transaction.update",t,this.nE),this.nE.YT.Cc("Transaction.update",e,n,o)):(xh("Transaction.update",arguments,2),r=Ml("Transaction.update",t,this.nE),this.nE.YT.Dc("Transaction.update",e)),this.rE.update(r.$c,i),this},xl.prototype.delete=function(t){xh("Transaction.delete",arguments,1);var e=Ml("Transaction.delete",t,this.nE);return this.rE.delete(e.$c),this},xl),dl=(kl.prototype.set=function(t,e,n){Rh("WriteBatch.set",arguments,2,3),this.uE();var r=Ml("WriteBatch.set",t,this.nE);n=Pl("WriteBatch.set",n);var i=jl(r.hE,e,"WriteBatch.set"),o=i[0],s=i[1],u=n.merge||n.mergeFields?this.nE.YT.Sc(s,o,n.mergeFields):this.nE.YT.bc(s,o);return this.oE=this.oE.concat(u.Rc(r.$c,Fi.ft())),this},kl.prototype.update=function(t,e,n){for(var r,i,o=[],s=3;s<arguments.length;s++)o[s-3]=arguments[s];return this.uE(),i="string"==typeof e||e instanceof Xh?(Oh("WriteBatch.update",arguments,3),r=Ml("WriteBatch.update",t,this.nE),this.nE.YT.Cc("WriteBatch.update",e,n,o)):(xh("WriteBatch.update",arguments,2),r=Ml("WriteBatch.update",t,this.nE),this.nE.YT.Dc("WriteBatch.update",e)),this.oE=this.oE.concat(i.Rc(r.$c,Fi.exists(!0))),this},kl.prototype.delete=function(t){xh("WriteBatch.delete",arguments,1),this.uE();var e=Ml("WriteBatch.delete",t,this.nE);return this.oE=this.oE.concat(new Qi(e.$c,Fi.ft())),this},kl.prototype.commit=function(){return this.uE(),this.aE=!0,0<this.oE.length?this.nE.QT().write(this.oE):Promise.resolve()},kl.prototype.uE=function(){if(this.aE)throw new Dr(Sr.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},kl),yl=(Dl.sE=function(t,e,n){if(t.length%2!=0)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t.j()+" has "+t.length);return new Dl(new Xr(t),e,n)},Object.defineProperty(Dl.prototype,"id",{get:function(){return this.$c.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(Dl.prototype,"parent",{get:function(){return new El(this.$c.path.M(),this.firestore,this.hE)},enumerable:!0,configurable:!0}),Object.defineProperty(Dl.prototype,"path",{get:function(){return this.$c.path.j()},enumerable:!0,configurable:!0}),Dl.prototype.collection=function(t){if(xh("DocumentReference.collection",arguments,1),Vh("DocumentReference.collection","non-empty string",1,t),!t)throw new Dr(Sr.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=Cr.K(t);return new El(this.$c.path.child(e),this.firestore)},Dl.prototype.isEqual=function(t){if(!(t instanceof Dl))throw Gh("isEqual","DocumentReference",1,t);return this.firestore===t.firestore&&this.$c.isEqual(t.$c)&&this.hE===t.hE},Dl.prototype.set=function(t,e){Rh("DocumentReference.set",arguments,1,2),e=Pl("DocumentReference.set",e);var n=jl(this.hE,t,"DocumentReference.set"),r=n[0],i=n[1],o=e.merge||e.mergeFields?this.firestore.YT.Sc(i,r,e.mergeFields):this.firestore.YT.bc(i,r);return this.WT.write(o.Rc(this.$c,Fi.ft()))},Dl.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return n="string"==typeof t||t instanceof Xh?(Oh("DocumentReference.update",arguments,2),this.firestore.YT.Cc("DocumentReference.update",t,e,r)):(xh("DocumentReference.update",arguments,1),this.firestore.YT.Dc("DocumentReference.update",t)),this.WT.write(n.Rc(this.$c,Fi.exists(!0)))},Dl.prototype.delete=function(){return xh("DocumentReference.delete",arguments,0),this.WT.write([new Qi(this.$c,Fi.ft())])},Dl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Rh("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||sl(t[i])||(Bh("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Ch("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return n=sl(t[i])?t[i]:(Vh("DocumentReference.onSnapshot","function",i,t[i]),Ph("DocumentReference.onSnapshot","function",i+1,t[i+1]),Ph("DocumentReference.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.cE(o,n)},Dl.prototype.cE=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new $f({next:function(t){if(e.next){var r=t.docs.get(n.$c);e.next(new ml(n.firestore,n.$c,r,t.fromCache,t.hasPendingWrites,n.hE))}},error:r}),o=this.WT.listen(Ao.Wt(this.$c.path),i,t);return function(){i.FT(),n.WT.nl(o)}},Dl.prototype.get=function(t){var e=this;return Rh("DocumentReference.get",arguments,0,1),Cl("DocumentReference.get",t),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.QT().ST(e.$c).then((function(t){n(new ml(e.firestore,e.$c,t,!0,t instanceof To&&t.At,e.hE))}),r):e._E(n,r,t)}))},Dl.prototype._E=function(t,e,n){var r=this.cE({includeMetadataChanges:!0,Lf:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new Dr(Sr.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new Dr(Sr.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},Dl.prototype.withConverter=function(t){return new Dl(this.$c,this.firestore,t)},Dl),vl=(Sl.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},Sl),ml=(Al.prototype.data=function(t){if(Rh("DocumentSnapshot.data",arguments,0,1),t=Ll("DocumentSnapshot.data",t),this.lE){if(this.hE){var e=new gl(this.nE,this.$c,this.lE,this.dE,this.fE);return this.hE.fromFirestore(e,t)}return new hl(this.nE,this.nE.iE(),t.serverTimestamps,void 0).$T(this.lE.Mt())}},Al.prototype.get=function(t,e){if(Rh("DocumentSnapshot.get",arguments,1,2),e=Ll("DocumentSnapshot.get",e),this.lE){var n=this.lE.data().field(Rc("DocumentSnapshot.get",t));if(null!==n)return new hl(this.nE,this.nE.iE(),e.serverTimestamps,this.hE).$T(n)}},Object.defineProperty(Al.prototype,"id",{get:function(){return this.$c.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(Al.prototype,"ref",{get:function(){return new yl(this.$c,this.nE,this.hE)},enumerable:!0,configurable:!0}),Object.defineProperty(Al.prototype,"exists",{get:function(){return null!==this.lE},enumerable:!0,configurable:!0}),Object.defineProperty(Al.prototype,"metadata",{get:function(){return new vl(this.fE,this.dE)},enumerable:!0,configurable:!0}),Al.prototype.isEqual=function(t){if(!(t instanceof Al))throw Gh("isEqual","DocumentSnapshot",1,t);return this.nE===t.nE&&this.dE===t.dE&&this.$c.isEqual(t.$c)&&(null===this.lE?null===t.lE:this.lE.isEqual(t.lE))&&this.hE===t.hE},Al),gl=(s(_l,al=ml),_l.prototype.data=function(t){return al.prototype.data.call(this,t)},_l),wl=(Nl.prototype.where=function(t,e,n){xh("Query.where",arguments,3),Fh("Query.where",3,n);var r,i=function(t,e){if(!t.some((function(t){return t===e})))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid value "+qh(e)+" provided to function Query.where() for its "+Wh(2)+" argument. Acceptable values: "+t.join(", "));return e}(["<","<=","==",">=",">","array-contains","in","array-contains-any"],e),o=Rc("Query.where",t);if(o.Y()){if("array-contains"===i||"array-contains-any"===i)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+i+"' queries on FieldPath.documentId().");if("in"===i){this.EE(n,i);for(var s=[],u=0,a=n;u<a.length;u++){var h=a[u];s.push(this.IE(h))}r={arrayValue:{values:s}}}else r=this.IE(n)}else"in"!==i&&"array-contains-any"!==i||this.EE(n,i),r=this.firestore.YT.Fc("Query.where",n,"in"===i);var c=So.create(o,i,r);return this.wE(c),new Nl(this.TE.Gt(c),this.firestore,this.hE)},Nl.prototype.orderBy=function(t,e){var n;if(Rh("Query.orderBy",arguments,1,2),Ph("Query.orderBy","non-empty string",2,e),void 0===e||"asc"===e)n="asc";else{if("desc"!==e)throw new Dr(Sr.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+e+"', expected 'asc' or 'desc'.");n="desc"}if(null!==this.TE.startAt)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this.TE.endAt)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var r=Rc("Query.orderBy",t),i=new Po(r,n);return this.RE(i),new Nl(this.TE.zt(i),this.firestore,this.hE)},Nl.prototype.limit=function(t){return xh("Query.limit",arguments,1),Vh("Query.limit","number",1,t),zh("Query.limit",1,t),new Nl(this.TE.Ht(t),this.firestore,this.hE)},Nl.prototype.limitToLast=function(t){return xh("Query.limitToLast",arguments,1),Vh("Query.limitToLast","number",1,t),zh("Query.limitToLast",1,t),new Nl(this.TE.Yt(t),this.firestore,this.hE)},Nl.prototype.startAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Oh("Query.startAt",arguments,1);var r=this.mE("Query.startAt",t,e,!0);return new Nl(this.TE.Jt(r),this.firestore,this.hE)},Nl.prototype.startAfter=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Oh("Query.startAfter",arguments,1);var r=this.mE("Query.startAfter",t,e,!1);return new Nl(this.TE.Jt(r),this.firestore,this.hE)},Nl.prototype.endBefore=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Oh("Query.endBefore",arguments,1);var r=this.mE("Query.endBefore",t,e,!0);return new Nl(this.TE.Xt(r),this.firestore,this.hE)},Nl.prototype.endAt=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];Oh("Query.endAt",arguments,1);var r=this.mE("Query.endAt",t,e,!1);return new Nl(this.TE.Xt(r),this.firestore,this.hE)},Nl.prototype.isEqual=function(t){if(!(t instanceof Nl))throw Gh("isEqual","Query",1,t);return this.firestore===t.firestore&&this.TE.isEqual(t.TE)},Nl.prototype.withConverter=function(t){return new Nl(this.TE,this.firestore,t)},Nl.prototype.mE=function(t,e,n,r){if(Fh(t,1,e),e instanceof ml){if(0<n.length)throw new Dr(Sr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Dr(Sr.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.AE(i.lE,r)}var o=[e].concat(n);return this.PE(t,o,r)},Nl.prototype.AE=function(t,e){for(var n=[],r=0,i=this.TE.orderBy;r<i.length;r++){var o=i[r];if(o.field.Y())n.push(gi(this.firestore.Nc,t.key));else{var s=t.field(o.field);if(si(s))throw new Dr(Sr.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=o.field.j();throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}n.push(s)}}return new Vo(n,e)},Nl.prototype.PE=function(t,e,n){var r=this.TE.xt;if(e.length>r.length)throw new Dr(Sr.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var s=e[o];if(r[o].field.Y()){if("string"!=typeof s)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof s);if(!this.TE._e()&&-1!==s.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+s+"' contains a slash.");var u=this.TE.path.child(Cr.K(s));if(!Xr.et(u))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var a=new Xr(u);i.push(gi(this.firestore.Nc,a))}else{var h=this.firestore.YT.Fc(t,s);i.push(h)}}return new Vo(i,n)},Nl.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Rh("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||sl(t[i])||(Bh("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Ch("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),n=sl(t[i])?t[i]:(Vh("Query.onSnapshot","function",i,t[i]),Ph("Query.onSnapshot","function",i+1,t[i+1]),Ph("Query.onSnapshot","function",i+2,t[i+2]),{next:t[i],error:t[i+1],complete:t[i+2]}),this.VE(this.TE),this.cE(r,n)},Nl.prototype.cE=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new $f({next:function(t){e.next&&e.next(new bl(n.firestore,n.TE,t,n.hE))},error:r}),o=this.firestore.QT(),s=o.listen(this.TE,i,t);return function(){i.FT(),o.nl(s)}},Nl.prototype.VE=function(t){if(t.ae()&&0===t.xt.length)throw new Dr(Sr.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")},Nl.prototype.get=function(t){var e=this;return Rh("Query.get",arguments,0,1),Cl("Query.get",t),this.VE(this.TE),new Promise((function(n,r){t&&"cache"===t.source?e.firestore.QT().DT(e.TE).then((function(t){n(new bl(e.firestore,e.TE,t,e.hE))}),r):e._E(n,r,t)}))},Nl.prototype._E=function(t,e,n){var r=this.cE({includeMetadataChanges:!0,Lf:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new Dr(Sr.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},Nl.prototype.IE=function(t){if("string"==typeof t){if(""===t)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this.TE._e()&&-1!==t.indexOf("/"))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this.TE.path.child(Cr.K(t));if(!Xr.et(e))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return gi(this.firestore.Nc,new Xr(e))}if(t instanceof yl){var n=t;return gi(this.firestore.Nc,n.$c)}throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+qh(t)+".")},Nl.prototype.EE=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(10<t.length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(0<=t.indexOf(null))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(0<t.filter((function(t){return Number.isNaN(t)})).length)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},Nl.prototype.wE=function(t){if(t instanceof So){var e=["array-contains","array-contains-any"],n=["in","array-contains-any"],r=0<=e.indexOf(t.op),i=0<=n.indexOf(t.op);if(t.ue()){var o=this.TE.jt();if(null!==o&&!o.isEqual(t.field))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var s=this.TE.Kt();null!==s&&this.gE(t.field,s)}else if(i||r){var u=null;if(i&&(u=this.TE.ce(n)),null===u&&r&&(u=this.TE.ce(e)),null!=u)throw u===t.op?new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+u.toString()+"' filters.")}}},Nl.prototype.RE=function(t){if(null===this.TE.Kt()){var e=this.TE.jt();null!==e&&this.gE(e,t.field)}},Nl.prototype.gE=function(t,e){if(!e.isEqual(t))throw new Dr(Sr.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},Nl),bl=(Object.defineProperty(Il.prototype,"docs",{get:function(){var t=[];return this.forEach((function(e){return t.push(e)})),t},enumerable:!0,configurable:!0}),Object.defineProperty(Il.prototype,"empty",{get:function(){return this.yE.docs.B()},enumerable:!0,configurable:!0}),Object.defineProperty(Il.prototype,"size",{get:function(){return this.yE.docs.size},enumerable:!0,configurable:!0}),Il.prototype.forEach=function(t,e){var n=this;Rh("QuerySnapshot.forEach",arguments,1,2),Vh("QuerySnapshot.forEach","function",1,t),this.yE.docs.forEach((function(r){t.call(e,n.SE(r))}))},Object.defineProperty(Il.prototype,"query",{get:function(){return new wl(this.pE,this.nE,this.hE)},enumerable:!0,configurable:!0}),Il.prototype.docChanges=function(t){t&&(Bh("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Ch("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this.yE.hs)throw new Dr(Sr.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this.bE&&this.vE===e||(this.bE=function(t,e,n,r){if(n.ss.B()){var i=0;return n.docChanges.map((function(e){var o=new gl(t,e.doc.key,e.doc,n.fromCache,n.ns.has(e.doc.key),r);return e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}}))}var o=n.ss;return n.docChanges.filter((function(t){return e||3!==t.type})).map((function(e){var i=new gl(t,e.doc.key,e.doc,n.fromCache,n.ns.has(e.doc.key),r),s=-1,u=-1;return 0!==e.type&&(s=o.indexOf(e.doc.key),o=o.delete(e.doc.key)),1!==e.type&&(u=(o=o.add(e.doc)).indexOf(e.doc.key)),{type:function(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Js()}}(e.type),doc:i,oldIndex:s,newIndex:u}}))}(this.nE,e,this.yE,this.hE),this.vE=e),this.bE},Il.prototype.isEqual=function(t){if(!(t instanceof Il))throw Gh("isEqual","QuerySnapshot",1,t);return this.nE===t.nE&&this.pE.isEqual(t.pE)&&this.yE.isEqual(t.yE)&&this.hE===t.hE},Il.prototype.SE=function(t){return new gl(this.nE,t.key,t,this.metadata.fromCache,this.yE.ns.has(t.key),this.hE)},Il),El=(s(Tl,ul=wl),Object.defineProperty(Tl.prototype,"id",{get:function(){return this.TE.path.O()},enumerable:!0,configurable:!0}),Object.defineProperty(Tl.prototype,"parent",{get:function(){var t=this.TE.path.M();return t.B()?null:new yl(new Xr(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(Tl.prototype,"path",{get:function(){return this.TE.path.j()},enumerable:!0,configurable:!0}),Tl.prototype.doc=function(t){if(Rh("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=tu.cn()),Vh("CollectionReference.doc","non-empty string",1,t),""===t)throw new Dr(Sr.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=Cr.K(t);return yl.sE(this.TE.path.child(e),this.firestore,this.hE)},Tl.prototype.add=function(t){xh("CollectionReference.add",arguments,1),Vh("CollectionReference.add","object",1,this.hE?this.hE.toFirestore(t):t);var e=this.doc();return e.set(t).then((function(){return e}))},Tl.prototype.withConverter=function(t){return new Tl(this.DE,this.firestore,t)},Tl);function Tl(t,e,n){var r=this;if(((r=ul.call(this,Ao.Wt(t),e,n)||this).DE=t).length%2!=1)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t.j()+" has "+t.length);return r}function Il(t,e,n,r){this.nE=t,this.pE=e,this.yE=n,this.hE=r,this.bE=null,this.vE=null,this.metadata=new vl(n.hasPendingWrites,n.fromCache)}function Nl(t,e,n){this.TE=t,this.firestore=e,this.hE=n}function _l(){return null!==al&&al.apply(this,arguments)||this}function Al(t,e,n,r,i,o){this.nE=t,this.$c=e,this.lE=n,this.dE=r,this.fE=i,this.hE=o}function Sl(t,e){this.hasPendingWrites=t,this.fromCache=e}function Dl(t,e,n){this.$c=t,this.firestore=e,this.hE=n,this.WT=this.firestore.QT()}function kl(t){this.nE=t,this.oE=[],this.aE=!1}function xl(t,e){this.nE=t,this.rE=e}function Ol(t,e,n){var r=this;if(void 0===n&&(n=new Kf),this.qT=null,this.UT=new oh,this.INTERNAL={delete:function(){return u(r,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return this.QT(),[4,this.WT.terminate()];case 1:return t.sent(),[2]}}))}))}},"object"==typeof t.options){var i=t;this.qT=i,this.Nc=Ol.jT(i),this.KT=i.name,this.GT=new xr(e)}else{var o=t;if(!o.projectId)throw new Dr(Sr.INVALID_ARGUMENT,"Must provide projectId");this.Nc=new su(o.projectId,o.database),this.KT="[DEFAULT]",this.GT=new kr}this.zT=n,this.HT=new fl({}),this.YT=new _c(this.Nc)}function Rl(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Dr(Sr.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else Lh("settings","non-empty string","host",t.host),this.host=t.host,Ch("settings","boolean","ssl",t.ssl),this.ssl=null===(e=t.ssl)||void 0===e||e;if(Bh("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Ch("settings","object","credentials",t.credentials),this.credentials=t.credentials,Ch("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Xs("The setting 'timestampsInSnapshots: true' is no longer required and should be removed."):!1===t.timestampsInSnapshots&&Xs("Support for 'timestampsInSnapshots: false' will be removed soon. You must update your code to handle Timestamp objects."),this.timestampsInSnapshots=null===(n=t.timestampsInSnapshots)||void 0===n||n,Ch("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=lh.cu;else{if(t.cacheSizeBytes!==cl&&t.cacheSizeBytes<lh.uu)throw new Dr(Sr.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+lh.uu);this.cacheSizeBytes=t.cacheSizeBytes}Ch("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0!==t.experimentalForceLongPolling&&t.experimentalForceLongPolling}function Vl(t,e,n,r){this.firestore=t,this.timestampsInSnapshots=e,this.NT=n,this.converter=r}function Pl(t,e){if(void 0===e)return{merge:!1};if(Bh(t,e,["merge","mergeFields"]),Ch(t,"boolean","merge",e.merge),n=t,void 0!==(r=e.mergeFields)&&function(t,e,n,r){if(!(n instanceof Array))throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+qh(n));for(var i=0;i<n.length;++i)if(!r(n[i]))throw new Dr(Sr.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be a string or a FieldPath, but the value at index "+i+" was: "+qh(n[i]))}(n,"mergeFields",r,(function(t){return"string"==typeof t||t instanceof Xh})),void 0!==e.mergeFields&&void 0!==e.merge)throw new Dr(Sr.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');var n,r;return e}function Ll(t,e){return void 0===e?{}:(Bh(t,e,["serverTimestamps"]),Mh(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function Cl(t,e){Ph(t,"object",1,e),e&&(Bh(t,e,["source"]),Mh(t,0,"source",e.source,["default","server","cache"]))}function Ml(t,e,n){if(e instanceof yl){if(e.firestore!==n)throw new Dr(Sr.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw Gh(t,"DocumentReference",1,e)}function jl(t,e,n){var r;return t?(r=t.toFirestore(e),n="toFirestore() in "+n):r=e,[r,n]}function Ul(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Dr(Sr.INVALID_ARGUMENT,t)}return n.prototype=t.prototype,Object.assign(n,t),n}var ql,Fl=Ul(ll,"Use firebase.firestore() instead."),Bl=Ul(pl,"Use firebase.firestore().runTransaction() instead."),Gl=Ul(dl,"Use firebase.firestore().batch() instead."),zl=Ul(yl,"Use firebase.firestore().doc() instead."),Wl=Ul(ml),Ql=Ul(gl),Hl=Ul(wl),Kl=Ul(bl),Yl=Ul(El,"Use firebase.firestore().collection() instead."),Xl=Ul((hp.delete=function(){return kh("FieldValue.delete",arguments),new sc},hp.serverTimestamp=function(){return kh("FieldValue.serverTimestamp",arguments),new uc},hp.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Oh("FieldValue.arrayUnion",arguments,1),new ac(t)},hp.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Oh("FieldValue.arrayRemove",arguments,1),new hc(t)},hp.increment=function(t){return Vh("FieldValue.increment","number",1,t),xh("FieldValue.increment",arguments,1),new cc(t)},hp.prototype.isEqual=function(t){return this===t},hp),"Use FieldValue.<field>() instead."),$l=Ul(Yh,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),Jl={Firestore:Fl,GeoPoint:fc,Timestamp:Vr,Blob:$l,Transaction:Bl,WriteBatch:Gl,DocumentReference:zl,DocumentSnapshot:Wl,Query:Hl,QueryDocumentSnapshot:Ql,QuerySnapshot:Kl,CollectionReference:Yl,FieldPath:Xh,FieldValue:Xl,setLogLevel:ll.setLogLevel,CACHE_SIZE_UNLIMITED:cl},Zl=(ap.prototype.x_=function(t){},ap.prototype.Ro=function(){},ap),tp=(up.prototype.x_=function(t){this.kE.push(t)},up.prototype.Ro=function(){window.removeEventListener("online",this.CE),window.removeEventListener("offline",this.NE)},up.prototype.ME=function(){window.addEventListener("online",this.CE),window.addEventListener("offline",this.NE)},up.prototype.FE=function(){Ys("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.kE;t<e.length;t++)(0,e[t])(0)},up.prototype.$E=function(){Ys("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.kE;t<e.length;t++)(0,e[t])(1)},up.jh=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},up),ep=(sp.prototype.t_=function(t){this.xE=t},sp.prototype.Hc=function(t){this.BE=t},sp.prototype.onMessage=function(t){this.qE=t},sp.prototype.close=function(){this.OE()},sp.prototype.send=function(t){this.LE(t)},sp.prototype.UE=function(){this.xE()},sp.prototype.QE=function(t){this.BE(t)},sp.prototype.WE=function(t){this.qE(t)},sp),np={BatchGetDocuments:"batchGet",Commit:"commit"},rp="gl-js/ fire/"+Er,ip=(op.prototype.KE=function(t,e){if(e)for(var n in e.o)e.o.hasOwnProperty(n)&&(t[n]=e.o[n]);t["X-Goog-Api-Client"]=rp},op.prototype.l_=function(t,e,n){var r=this,i=this.GE(t);return new Promise((function(o,s){var u=new br;u.listenOnce(gr.COMPLETE,(function(){try{switch(u.getLastErrorCode()){case mr.NO_ERROR:var e=u.getResponseJson();Ys("Connection","XHR received:",JSON.stringify(e)),o(e);break;case mr.TIMEOUT:Ys("Connection",'RPC "'+t+'" timed out'),s(new Dr(Sr.DEADLINE_EXCEEDED,"Request time out"));break;case mr.HTTP_ERROR:var n=u.getStatus();if(Ys("Connection",'RPC "'+t+'" failed with status:',n,"response text:",u.getResponseText()),0<n){var r=u.getResponseJson().error;if(r&&r.status&&r.message){var i=(a=r.status.toLowerCase().replace("_","-"),0<=Object.values(Sr).indexOf(a)?a:Sr.UNKNOWN);s(new Dr(i,r.message))}else s(new Dr(Sr.UNKNOWN,"Server responded with status "+u.getStatus()))}else Ys("Connection",'RPC "'+t+'" failed'),s(new Dr(Sr.UNAVAILABLE,"Connection failed."));break;default:Js()}}finally{Ys("Connection",'RPC "'+t+'" completed.')}var a}));var a=Object.assign({},e);delete a.database;var h=JSON.stringify(a);Ys("Connection","XHR sending: ",i+" "+h);var c={"Content-Type":"text/plain"};r.KE(c,n),u.send(i,"POST",h,c,15)}))},op.prototype.d_=function(t,e,n){return this.l_(t,e,n)},op.prototype.e_=function(t,e){var n,r,i=[this.jE,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=vr(),s={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.ii.projectId+"/databases/"+this.ii.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.KE(s.initMessageHeaders,e),"undefined"!=typeof window&&(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(v())||"object"==typeof navigator&&"ReactNative"===navigator.product||0<=v().indexOf("Electron/")||0<=(r=v()).indexOf("MSIE ")||0<=r.indexOf("Trident/")||0<=v().indexOf("MSAppHost/")||"object"==typeof(n="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0)&&void 0!==n.id||(s.httpHeadersOverwriteParam="$httpHeaders");var u=i.join("");function a(t,e){h.listen(t,(function(t){try{e(t)}catch(t){setTimeout((function(){throw t}),0)}}))}Ys("Connection","Creating WebChannel: "+u+" "+s);var h=o.createWebChannel(u,s),c=!1,f=!1,l=new ep({LE:function(t){f?Ys("Connection","Not sending because WebChannel is closed:",t):(c||(Ys("Connection","Opening WebChannel transport."),h.open(),c=!0),Ys("Connection","WebChannel sending:",t),h.send(t))},OE:function(){return h.close()}});return a(wr.EventType.OPEN,(function(){f||Ys("Connection","WebChannel transport opened.")})),a(wr.EventType.CLOSE,(function(){f||(f=!0,Ys("Connection","WebChannel transport closed"),l.QE())})),a(wr.EventType.ERROR,(function(t){f||(f=!0,Ys("Connection","WebChannel transport errored:",t),l.QE(new Dr(Sr.UNAVAILABLE,"The operation could not be completed")))})),a(wr.EventType.MESSAGE,(function(t){var e;if(!f){var n=t.data[0];Zs(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Ys("Connection","WebChannel received error:",r);var i=r.status,o=function(){var t=co[i];if(void 0!==t)return $o(t)}(),s=r.message;void 0===o&&(o=Sr.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),f=!0,l.QE(new Dr(o,s)),h.close()}else Ys("Connection","WebChannel received:",n),l.WE(n)}})),setTimeout((function(){l.UE()}),0),l},op.prototype.GE=function(t){var e=np[t];return this.jE+"/v1/projects/"+this.ii.projectId+"/databases/"+this.ii.database+"/documents:"+e},op);function op(t){this.ii=t.ii;var e=t.ssl?"https":"http";this.jE=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}function sp(t){this.LE=t.LE,this.OE=t.OE}function up(){var t=this;this.CE=function(){return t.FE()},this.NE=function(){return t.$E()},this.kE=[],this.ME()}function ap(){}function hp(){}function cp(){this.oc="undefined"!=typeof atob}zs.an((Object.defineProperty(cp.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(cp.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),cp.prototype.pT=function(t){return Promise.resolve(new ip(t))},cp.prototype.RT=function(){return new(tp.jh()?tp:Zl)},cp.prototype.yc=function(t){return new Fs(t,{hi:!0})},cp.prototype.un=function(t){return JSON.stringify(t)},cp.prototype.atob=function(t){return atob(t)},cp.prototype.btoa=function(t){return btoa(t)},cp.prototype._n=function(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n},new cp)),(ql=e).INTERNAL.registerComponent(new I("firestore",(function(t){return e=t.getProvider("app").getImmediate(),n=t.getProvider("auth-internal"),new ll(e,n,new Yf);var e,n}),"PUBLIC").setServiceProps(Object.assign({},Jl))),ql.registerVersion("@firebase/firestore","1.14.5")}).apply(this,arguments)}catch(n){throw console.error(n),new Error("Cannot instantiate firebase-firestore.js - be sure to load firebase-app.js first.")}}(n("wj3C"))}).call(this,n("yLpj"))}}]);